
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>Hello @You</title>
        <meta name="author" content="Jan6055">
        <meta name="description" content="">
        <meta name="keywords" content="C++,Rust,Jan6055">
        <link rel="icon" href="https://avatars.githubusercontent.com/u/94843786?s=400&u=3e0bac8cdc09c80d159d076c0503db566f8f0579&v=4">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.1.1/js/all.min.js"></script>
        
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 6.2.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:200;justify-content:space-between;background:#fff;transition:opacity 0.3s ease-out"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜(æµè§ˆå™¨é»˜è®¤å¼€å¯)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="show_page" style="display: -not-none">
                    <div id="menu_show">
                         
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">Hello @you</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;about</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div class="curtain" @click="menu_show = !menu_show" v-show="menu_show"></div>
        <div :class="'title'" @click="menu_show = !menu_show">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;Hello @you</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">about</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        <div id="home-head">
    <div id="home-background" style="background-image: url(http://p6.qhimg.com/bdr/__85/t015c7bbab0a42e2cf9.jpg)"></div>
    
    <div id="home-info" class="home-info" @click="home_click">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>Hello @you</h1>
                <h3>enjoy coding</h3>
                <h5></h5>
            </div>
        </span>
    </div>
    
</div>

<div id="home-posts-wrap" class="">
    <div id="home-posts">
        <div id="posts">
            

<div class="post">
    <a href="/2022/09/26/type-traitsæºç åˆ†æ-äºŒ-/">
        <h2 class="post-title">Type-Traitsæºç åˆ†æ(äºŒ)</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/26
        </span>
    </div>
    <div class="excerpt">
        <div class="content" v-pre>
            
            <p>åœ¨ä¸€ä¸­ï¼Œä»‹ç»äº†ä¸€äº›type_traitçš„åŸºæœ¬è®¾æ–½, å¾ˆè½»æ¾ï¼Œå”¯ä¸€æ¯”è¾ƒå¤æ‚çš„å°±æ˜¯is_pointerã€‚åœ¨äºŒä¸­ï¼Œå°†ç»§ç»­æ¢ç´¢tyep_traitsä¸­çš„åŸºæœ¬è®¾æ–½â€”â€”è¿™äº›è®¾æ–½åœ¨TMPä¸­ï¼Œæ’°å†™åº“çš„æ—¶å€™ç»å¸¸ç”¨åˆ°ã€‚è¿™ç¯‡æ–‡ç« ä¸ä¼šæ¶‰åŠåˆ°ä¸€äº›é«˜çº§çš„æŠ€å·§ã€‚è¿™äº›æŠ€å·§æ”¾åœ¨åé¢åˆ†æã€‚</p>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><h2 id="å…ƒå‡½æ•°çš„å®ç°æŠ€å·§"><a href="#å…ƒå‡½æ•°çš„å®ç°æŠ€å·§" class="headerlink" title="å…ƒå‡½æ•°çš„å®ç°æŠ€å·§"></a>å…ƒå‡½æ•°çš„å®ç°æŠ€å·§</h2><p>åœ¨æ ‡å‡†åº“ä¸­ï¼Œæˆ–è€…è‡ªå·±æƒ³è¦æ’°å†™å…ƒå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨è¿™æ ·ä¸€ç§æ‰‹æ³•ã€‚ä¾‹å¦‚æƒ³å®ç°ä¸€ä¸ªåä¸ºXXXçš„å…ƒå‡½æ•°ã€‚</p>
<p>å¯ä»¥å¦å¤–å®šä¹‰ä¸€ä¸ªå…ƒå‡½æ•°å«åšXXX_helper&#x2F;XXX_impl(éšä½ çš„å–œå¥½ï¼Œå«ä»€ä¹ˆçŒ«çŒ«ç‹—ç‹—ä¹Ÿæ²¡æœ‰é—®é¢˜)æ¥è§£å†³æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚</p>
<p>è€ŒXXXè¿™ä¸ªå…ƒå‡½æ•°ï¼Œåšä¸€äº›è¾…åŠ©æ€§çš„æ“ä½œï¼Œä¾‹å¦‚ç§»é™¤constï¼Œvolatileã€‚è®©åè®©XXXç»§æ‰¿XXX_helperæ¥å®ç°åŠŸèƒ½ã€‚</p>
<h2 id="is-void"><a href="#is-void" class="headerlink" title="is_void"></a>is_void</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯voidï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>çœŸæ­£çš„å®ç°æ˜¯<code>__is_void_helper</code>ï¼Œè€Œ<code>is_void</code>åšä¸€äº›è¾…åŠ©æ€§çš„æ“ä½œã€‚</p>
<pre><code class="C++">  template&lt;typename&gt;
    struct __is_void_helper
    : public false_type &#123; &#125;;

  template&lt;&gt;
    struct __is_void_helper&lt;void&gt;
    : public true_type &#123; &#125;;

  /// is_void
  template&lt;typename _Tp&gt;
    struct is_void
    : public __is_void_helper&lt;__remove_cv_t&lt;_Tp&gt;&gt;::type //ç§»é™¤const volatile
    &#123; &#125;;
</code></pre>
<h2 id="is-integral"><a href="#is-integral" class="headerlink" title="is_integral"></a>is_integral</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯integralï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p><code>integral</code>å¯ä»¥ç†è§£ä¸ºæ•´å½¢ï¼ŒåŒ…æ‹¬æ— ç¬¦å·ç±»å‹ã€‚æˆ–è€…éšä½ æ€ä¹ˆç†è§£éƒ½è¡Œï¼Œåªè¦ä½ çœ‹åˆ°äº†å®ç°ï¼Œä½ å°±çŸ¥é“äº†ä»–æ˜¯ä»€ä¹ˆæ„æ€ã€‚</p>
<p>åŒæ ·çš„<code>__is_integral_helper</code>åšçš„å…·ä½“çš„æ“ä½œï¼Œæœ‰å¾ˆå¤šä¸ªç‰¹ä¾‹åŒ–æ¨¡æ¿ã€‚ä½ ä¼šè¯´ç¼–å†™ä¸€ä¸ªå®æ›´æ–¹ä¾¿ä¸æ˜¯å—ï¼Ÿä¹Ÿè®¸æ˜¯çš„ï¼</p>
<pre><code class="C++"> template&lt;typename&gt;
    struct __is_integral_helper
    : public false_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;bool&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;char&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;signed char&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned char&gt;
    : public true_type &#123; &#125;;

  // We want is_integral&lt;wchar_t&gt; to be true (and make_signed/unsigned to work)
  // even when libc doesn&#39;t provide working &lt;wchar.h&gt; and related functions,
  // so check __WCHAR_TYPE__ instead of _GLIBCXX_USE_WCHAR_T.
#ifdef __WCHAR_TYPE__
  template&lt;&gt;
    struct __is_integral_helper&lt;wchar_t&gt;
    : public true_type &#123; &#125;;
#endif

#ifdef _GLIBCXX_USE_CHAR8_T
  template&lt;&gt;
    struct __is_integral_helper&lt;char8_t&gt;
    : public true_type &#123; &#125;;
#endif

  template&lt;&gt;
    struct __is_integral_helper&lt;char16_t&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;char32_t&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;short&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned short&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;int&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned int&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;long&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned long&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;long long&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned long long&gt;
    : public true_type &#123; &#125;;

  // Conditionalizing on __STRICT_ANSI__ here will break any port that
  // uses one of these types for size_t.
#if defined(__GLIBCXX_TYPE_INT_N_0) //è¿™äº›æ¡ä»¶ç¼–è¯‘ä½ å¤§å¯å¿½ç•¥æ‰ï¼Œæœ‰å…´è¶£ä¹Ÿå¯ä»¥çœ‹çœ‹ã€‚
  template&lt;&gt;
    struct __is_integral_helper&lt;__GLIBCXX_TYPE_INT_N_0&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned __GLIBCXX_TYPE_INT_N_0&gt;
    : public true_type &#123; &#125;;
#endif
#if defined(__GLIBCXX_TYPE_INT_N_1)
  template&lt;&gt;
    struct __is_integral_helper&lt;__GLIBCXX_TYPE_INT_N_1&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned __GLIBCXX_TYPE_INT_N_1&gt;
    : public true_type &#123; &#125;;
#endif
#if defined(__GLIBCXX_TYPE_INT_N_2)
  template&lt;&gt;
    struct __is_integral_helper&lt;__GLIBCXX_TYPE_INT_N_2&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned __GLIBCXX_TYPE_INT_N_2&gt;
    : public true_type &#123; &#125;;
#endif
#if defined(__GLIBCXX_TYPE_INT_N_3)
  template&lt;&gt;
    struct __is_integral_helper&lt;__GLIBCXX_TYPE_INT_N_3&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_integral_helper&lt;unsigned __GLIBCXX_TYPE_INT_N_3&gt;
    : public true_type &#123; &#125;;
#endif

  /// is_integral
  template&lt;typename _Tp&gt;
    struct is_integral
    : public __is_integral_helper&lt;__remove_cv_t&lt;_Tp&gt;&gt;::type //ä¸is_voidä½¿ç”¨ç›¸åŒçš„æ‰‹æ³•
    &#123; &#125;;
</code></pre>
<h2 id="is-floating-point"><a href="#is-floating-point" class="headerlink" title="is_floating_point"></a>is_floating_point</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯æµ®ç‚¹ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>å¦‚æœä½ ä¼šäº†is_integral,é‚£ä¹ˆis_floating_pointä¹Ÿæ— éœ€å¤šè¨€äº†ã€‚</p>
<pre><code class="C++"> template&lt;typename&gt;
    struct __is_floating_point_helper
    : public false_type &#123; &#125;;

  template&lt;&gt;
    struct __is_floating_point_helper&lt;float&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_floating_point_helper&lt;double&gt;
    : public true_type &#123; &#125;;

  template&lt;&gt;
    struct __is_floating_point_helper&lt;long double&gt;
    : public true_type &#123; &#125;;

#if !defined(__STRICT_ANSI__) &amp;&amp; defined(_GLIBCXX_USE_FLOAT128) //åŒæ ·æ˜¯æ¡ä»¶ç¼–è¯‘ï¼Œå¯å¿½ç•¥
  template&lt;&gt;
    struct __is_floating_point_helper&lt;__float128&gt;
    : public true_type &#123; &#125;;
#endif

  /// is_floating_point
  template&lt;typename _Tp&gt;
    struct is_floating_point
    : public __is_floating_point_helper&lt;__remove_cv_t&lt;_Tp&gt;&gt;::type
    &#123; &#125;;
</code></pre>
<h2 id="is-array"><a href="#is-array" class="headerlink" title="is_array"></a>is_array</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯æ•°ç»„(æœ‰ç•Œçš„&#x2F;æ— ç•Œçš„)ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>è€æ–¹æ³•äº†ï¼Œä¸»æ¨¡æ¿+åç‰¹åŒ–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒT*ä¸åŒäºT[]å’ŒT[N]ã€‚ä¾‹å¦‚</p>
<pre><code class="C++">int main() &#123;
    int nums[10] = &#123;1,2,3,4&#125;;
    cout &lt;&lt; std::is_array&lt;decltype(nums)&gt;::value &lt;&lt; endl; //true
    int * const p = nums;
    cout &lt;&lt; std::is_array&lt;decltype(p)&gt;::value &lt;&lt; endl;	//false
    return 0;
&#125;
</code></pre>
<pre><code class="C++">    /// is_array
    // åŒºåˆ«T *, T[], T[N]çš„ä¸åŒ
  template&lt;typename&gt;
    struct is_array
    : public false_type &#123; &#125;;

  template&lt;typename _Tp, std::size_t _Size&gt;
    struct is_array&lt;_Tp[_Size]&gt;	//æœ‰ç•Œæ•°ç»„
    : public true_type &#123; &#125;;

  template&lt;typename _Tp&gt;
    struct is_array&lt;_Tp[]&gt; //æ— ç•Œæ•°ç»„
    : public true_type &#123; &#125;;
</code></pre>
<h2 id="is-pointer"><a href="#is-pointer" class="headerlink" title="is_pointer"></a>is_pointer</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯æŒ‡é’ˆï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>æ³¨æ„<code>const *</code>,<code>* const</code>çš„ä¸åŒï¼Œå‰è€…ä¸æ˜¯æŒ‡é’ˆå…·æœ‰å¸¸é‡æ€§è´¨ï¼Œåè€…æ‰æ˜¯ã€‚</p>
<pre><code class="C++">template&lt;typename&gt;
    struct __is_pointer_helper
    : public false_type &#123; &#125;;

  template&lt;typename _Tp&gt;
    struct __is_pointer_helper&lt;_Tp*&gt;
    : public true_type &#123; &#125;;

  /// is_pointer
  template&lt;typename _Tp&gt;
    struct is_pointer
    : public __is_pointer_helper&lt;__remove_cv_t&lt;_Tp&gt;&gt;::type //remove_cv
    &#123; &#125;;
</code></pre>
<h2 id="is-complete-or-unbounded"><a href="#is-complete-or-unbounded" class="headerlink" title="__is_complete_or_unbounded"></a>__is_complete_or_unbounded</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯å®Œæ•´çš„æˆ–è€…æ— ç•Œçš„ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>å› ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªæœ€ç»ˆå¯¹å¤–æä¾›çš„æ¥å£ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨constexprå‡½æ•°çš„æ–¹å¼æ¥å®ç°ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬åº”å½“çŸ¥é“çš„ä¸€ä¸ªå‰ç½®çŸ¥è¯†ï¼šå¦‚æœæ˜¯ä¸€ä¸ªç±»å‹æ˜¯éå®Œæ•´ç±»å‹ï¼Œæˆ–è€…æ— ç•Œç±»å‹ï¼Œsizeof ä¼šæ— æ³•åº”ç”¨ã€‚ä¾‹å¦‚</p>
<pre><code class="C++">template&lt;typename T&gt;
struct size_is &#123;
    static constexpr size_t value = sizeof(T);
&#125;;
class A; //Aä»…æœ‰å£°æ˜ï¼Œæ˜¯ä¸€ä¸ªéå®Œæ•´ç±»å‹
int main() &#123;
    cout &lt;&lt; size_is&lt;int&gt;::value &lt;&lt; endl; 	//ok
    cout &lt;&lt; size_is&lt;int[]&gt;::value &lt;&lt; endl;	//error
    cout &lt;&lt; size_is&lt;A&gt;::value &lt;&lt; endl;		//error
    return 0;
&#125;
</code></pre>
<p>ä¸€ä¸ªæ— ç•Œ&#x2F;ä¸å®Œæ•´ç±»å‹è¿˜åŒ…æ‹¬</p>
<ul>
<li>å¼•ç”¨</li>
<li>å‡½æ•°</li>
<li>void</li>
<li>æ— ç•Œæ•°ç»„</li>
</ul>
<pre><code class="C++">// Helper functions that return false_type for incomplete classes,
  // incomplete unions and arrays of known bound from those.
//ä¸ºä¸å®Œæ•´çš„ç±»ã€ä¸å®Œæ•´çš„è”åˆå’Œå·²çŸ¥è¾¹ç•Œæ•°ç»„è¿”å› false_type çš„è¾…åŠ©å‡½æ•°ã€‚
template &lt;typename _Tp, size_t = sizeof(_Tp)&gt; //å¦‚æœæ˜¯éå®Œæ•´ç±»å‹ï¼Œæˆ–è€…æ— ç•Œç±»å‹ï¼Œsizeof ä¼šæ— æ³•åº”ç”¨
    constexpr true_type __is_complete_or_unbounded(__type_identity&lt;_Tp&gt;) //ç”±äºæˆ‘ä»¬åªå…³å¿ƒè¿”å›ç±»å‹ï¼Œæ‰€ä»¥ä¸ç”¨è¿”å›å€¼
                    //æˆ–è€…è¯´è¿”å›ç±»å‹ç§éšå«äº†è¿”å›å€¼true_type::value==true;
    &#123; return &#123;&#125;; &#125;

  template &lt;typename _TypeIdentity,	
      typename _NestedType = typename _TypeIdentity::type&gt;	//ä¸Šé¢çš„æ¨¡æ¿åŒ¹é…å¤±è´¥ï¼Œè½¬è€ŒåŒ¹é…è¿™ä¸ªæ¨¡æ¿
    constexpr typename __or_&lt; //æ˜¯å…¶ä¸­ä¸€ä¸ª
      is_reference&lt;_NestedType&gt;,
      is_function&lt;_NestedType&gt;,
      is_void&lt;_NestedType&gt;,
      __is_array_unknown_bounds&lt;_NestedType&gt;	//è¿™ä¸ªtyep_traitsè¿˜æ²¡æœ‰åˆ†æï¼Œä»…ä»…çŸ¥é“å¦‚ä½•ç”¨ä¹Ÿä¸å¦¨
    &gt;::type __is_complete_or_unbounded(_TypeIdentity) //å¦‚æœ__or_ç§çš„å…ƒå‡½æ•°çš„è¿”å›ç±»å‹çš†ä¸ºfalse_typeï¼Œä¹Ÿå°±æ˜¯è¯´å‚æ•°ç±»å‹ä¸æ˜¯ä¸Šé¢é‚£äº›ç±»å‹å…¶ä¸­ä¹‹ä¸€ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯false_type
    &#123; return &#123;&#125;; &#125;
</code></pre>
<h2 id="is-enum-x2F-class-x2F-union"><a href="#is-enum-x2F-class-x2F-union" class="headerlink" title="is_enum&#x2F;class&#x2F;union"></a>is_enum&#x2F;class&#x2F;union</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯enum&#x2F;class&#x2F;unionï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬å†…ç½®äº†è¿™ä¸‰ç§type_traitsã€‚ä½ åªéœ€è¦çŸ¥é“è¿™æ˜¯å†…ç½®çš„å°±å¥½ã€‚</p>
<pre><code class="C++">  /// is_enum
  template&lt;typename _Tp&gt;
    struct is_enum
    : public integral_constant&lt;bool, __is_enum(_Tp)&gt; //æ— æ³•æŸ¥çœ‹__is_enumçš„å…·ä½“å®ç°ï¼Œä¸‹åŒ
    &#123; &#125;;

  /// is_union
  template&lt;typename _Tp&gt;
    struct is_union
    : public integral_constant&lt;bool, __is_union(_Tp)&gt;
    &#123; &#125;;

  /// is_class
  template&lt;typename _Tp&gt;
    struct is_class
    : public integral_constant&lt;bool, __is_class(_Tp)&gt;
    &#123; &#125;;
</code></pre>
<h2 id="is-trivial"><a href="#is-trivial" class="headerlink" title="is_trivial"></a>is_trivial</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ç©ºæŒ‡é’ˆï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>æ™®é€šç±»å‹æ˜¯å…¶å­˜å‚¨æ˜¯è¿ç»­çš„æ™®é€šå¯å¤åˆ¶çš„ï¼Œå¹¶ä¸”ä»…æ”¯æŒé™æ€é»˜è®¤åˆå§‹åŒ–ï¼Œæ— è®ºæ˜¯å¦ä¸º cv é™å®šã€‚å®ƒåŒ…æ‹¬æ ‡é‡ç±»å‹ï¼Œçç¢ç±»å’Œä»»ä½•æ­¤ç±»ç±»å‹çš„æ•°ç»„ã€‚å…¶å®ç°ä¹Ÿæ˜¯ç¼–è¯‘å™¨å†…ç½®çš„ã€‚</p>
<pre><code class="C++"> /// is_trivial
 template&lt;typename _Tp&gt;
   struct is_trivial
   : public integral_constant&lt;bool, __is_trivial(_Tp)&gt; //åŒä¸Š
   &#123;
     static_assert(std::__is_complete_or_unbounded(__type_identity&lt;_Tp&gt;&#123;&#125;), //è¿™é‡Œçš„é™æ€æ–­è¨€æ­£å¦‚å­—é¢æ„æ€
                                                       //æ˜¯å®Œæ•´çš„æˆ–æ— ç•Œçš„
&quot;template argument must be a complete class or an unbounded array&quot;);
   &#125;;
</code></pre>
<p>is_trivialå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤§ä½œç”¨çš„type_traitsï¼Œè€ƒè™‘std::copyçš„ä¸€ç§å®ç°æ–¹å¼ï¼Œå¯¹trivial typeä½¿ç”¨memmove,å¯¹étrivial typeæ­£å¸¸æ‹·è´ï¼Œå¯æé«˜æ€§èƒ½ã€‚</p>
<h2 id="is-null-pointer"><a href="#is-null-pointer" class="headerlink" title="is_null_pointer"></a>is_null_pointer</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ç©ºæŒ‡é’ˆï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>ç©ºæŒ‡é’ˆè¯¥å¦‚ä½•åšç‰¹ä¾‹åŒ–ã€‚C++11æœ‰nullptr,æ˜¯nullptr_tç±»å‹(nullptr_tæ˜¯decltype(nullptr)çš„ä¸€ä¸ªåˆ«å), ç”±äºä»»ä½•å‹åˆ«çš„æŒ‡é’ˆç±»å‹éƒ½å¯ä»¥è½¬æ¢ä¸ºnullptr_tï¼Œæ‰€ä»¥ï¼Œå¯¹nullptr_tç±»å‹åšç‰¹ä¾‹åŒ–å³å¯ã€‚</p>
<p>å…³äºä»¥åçš„type_traitsï¼Œå¦‚æœè¿˜æ˜¯è€ç”Ÿå¸¸è°ˆçš„è®¾è®¡æ‰‹æ³•ã€‚å°±ä¸ä¼šå†è¯´äº†ï¼Œå°±åƒè¿™ä¸ªtype_traitsä¸€æ ·ã€‚</p>
<pre><code class="C++">  template&lt;typename&gt;
    struct __is_null_pointer_helper
    : public false_type &#123; &#125;;

  template&lt;&gt;
    struct __is_null_pointer_helper&lt;std::nullptr_t&gt;
    : public true_type &#123; &#125;;

  /// is_null_pointer (LWG 2247).
  template&lt;typename _Tp&gt;
    struct is_null_pointer
    : public __is_null_pointer_helper&lt;__remove_cv_t&lt;_Tp&gt;&gt;::type
    &#123; &#125;;
</code></pre>
<p>GCCè¿˜æä¾›äº†ä¸€ä¸ªä¸æ¨èä½¿ç”¨çš„æ‹“å±•ã€‚</p>
<pre><code class="C++">  /// __is_nullptr_t (deprecated extension).
  template&lt;typename _Tp&gt;
    struct __is_nullptr_t
    : public is_null_pointer&lt;_Tp&gt;
    &#123; &#125; _GLIBCXX_DEPRECATED_SUGGEST(&quot;std::is_null_pointer&quot;); //è¿™äº›å®å®åœ¨æ˜¯ä¸æƒ³æ·±ç©¶åˆ°åº•ï¼Œä»¤äººåŒçƒ¦çš„å®ï¼
</code></pre>
<h2 id="is-arithmetic"><a href="#is-arithmetic" class="headerlink" title="is_arithmetic"></a>is_arithmetic</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯å¯è¿ç®—çš„ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>æ•´å½¢ç±»å‹å’Œæµ®ç‚¹ç±»å‹è¢«è§†ä½œæ˜¯å¯è¿ç®—çš„ç±»å‹ï¼Œæ— è®ºæ˜¯å¦å…·æœ‰constæ€§è´¨ã€‚</p>
<blockquote>
<p>ä½ å¯èƒ½ä¼šæƒ³åˆ°ï¼Œå¦‚æœè‡ªå®šä¹‰ç±»å‹ä¹Ÿæ”¯æŒ+ - * &#x2F;ç­‰è¿ç®—ï¼Œæ˜¯ä¸æ˜¯è¿™ä¸ªtype_traitså°±ä¸å¥½ä½¿äº†å‘¢ï¼Ÿéš¾é“æœ‰bugå—ï¼Ÿ</p>
<p>ä½ å¯ä»¥å°†è¿™ä¸ªtype_traitsçœ‹ä½œä¸€ä¸ªè§„å®šã€‚å¹¶ä¸”ï¼Œä¸è¦ä¸ºä»»ä½•è‡ªå®šä¹‰ç±»å‹åšä»»ä½•çš„type_traitsçš„ç‰¹ä¾‹åŒ–ã€‚æ°¸è¿œä¸è¦ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæœªå®šä¹‰çš„è¡Œä¸ºã€‚æœ‰å…³æ›´å¤šï¼Œ è¯·çœ‹<a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/types/is_arithmetic">std::is_arithmetic - cppreference.com</a></p>
</blockquote>
<pre><code class="C++">  /// is_arithmetic
  template&lt;typename _Tp&gt;
    struct is_arithmetic
    : public __or_&lt;is_integral&lt;_Tp&gt;, is_floating_point&lt;_Tp&gt;&gt;::type
    &#123; &#125;;
</code></pre>
<h2 id="is-fundamental"><a href="#is-fundamental" class="headerlink" title="is_fundamental"></a>is_fundamental</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>å¯è¿ç®—ç±»å‹ï¼Œvoid, nullptr_tè¢«è§†ä½œä¸ºåŸºæœ¬ç±»å‹ï¼Œç†ç”±å’Œæ³¨æ„äº‹é¡¹åŒä¸Šã€‚</p>
<pre><code class="C++">  /// is_fundamental
  template&lt;typename _Tp&gt;
    struct is_fundamental
    : public __or_&lt;is_arithmetic&lt;_Tp&gt;, is_void&lt;_Tp&gt;,
           is_null_pointer&lt;_Tp&gt;&gt;::type
    &#123; &#125;;
</code></pre>
<h2 id="is-compound"><a href="#is-compound" class="headerlink" title="is_compound"></a>is_compound</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯å¤åˆç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>åªéœ€è¦å¯¹is_fundamentalçš„ç»“æœå–åï¼Œä¹Ÿå°±æ˜¯åº”ç”¨__not_å³å¯</p>
<pre><code class="C++">  /// is_compound
  template&lt;typename _Tp&gt;
    struct is_compound
    : public __not_&lt;is_fundamental&lt;_Tp&gt;&gt;::type &#123; &#125;;
</code></pre>
<h2 id="is-object"><a href="#is-object" class="headerlink" title="is_object"></a>is_object</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>è¿™é‡Œçš„objectæŒ‡çš„æ˜¯å¹¿ä¹‰ä¸Šçš„å¯¹è±¡ã€‚ä¾‹å¦‚int,doubleç±»å‹çš„å®ä¾‹çš†ç®—å¯¹è±¡ã€‚ä¾‹å¦‚ä½†å‡½æ•°ï¼Œå¼•ç”¨ï¼Œvoidç±»å‹ä¸ç®—åœ¨å†…ã€‚</p>
<pre><code class="C++">struct A &#123;
    int m_data = 0;
&#125;;
int main() &#123;
    cout &lt;&lt; std::is_object&lt;int&gt;::value &lt;&lt; endl;			//true
    cout &lt;&lt; std::is_object&lt;double&gt;::value &lt;&lt; endl;		//true
    cout &lt;&lt; std::is_object&lt;int&amp;&gt;::value &lt;&lt; endl; 		//false
    cout &lt;&lt; std::is_object&lt;A&gt;::value &lt;&lt; endl;			//true
    cout &lt;&lt; std::is_object&lt;void(int,int)&gt;::value &lt;&lt; endl;//false
    return 0;
&#125;
</code></pre>
<p>å®ç°</p>
<pre><code class="C++">/// is_object
template&lt;typename _Tp&gt;
  struct is_object
  : public __not_&lt;__or_&lt;is_function&lt;_Tp&gt;, is_reference&lt;_Tp&gt;,
                        is_void&lt;_Tp&gt;&gt;&gt;::type
  &#123; &#125;;
</code></pre>
<h2 id="is-scalar"><a href="#is-scalar" class="headerlink" title="is_scalar"></a>is_scalar</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ä¸€ä¸ªæ ‡é‡ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<blockquote>
<p>æ ‡é‡ç±»å‹åŒ…æ‹¬ç®—æ•°ç±»å‹ï¼Œæšä¸¾ç±»å‹ï¼ŒæŒ‡é’ˆï¼Œæˆå‘˜æŒ‡é’ˆï¼Œç©ºæŒ‡é’ˆ.å°†åœ¨é‚£äº›å…ƒå‡½æ•°åº”ç”¨äº__or_å³å¯</p>
</blockquote>
<pre><code class="C++">  /// is_scalar
  template&lt;typename _Tp&gt;
    struct is_scalar
    : public __or_&lt;is_arithmetic&lt;_Tp&gt;, is_enum&lt;_Tp&gt;, is_pointer&lt;_Tp&gt;, 
                   is_member_pointer&lt;_Tp&gt;, is_null_pointer&lt;_Tp&gt;&gt;::type
    &#123; &#125;;
</code></pre>
<h2 id="is-compound-1"><a href="#is-compound-1" class="headerlink" title="is_compound"></a>is_compound</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ä¸€ä¸ªå¤åˆç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<pre><code class="C++">  /// is_compound
  template&lt;typename _Tp&gt;
    struct is_compound // å¯¹is_fundamentalå–å¦å®šå³å¯
    : public __not_&lt;is_fundamental&lt;_Tp&gt;&gt;::type &#123; &#125;; 
</code></pre>
<h2 id="is-same"><a href="#is-same" class="headerlink" title="is_same"></a>is_same</h2><p>ä¼ å…¥ä¸¤ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ç›¸åŒç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>å¯¹&lt;_Tp, _Tp&gt;åšç‰¹ä¾‹åŒ–å³å¯ã€‚</p>
<pre><code class="C++">  /// is_same
 //ä¸‹é¢çœç•¥äº†ä¸€äº›æ¡ä»¶ç¼–è¯‘
  template&lt;typename _Tp, typename _Up&gt; //ä¸åŒç±»å‹çš„æ—¶å€™
    struct is_same
    : public false_type
    &#123; &#125;;

  template&lt;typename _Tp&gt;
    struct is_same&lt;_Tp, _Tp&gt; //ç›¸åŒç±»å‹çš„æ—¶å€™
    : public true_type
    &#123; &#125;;
</code></pre>
<h2 id="is-member-object-x2F-function-pointer"><a href="#is-member-object-x2F-function-pointer" class="headerlink" title="is_member_object&#x2F;function_pointer"></a>is_member_object&#x2F;function_pointer</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯æŒ‡å‘ç±»å†…éé™æ€æ•°æ®æˆå‘˜&#x2F;æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>åœ¨æ–‡ç« çš„æœ€åï¼Œæˆ‘å‡†å¤‡äº†ä¸€äº›æ›´åŠ é…·çš„ä¸œè¥¿ï¼Œå½“ç„¶ï¼Œä¹Ÿæ›´åŠ çš„å¤æ‚ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åº”å½“äº†è§£ä¸€ä¸‹åŸºæœ¬çš„åŸç†ï¼š</p>
<p>å¦‚æœAæ˜¯ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆå¯ä»¥æœ‰è¿™æ ·çš„ä¸€ç§æŒ‡é’ˆ<code>type A::*</code> æŒ‡å‘Aä¸­ç±»å‹ä¸ºtypeçš„æ•°æ®æˆå‘˜(éé™æ€çš„ï¼Œä¸‹æ–‡çœç•¥)ã€‚ç±»ä¼¼çš„ï¼Œè¿˜æœ‰æˆå‘˜å‡½æ•°æŒ‡é’ˆã€‚ä¾‹å¦‚</p>
<pre><code class="C++">struct A &#123;
    int a = 10;
    void inc_and_print() &#123;
        ++a;
        cout &lt;&lt; a &lt;&lt; endl;
    &#125;
&#125;;
int main() &#123;
    int A::* p = &amp;A::a;
    //ä½¿ç”¨
    A x;
    x.*p = 10; //å›ºå®šçš„è¯­æ³•å½¢å¼
    cout &lt;&lt; x.*p &lt;&lt; endl;   //10
    cout &lt;&lt; x.a &lt;&lt; endl;    //10

    using Fun = void (A::*)();
//    void(A::*fun)();
    Fun fun = &amp;A::inc_and_print;
    (x.*fun)(); //such as call A::inc_and_print //a is 11
    return 0;
&#125;
</code></pre>
<p>C++è¿˜æœ‰è¿™ç§è¯­æ³•ï¼Ÿä½ ä¼šç–‘é—®ï¼Œè¿™æ˜¯è‚¯å®šçš„ï¼ä½†è¿™æ— å…³ç´§è¦ï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ‰èƒ½ç”¨ä¸Šè¿™æ ·çš„è¯­æ³•ï¼Ÿè²Œä¼¼çœŸçš„æ²¡æœ‰ï¼Œé™¤äº†TMPã€‚</p>
<p>ä½ çŸ¥é“äº†è§£ä¸€ç‚¹ï¼Œå¦‚æœTæ˜¯ä¸€ä¸ªç±»ï¼Œåˆ™å¯ä»¥æœ‰<code>type T::*</code>è¿™æ ·çš„å½¢å¼æŒ‡å‘æ•°æ®æˆå‘˜&#x2F;æˆå‘˜å‡½æ•°ï¼Œä¸æ˜¯ç±»åˆ™æ²¡æœ‰ã€‚</p>
<p>å¹¶ä¸”è¿˜è¦è¯´æ˜çš„æ˜¯ï¼Œä¸è¦çº ç»“åœ¨è¿™äº›è¯­æ³•çš„çç¢ä¸Šï¼Œ<strong>Bjarne Stroustrup</strong>ä¹Ÿä¸ä¼šå¯¹æ‰€æœ‰çš„C++è¯­æ³•ç»†èŠ‚å’Œæ ‡å‡†å…¨éƒ¨ä¸€æ¸…äºŒæ¥šã€‚ä¸è¦é™·å…¥è¯­æ³•ç»†èŠ‚çš„æ·±æ¸Šâ€”â€”C++åœ¨æ‰¿å—ç€å·¨å¤§çš„å†å²åŒ…è¢±çš„åŒæ—¶ï¼Œè¿˜è¦æ·»åŠ ç°ä»£çš„è¯­æ³•ç‰¹æ€§ï¼Œæƒ³å­¦å®ŒC++â€”â€”â€”â€”ä¸‹è¾ˆå­è¯´ä¸å®šå¯ä»¥ï¼</p>
<p>å…³äºå…·ä½“çš„å®ç°ï¼Œè¯·çœ‹æºä»£ç ï¼Œæˆ‘ä¼šä¸€ç‚¹ç‚¹è¯´æ˜ã€‚</p>
<pre><code class="C++">template&lt;typename&gt;
    struct __is_member_object_pointer_helper //ä¸»æ¨¡æ¿ç»§æ‰¿false_type
    : public false_type &#123; &#125;;

  template&lt;typename _Tp, typename _Cp&gt;
    struct __is_member_object_pointer_helper&lt;_Tp _Cp::*&gt; //æ³¨æ„è¿™é‡Œæ²¡æœ‰é€—å·ï¼Œæ¨¡æ¿åŒ¹é…çš„æ—¶å€™ä¼šå°†ä¸€ä¸ªç±»å‹æ‹†åˆ†æˆä¸¤ä¸ªäº†ç±»å‹çš„ç»„åˆï¼Œå¥½å¤æ‚çš„è¯­æ³•ï¼Œå¯æ¶
      //åŒ¹é…åˆ°è¿™ä¸ªç‰¹ä¾‹åŒ–æ¨¡æ¿å¯ä»¥æ˜¯æ•°æ®æˆå‘˜æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥æ˜¯æˆå‘˜å‡½æ•°æŒ‡é’ˆã€‚å¦‚æœä¸æ˜¯æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼Œå°±æ˜¯æ•°æ®æˆå‘˜æŒ‡é’ˆäº†
    : public __not_&lt;is_function&lt;_Tp&gt;&gt;::type &#123; &#125;; 

  /// is_member_object_pointer
  template&lt;typename _Tp&gt;
    struct is_member_object_pointer 
    : public __is_member_object_pointer_helper&lt;__remove_cv_t&lt;_Tp&gt;&gt;::type
    &#123; &#125;;
</code></pre>
<p>å¤ªå¤æ‚äº†ï¼ä½ å¯èƒ½è¿˜æ˜¯å¯¹ä¸Šè¿°ä»£ç ä¸­çš„å“ªä¸ªç‰¹ä¾‹åŒ–æœ‰ç–‘é—®ï¼Œå¥½å§ï¼è®©æˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿã€‚æˆ‘ä»¬å¯¹ä¸Šè¿°çš„ä»£ç æ”¹é€ ä¸€ä¸‹ã€‚å¯¹äºé‚£ä¸ªç‰¹ä¾‹åŒ–ï¼Œæˆ‘ä»¬åœ¨å…¶å†…éƒ¨å®šä¹‰ä¸¤ä¸ªç±»å‹T1, T2ä¸º _Tp, _Cpçš„åˆ«åï¼Œ_Tp,_Cpåˆ°åº•è¢«æ¨æ–­ä¸ºä»€ä¹ˆç±»å‹ã€‚</p>
<pre><code class="C++">#include &lt;iostream&gt;
#include &lt;type_traits&gt;
namespace jan &#123;
    using std::__not_;
    using std::true_type;
      using std::false_type;
      using std::is_function;
     using std::__remove_cv_t;
    template&lt;typename&gt;
    struct __is_member_object_pointer_helper
    : public false_type &#123; &#125;;

     template&lt;typename _Tp, typename _Cp&gt;
    struct __is_member_object_pointer_helper&lt;_Tp _Cp::*&gt; 
    : public __not_&lt;is_function&lt;_Tp&gt;&gt;::type &#123; 
        using T1 = _Tp;	//è¿™é‡Œæ˜¯æˆ‘ä»¬æ·»åŠ çš„
        using T2 = _Cp;
    &#125;;

  /// is_member_object_pointer
  template&lt;typename _Tp&gt;
    struct is_member_object_pointer
    : public __is_member_object_pointer_helper&lt;__remove_cv_t&lt;_Tp&gt;&gt;::type
    &#123; &#125;;
&#125;

class A &#123; &#125;;
int main() &#123;
     jan::is_member_object_pointer&lt;int A::*&gt;::type t;
      return 0;
&#125;
</code></pre>
<p>ç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆè¿™æ ·çš„ä»£ç ã€‚</p>
<pre><code class="C++">#include &lt;iostream&gt;
#include &lt;type_traits&gt;
namespace jan
&#123;
  using std::__not_;
  template&lt;typename _Pp&gt;
  
  using std::true_type;
  using std::false_type;
  using std::is_function;
  template&lt;typename _Tp&gt;
  
  using std::__remove_cv_t;
  template&lt;typename std::_Tp&gt;
  using std::__remove_cv_t = typename remove_cv&lt;_Tp&gt;::type;
  
  template&lt;typename type_parameter_0_0&gt;
  struct __is_member_object_pointer_helper : public std::false_type
  &#123;
  &#125;;
  /****************************************æ³¨æ„çœ‹è¿™é‡Œ******************************************/
  /* First instantiated from: insights.cpp:23 */
  #ifdef INSIGHTS_USE_TEMPLATE
  template&lt;&gt;
  struct __is_member_object_pointer_helper&lt;int A::*&gt; : public std::integral_constant&lt;bool, true&gt;
  &#123;
    using T1 = int; //_Tp is int
    using T2 = A;   //_Cp is A
  &#125;;
  /******************************************************************************************/
  #endif
  template&lt;typename _Tp, typename _Cp&gt;
  struct __is_member_object_pointer_helper&lt;_Tp _Cp::*&gt; : public __not_&lt;is_function&lt;_Tp&gt; &gt;::type
  &#123;
    using T1 = _Tp;
    using T2 = _Cp;
  &#125;;
  
  template&lt;typename _Tp&gt; //åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ _Tp us int A::*
  struct is_member_object_pointer : public __is_member_object_pointer_helper&lt;__remove_cv_t&lt;_Tp&gt; &gt;::type
  &#123;
  &#125;;
  
  /* First instantiated from: insights.cpp:30 */
  #ifdef INSIGHTS_USE_TEMPLATE
  template&lt;&gt;
  struct is_member_object_pointer&lt;int A::*&gt; : public std::integral_constant&lt;bool, true&gt;
  &#123;
  &#125;;
  #endif 
&#125;
class A&#123; &#125;;
int main()
&#123;
    std::integral_constant&lt;bool, true&gt; t = std::integral_constant&lt;bool, true&gt;(); //è¿™é‡Œæ— å…³ç´§è¦
     return 0;
&#125;
</code></pre>
<p>æç„¶å¤§æ‚Ÿäº†å§ï¼</p>
<p>ç±»ä¼¼çš„<code>is_member_function_pointer</code>æœ‰è¿™æ ·çš„å®ç°ã€‚</p>
<pre><code class="C++">  template&lt;typename&gt;
    struct __is_member_function_pointer_helper
    : public false_type &#123; &#125;;

  template&lt;typename _Tp, typename _Cp&gt;
    struct __is_member_function_pointer_helper&lt;_Tp _Cp::*&gt;
//åŒ¹é…åˆ°è¿™ä¸ªç‰¹ä¾‹åŒ–æ¨¡æ¿å¯ä»¥æ˜¯æ•°æ®æˆå‘˜æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥æ˜¯æˆå‘˜å‡½æ•°æŒ‡é’ˆã€‚é‚£å°±ç”¨is_functionè¿™ä¸ªtype_traitsæ˜¯ä¸æ˜¯ä¸€ä¸ªå‡½æ•°å³å¯
    : public is_function&lt;_Tp&gt;::type &#123; &#125;; 

  /// is_member_function_pointer
  template&lt;typename _Tp&gt;
    struct is_member_function_pointer
    : public __is_member_function_pointer_helper&lt;__remove_cv_t&lt;_Tp&gt;&gt;::type
    &#123; &#125;;
</code></pre>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç¯‡å¤§éƒ¨åˆ†çš„æºç åˆ†æè¿˜æ˜¯è½»æ¾çš„ï¼Œé™¤äº†ä¸ªåˆ«çš„åˆºå¤´ã€‚</p>
<p>ä½ å¬è¯´è¿‡brainfuckè¿™ä¸ªè¯­è¨€å—ï¼Ÿç›¸æ¯”äºbrainfuckè¿™ä¸ªè¯­è¨€ï¼ŒC++æ‰æ˜¯çœŸæ­£çš„brainfunk! </p>
<p>æˆ‘çš„ğŸ§ è¦çˆ†ç‚¸äº†ï¼ï¼ï¼</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Modern-C/" style="color: #00bcd4">
                Modern C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C/" style="color: #ffa2c4">
                C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C-Library/" style="color: #ff7d73">
                C++ Library
            </a>
        </span>
        
    </div>
    <a href="/2022/09/26/type-traitsæºç åˆ†æ-äºŒ-/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2022/09/26/type-traitsæºç åˆ†æ-ä¸€-/">
        <h2 class="post-title">Type_traitsæºç åˆ†æ(ä¸€)</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/26
        </span>
    </div>
    <div class="excerpt">
        <div class="content" v-pre>
            
            <h1 id="type-traitsæ¦‚è¿°"><a href="#type-traitsæ¦‚è¿°" class="headerlink" title="type_traitsæ¦‚è¿°"></a>type_traitsæ¦‚è¿°</h1><p>tyep_traitsæ˜¯C++TMPä¸­ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯Modern C++ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ã€‚ä»»ä½•ä¸€ä½C++ç¨‹åºå‘˜ï¼Œå¦‚æœæƒ³å­¦ä¹ Modern C++ï¼Œæƒ³å­¦å·Modern C++ï¼Œè‚¯å®šä¸èƒ½é¿å…å­¦ä¹ type_traitsã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯type-traits"><a href="#ä»€ä¹ˆæ˜¯type-traits" class="headerlink" title="ä»€ä¹ˆæ˜¯type_traits?"></a>ä»€ä¹ˆæ˜¯type_traits?</h2><p>type_traitsï¼Œé¡¾åæ€ä¹‰ï¼Œä¸ºç±»å‹èƒå–å™¨&#x2F;ç±»å‹ç‰¹å¾ã€‚type_traitsæ˜¯ä¸€ç³»åˆ—çš„å…ƒå‡½æ•°ã€‚åœ¨æ™®é€šå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥æ•°æ®ï¼Œè¿”å›æ•°æ®ã€‚ä½†æ˜¯åœ¨å…ƒå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥ç±»å‹&#x2F;å¸¸é‡ï¼Œè¿”å›ç±»å‹&#x2F;å¸¸é‡ã€‚</p>
<p>C++ type_traitsçš„å®ç°,ä¹Ÿå°±æ˜¯å…ƒå‡½æ•°çš„ä¸€èˆ¬å½¢å¼, ä½¿ç”¨ç»“æ„ä½“+æ¨¡æ¿(æ¨¡å¼åŒ¹é…+æ¨¡æ¿åç‰¹åŒ–)çš„æ–¹å¼ã€‚</p>
<p>ä½¿ç”¨&lt;&gt;æ¥ä¼ å…¥ç±»å‹(è¯­æ³•å±‚é¢çš„), ä½¿ç”¨::value&#x2F;::typeæ¥è·å¾—è¿”å›å€¼&#x2F;è¿”å›ç±»å‹(çº¦å®šä¿—æˆçš„)ã€‚<br>ä¾‹å¦‚<code>std::true_type::value == true</code>,<code>std::false_type::value == false</code>,<code>std::remove_const&lt;const int&gt;::value</code></p>
<p>æ‰€æœ‰çš„type_traitsæ“ä½œå‡å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶æœŸã€‚</p>
<h2 id="type-traitèƒ½å¤Ÿå¹²ä»€ä¹ˆ"><a href="#type-traitèƒ½å¤Ÿå¹²ä»€ä¹ˆ" class="headerlink" title="type_traitèƒ½å¤Ÿå¹²ä»€ä¹ˆ?"></a>type_traitèƒ½å¤Ÿå¹²ä»€ä¹ˆ?</h2><p>type_traitsä¸ä»…æ˜¯æ ‡å‡†åº“çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¹Ÿæ˜¯æ¨¡æ¿å…ƒç¼–ç¨‹ä¸­çš„åŸºæœ¬æŠ€èƒ½ã€‚</p>
<p>æ ‡å‡†åº“ä¸­çš„ç±»å‹å®‰å…¨ä¹Ÿå¤šäºäº†type_traitsï¼Œåœ¨å„ç§C++åº“ä¸­ä¹Ÿæ€»æ˜¯èƒ½çœ‹åˆ°type_traitsçš„èº«å½±ã€‚</p>
<h1 id="type-traitsä¸­çš„çº¦å®š"><a href="#type-traitsä¸­çš„çº¦å®š" class="headerlink" title="type_traitsä¸­çš„çº¦å®š"></a>type_traitsä¸­çš„çº¦å®š</h1><p>type_traitså‘å±•äº†å¾ˆé•¿çš„æ—¶é—´ï¼ŒC++æ ‡å‡†æ¼”åŒ–å‡ºæ¥äº†ä¸€å¥—è§„å®š<br>é€šç”¨çš„è§„å®š</p>
<ul>
<li>ä½¿ç”¨::valueæ¥è¡¨ç¤ºè¿”å›å€¼(å€¼å…ƒå‡½æ•°)</li>
<li>ä½¿ç”¨::typeæ¥è¡¨ç¤ºè¿”å›ç±»å‹(ç±»å‹å…ƒå‡½æ•°)</li>
<li>æ¯ä¸ªå…ƒå‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªç±»å‹æˆ–è€…ä¸€ä¸ªå€¼</li>
<li>å…ƒå‡½æ•°å¯ä»¥åŒæ—¶æ˜¯å€¼å…ƒå‡½æ•°å’Œç±»å‹å…ƒå‡½æ•°</li>
<li>å…ƒå‡½æ•°å¿…é¡»æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»</li>
<li>å¯¹äºä¸€ä¸ªtype_traits,å½¢å¦‚XXX_tçš„å½¢å¼æ˜¯ä¸€ä¸ªç±»å‹åº”ç”¨XXXåçš„è¿”å›ç±»å‹</li>
<li>å¯¹äºä¸€ä¸ªtype_traits,å½¢å¦‚XXX_vçš„å½¢å¼æ˜¯ä¸€ä¸ªç±»å‹åº”ç”¨XXXåçš„è¿”å›å€¼(C++17)</li>
</ul>
<p>å¯¹äºä¸€å…ƒtype_traitsçš„è§„å®š</p>
<ul>
<li>æ¥å—ä¸€ä¸ªç±»å‹å‚æ•° + å¯é€‰çš„è¾…åŠ©é™„åŠ å‚æ•°</li>
<li>å¿…é¡»å¯ä»¥é»˜è®¤æ„é€ </li>
<li>å¿…é¡»å¯ä»¥æ‹·è´æ„é€ </li>
<li>å¿…é¡»å…¬å¼€ä¸”æ— æ­§ä¹‰</li>
<li>æ‰€æœ‰çš„ä¸€å…ƒå…ƒå‡½æ•°éƒ½å¿…é¡»ä»std::integral_constantç»§æ‰¿</li>
<li>åŸºæœ¬çš„ç‰¹å¾æˆå‘˜ä¸åº”è¯¥è¢«éšè—ï¼Œè€Œä¸”æ˜ç¡®å¯ç”¨</li>
</ul>
<p>å¯¹äºäºŒå…ƒå…ƒå‡½æ•°çš„è§„å®š</p>
<ul>
<li>æ¥å—æœ‰ä¸¤ä¸ªç±»å‹å‚æ•° + å¯é€‰çš„è¾…åŠ©é™„åŠ å‚æ•°</li>
<li>å¿…é¡»å¯ä»¥é»˜è®¤æ„é€ </li>
<li>å¿…é¡»å¯ä»¥æ‹·è´æ„é€ </li>
<li>å¿…é¡»å…¬å¼€ä¸”æ— æ­§ä¹‰</li>
<li>æ‰€æœ‰çš„ä¸€å…ƒå…ƒå‡½æ•°éƒ½å¿…é¡»ä»std::integral_constantçš„ç‰¹ä¾‹åŒ–ç»§æ‰¿</li>
<li>åŸºæœ¬çš„ç‰¹å¾æˆå‘˜ä¸åº”è¯¥è¢«éšè—ï¼Œè€Œä¸”æ˜ç¡®å¯ç”¨</li>
</ul>
<p>å¯¹äºtransformation-traitsçš„è§„å®š</p>
<ul>
<li>æ¥å—ä¸€ä¸ªç±»å‹å‚æ•° + å¯é€‰çš„è¾…åŠ©é™„åŠ å‚æ•°</li>
<li>å®šä¹‰ä¸€ä¸ªpublicçš„åä¸ºtypeçš„åµŒå¥—ç±»å‹</li>
<li>æ²¡æœ‰é»˜è®¤&#x2F;æ‹·è´æ„é€ çš„è¦æ±‚(å¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰)</li>
</ul>
<blockquote>
<p>ä½ ä¼šå‘ç°æ ‡å‡†åº“çš„æœ‰äº›åœ°æ–¹æ²¡æœ‰éµå®ˆè¿™ä¸ªæ ‡å‡†â€”â€”é‚£äº›ä»£ç æ˜¯åœ¨è¿™ä¸ªæ ‡å‡†æ²¡æœ‰æˆå‹ä¹‹å‰ï¼Œä¾‹å¦‚è¿­ä»£å™¨æœ‰å…³çš„ç±»å‹èƒå–</p>
</blockquote>
<h1 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h1><p>æœ¬ç¯‡æ–‡ç« ä½¿ç”¨gccç¼–è¯‘å™¨ï¼Œä¼šæåˆ°17,20ä¸­çš„type_traits,è¯·ç¡®ä¿ä½ æ‰€ç”¨çš„ç¼–è¯‘å™¨æ”¯æŒ17ï¼Œ20</p>
<p>å¯¹äºæœ‰äº›æ¡ä»¶ç¼–è¯‘ï¼Œä¸åˆ—å‡ºæºç å¹¶ä¸”ä¸åˆ†æ</p>
<p>æˆ‘ä¼šå°†å…ƒå‡½æ•°å’Œtype_traitsç­‰ä»·èµ·æ¥ï¼Œå¦‚æœæ–‡ä¸­è¯´å…ƒå‡½æ•°ï¼Œä½ å¯ä»¥è”ç³»ä¸Šä¸‹æ–‡æŠŠå…¶å½“ä½œtype_traitsã€‚åä¹‹äº¦ç„¶ã€‚</p>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>æ ‡å‡†åº“å¯¹äºtype_traitsçš„å®ç°ï¼Œæ”¾åœ¨äº†type_traitsä¸­</p>
<h2 id="integral-constant"><a href="#integral-constant" class="headerlink" title="integral_constant"></a>integral_constant</h2><pre><code class="C++"> template&lt;typename _Tp, _Tp __v&gt;
    struct integral_constant
    &#123;
      static constexpr _Tp                  value = __v;
      typedef _Tp                           value_type;
      typedef integral_constant&lt;_Tp, __v&gt;   type;
      constexpr operator value_type() const noexcept &#123; return value; &#125;
    //æœ‰constexpræ€§è´¨ï¼Œå¯ä»¥ç¼–è¯‘æ—¶æœŸæ±‚å€¼
      constexpr value_type operator()() const noexcept &#123; return value; &#125;
    &#125;;
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹è§integral_constantå®šä¹‰çš„å¾ˆç®€å•ï¼Œè®°å¾—unixçš„å“²å­¦å—? less is more! å‡ ä¹æ‰€æœ‰çš„type_traitséƒ½ä¼šç›´æ¥çš„æˆ–è€…é—´æ¥çš„ç»§æ‰¿integral_constant</p>
<h2 id="true-type-false-type"><a href="#true-type-false-type" class="headerlink" title="true_type false_type"></a>true_type false_type</h2><p><code>true_type</code>,<code>false_type</code>ä»…ä»…æ˜¯integral_constantçš„åˆ«åï¼Œå®šä¹‰å¦‚ä¸‹</p>
<pre><code class="C++">  /// The type used as a compile-time boolean with true value.
  typedef integral_constant&lt;bool, true&gt;     true_type;

  /// The type used as a compile-time boolean with false value.
  typedef integral_constant&lt;bool, false&gt;    false_type;
</code></pre>
<p>å¾ˆå¤šçš„å…ƒå‡½æ•°éƒ½ç»§æ‰¿è¿™ä¸¤ä¸ªç±»å‹ï¼Œä¾‹å¦‚is_XXXç­‰å…ƒå‡½æ•°ã€‚</p>
<h2 id="bool-constant"><a href="#bool-constant" class="headerlink" title="bool_constant"></a>bool_constant</h2><p>å¾ˆå¥½ç†è§£</p>
<pre><code class="C++">  /// The type used as a compile-time boolean with true value.
  typedef integral_constant&lt;bool, true&gt;     true_type;

  /// The type used as a compile-time boolean with false value.
  typedef integral_constant&lt;bool, false&gt;    false_type;
</code></pre>
<h2 id="conditional"><a href="#conditional" class="headerlink" title="conditional"></a>conditional</h2><p>conditionalæ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¸€ä¸ªboolå€¼ï¼Œä¸¤ä¸ªç±»å‹å‚æ•°ï¼Œä½œç”¨ç›¸å½“äºç¼–è¯‘æ—¶æœŸçš„ifï¼Œå¯ä»¥è¿™æ ·æè¿°</p>
<p><code>&lt;bool p, T1, T2&gt; p ? T1 : T2</code></p>
<pre><code class="C++">//å‰ç½®å£°æ˜
template&lt;bool, typename, typename&gt;
    struct conditional;  
...
/// Define a member typedef @c type to one of two argument types.
  template&lt;bool _Cond, typename _Iftrue, typename _Iffalse&gt; //ä¸»æ¨¡æ¿
    struct conditional
    &#123; typedef _Iftrue type; &#125;;

  // Partial specialization for false.
  template&lt;typename _Iftrue, typename _Iffalse&gt;		//ç‰¹åŒ–æ¨¡æ¿
    struct conditional&lt;false, _Iftrue, _Iffalse&gt;
    &#123; typedef _Iffalse type; &#125;;
</code></pre>
<h2 id="type-identity"><a href="#type-identity" class="headerlink" title="__type_identity"></a>__type_identity</h2><p>å…³äºä¸ªå…ƒå‡½æ•°ï¼Œæ²¡æœ‰æ˜ç¡®çš„è§„å®šï¼Œå¯ä»¥æ•™type_is,æˆ–è€…å…¶ä»–çš„ä¸œè¥¿ã€‚æ¯ä¸ªæ ‡å‡†åº“çš„å®ç°éƒ½æœ‰æ‰€ä¸åŒã€‚ä½œç”¨å°±æ˜¯ç»™å®šä¸€ä¸ªTç±»å‹ï¼Œè¿”å›ä¸€ä¸ªTç±»å‹ï¼Œç”¨äºè¢«å…¶ä»–å…ƒå‡½æ•°ç»§æ‰¿ã€‚</p>
<pre><code class="C++">  template &lt;typename _Type&gt;
    struct __type_identity
    &#123; using type = _Type; &#125;;

  template&lt;typename _Tp&gt;
    using __type_identity_t = typename __type_identity&lt;_Tp&gt;::type;
</code></pre>
<h2 id="logic-traits"><a href="#logic-traits" class="headerlink" title="logic traits"></a>logic traits</h2><p>åˆå–ï¼Œæå–ï¼Œå¦å®š traitsã€‚å…¶ä¸­<code>conjunction</code>ã€<code>disjunction</code>ã€<code>negation</code>åœ¨å®šä¹‰äº†å®<code>__cpp_lib_logical_traits 201510</code>æ‰å¯ç”¨</p>
<h3 id="or"><a href="#or" class="headerlink" title="__or_"></a><strong>__or_</strong></h3><p>ç±»ä¼¼orå…³é”®å­—ï¼Œ__or_å…ƒå‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°åŒ…ï¼Œå¯¹è¿™äº›ç±»å‹çš„è¿”å›å€¼æ±‚æå–</p>
<pre><code class="C++">template&lt;typename...&gt;
    struct __or_; //ä¸»æ¨¡æ¿æ°¸è¿œä¸èƒ½è¢«åŒ¹é…åŒ¹é…åˆ°ï¼Œæ‰€ä»¥ä¸ç”¨å®šä¹‰

  template&lt;&gt;
    struct __or_&lt;&gt;	//å¦‚æœæ²¡æœ‰ç±»å‹ï¼Œç»§æ‰¿true_type
    : public false_type
    &#123; &#125;;

  template&lt;typename _B1&gt;
    struct __or_&lt;_B1&gt; //æœ‰ä¸€ä¸ªç±»å‹ç»§æ‰¿å“ªä¸ªç±»å‹
    : public _B1
    &#123; &#125;;

  template&lt;typename _B1, typename _B2&gt; //å¦‚æœæ—¶ä¸¤ä¸ªç±»å‹ï¼Œé€’å½’çš„ç»§æ‰¿
    struct __or_&lt;_B1, _B2&gt;
    : public conditional&lt;_B1::value, _B1, _B2&gt;::type 
    //if _B1::value==trueï¼Œé‚£ä¹ˆä¸å†åˆ¤æ–­ï¼Œç»§æ‰¿_B1å³å¯ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ˜¯::valueçš„è¿™ä¸ªè¿”å›å€¼ã€‚
    //if _B1::value==false, åˆ™ç»§æ‰¿_B2ï¼Œæ­¤æ—¶_B2åŒ¹é…åˆ°æ¥å—ä¸€ä¸ªå‚æ•°çš„ç‰¹ä¾‹åŒ–
    &#123; &#125;;

  template&lt;typename _B1, typename _B2, typename _B3, typename... _Bn&gt; //æ¥å—å¤šä¸ªç±»å‹
    struct __or_&lt;_B1, _B2, _B3, _Bn...&gt;
    : public conditional&lt;_B1::value, _B1, __or_&lt;_B2, _B3, _Bn...&gt;&gt;::type
    //if _B1::value==trueåŒç†
    //if _B1::value==false, é€’å½’çš„ç»§æ‰¿__or_&lt;_B2, _B3, _Bn...&gt;
    &#123; &#125;;
</code></pre>
<pre><code class="C++">//è¿™ç§è¯­æ³•æ˜¯C++17æ·»åŠ è¿›æ¥çš„ï¼Œä¹Ÿå¾ˆæœ‰æ•ˆçš„ç®€åŒ–äº†æ¨¡æ¿å…ƒç¼–ç¨‹çš„å¤æ‚æ€§
template&lt;typename... _Bn&gt;
    inline constexpr bool __or_v = __or_&lt;_Bn...&gt;::value; //__or_vå³æ˜¯ç±»å‹ç”¨ç”¨äº__or_våçš„è¿”å›
//__and_våŒ
</code></pre>
<h3 id="and"><a href="#and" class="headerlink" title="__and_"></a><strong>__and_</strong></h3><p>__and_çš„åŠŸèƒ½å’Œå®ç°ä¸__or_çš„åŠŸèƒ½å’Œå®ç°å¤§åŒå°å¼‚</p>
<pre><code class="C++">  template&lt;typename...&gt;
    struct __and_;

  template&lt;&gt;
    struct __and_&lt;&gt;
    : public true_type //è¿™é‡Œç»§æ‰¿true_type
    &#123; &#125;;

  template&lt;typename _B1&gt;
    struct __and_&lt;_B1&gt;
    : public _B1
    &#123; &#125;;

  template&lt;typename _B1, typename _B2&gt;
    struct __and_&lt;_B1, _B2&gt;
    : public conditional&lt;_B1::value, _B2, _B1&gt;::type //è¿™é‡Œçš„ç±»å‹æ’åˆ—ç›¸è¾ƒäº__or_æ˜¯åçš„
    &#123; &#125;;

  template&lt;typename _B1, typename _B2, typename _B3, typename... _Bn&gt;
    struct __and_&lt;_B1, _B2, _B3, _Bn...&gt;
    : public conditional&lt;_B1::value, __and_&lt;_B2, _B3, _Bn...&gt;, _B1&gt;::type //ç±»å‹æ’åˆ—åŒä¸Š
    &#123; &#125;;
</code></pre>
<pre><code class="C++">  template&lt;typename... _Bn&gt;
    inline constexpr bool __and_v = __and_&lt;_Bn...&gt;::value;
</code></pre>
<h3 id="not"><a href="#not" class="headerlink" title="__not_"></a><strong>__not_</strong></h3><p>__not_å¯¹ç»™å®šç±»å‹çš„::valueè¿”å›å€¼å–å,å®ç°éå¸¸çš„ç®€å•</p>
<pre><code class="C++">  template&lt;typename _Pp&gt;
    struct __not_
    : public __bool_constant&lt;!bool(_Pp::value)&gt; //è¿™é‡Œæœ‰ä¸€ä¸ªå¼ºè½¬
    &#123; &#125;;
</code></pre>
<h3 id="conjunction"><a href="#conjunction" class="headerlink" title="conjunction"></a><strong>conjunction</strong></h3><p>åˆå–ï¼ŒåŠŸèƒ½å’Œ__or_ä¸€æ ·ï¼Œé€šè¿‡ç»§æ‰¿å…¶å®ç°ã€‚</p>
<pre><code class="C++">  template&lt;typename... _Bn&gt;
    struct conjunction
    : __and_&lt;_Bn...&gt;
    &#123; &#125;;
</code></pre>
<pre><code class="C++">template&lt;typename... _Bn&gt;
    inline constexpr bool conjunction_v = conjunction&lt;_Bn...&gt;::value;
</code></pre>
<h3 id="disjunction"><a href="#disjunction" class="headerlink" title="disjunction"></a><strong>disjunction</strong></h3><p>æå–ï¼ŒåŒä¸Š</p>
<pre><code class="C++">  template&lt;typename... _Bn&gt;
    struct disjunction
    : __or_&lt;_Bn...&gt;
    &#123; &#125;;
</code></pre>
<pre><code class="C++">   template&lt;typename... _Bn&gt;
    inline constexpr bool disjunction_v = disjunction&lt;_Bn...&gt;::value;
</code></pre>
<h3 id="negation"><a href="#negation" class="headerlink" title="negation"></a><strong>negation</strong></h3><p>å¦å®šï¼ŒåŒä¸Š</p>
<pre><code class="C++">  template&lt;typename _Pp&gt;
    struct negation
    : __not_&lt;_Pp&gt;
    &#123; &#125;;
</code></pre>
<pre><code class="C++">  template&lt;typename _Pp&gt;
    inline constexpr bool negation_v = negation&lt;_Pp&gt;::value;
</code></pre>
<h2 id="is-l-x2F-r-reference"><a href="#is-l-x2F-r-reference" class="headerlink" title="is_l&#x2F;r reference"></a>is_l&#x2F;r reference</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ä¸€ä¸ªå·¦å€¼&#x2F;å³å€¼å¼•ç”¨ç±»å‹ï¼Œå¦‚æœå…·æœ‰ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_type</p>
<pre><code class="C++">  /// is_lvalue_reference
  template&lt;typename&gt;		//ä¸»æ¨¡æ¿ç»§æ‰¿false_type
    struct is_lvalue_reference
    : public false_type &#123; &#125;;

  template&lt;typename _Tp&gt;
    struct is_lvalue_reference&lt;_Tp&amp;&gt; //å¯¹äºå·¦å€¼å¼•ç”¨çš„ç‰¹ä¾‹åŒ–ï¼Œç»§æ‰¿true_type
    : public true_type &#123; &#125;;

  /// is_rvalue_reference
  template&lt;typename&gt;			//åŒä¸Š
    struct is_rvalue_reference
    : public false_type &#123; &#125;;

  template&lt;typename _Tp&gt;		//åŒä¸Š
    struct is_rvalue_reference&lt;_Tp&amp;&amp;&gt;
    : public true_type &#123; &#125;;
</code></pre>
<h2 id="is-reference"><a href="#is-reference" class="headerlink" title="is_reference"></a>is_reference</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œå¦‚æœå…·æœ‰ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_type</p>
<pre><code class="C++">template&lt;typename&gt;
struct is_reference; //å£°æ˜

template&lt;typename _Tp&gt;
struct is_reference 		//å·¦å€¼å¼•ç”¨/å³å€¼å¼•ç”¨
    : public __or_&lt;is_lvalue_reference&lt;_Tp&gt;, è¿™é‡Œç”¨__or_æ¥å®ç°
                   is_rvalue_reference&lt;_Tp&gt;&gt;::type
&#123; &#125;;
</code></pre>
<h2 id="is-const"><a href="#is-const" class="headerlink" title="is_const"></a>is_const</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯å¦å…·æœ‰constæ€§è´¨ï¼Œå¦‚æœå…·æœ‰ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>é€šè¿‡æ™®é€šçš„æ¨¡æ¿ç‰¹åŒ–å°±å¯ä»¥å®ç°</p>
<pre><code class="C++">  /// is_const
  template&lt;typename&gt;
    struct is_const
    : public false_type &#123; &#125;;

  template&lt;typename _Tp&gt;
    struct is_const&lt;_Tp const&gt; //å¯¹äºconstçš„ç‰¹åŒ–
    : public true_type &#123; &#125;;
</code></pre>
<p>æ³¨æ„ï¼Œå¯¹äº&amp;&#x2F;&amp;&amp;is_constçš„è¿”å›ç±»å‹æ˜¯ä¸€ä¸ª::false_type,å°±æ˜¯æ‰€<code>std::is_const&lt;const int &amp;&gt;::value==false</code></p>
<p>ç±»ä¼¼çš„ï¼Œè¿˜æœ‰<code>const int *</code>ä¹Ÿæ˜¯ä¸€æ ·ã€‚å› ä¸ºè¿™æ ·çš„è¯­ä¹‰è¡¨ç¤ºçš„æŒ‡å‘çš„å¯¹è±¡æ˜¯å¸¸é‡æ€§è´¨çš„ï¼Œè€Œä¸æ˜¯å¼•ç”¨&#x2F;æŒ‡é’ˆæœ¬èº«æ˜¯å¸¸é‡æ€§è´¨çš„ã€‚</p>
<h2 id="is-volatile"><a href="#is-volatile" class="headerlink" title="is_volatile"></a>is_volatile</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯å¦å…·æœ‰volatileæ€§è´¨ï¼Œå¦‚æœå…·æœ‰ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>å®ç°æ–¹å¼å’Œis_constå¤§åŒå°å¼‚</p>
<pre><code class="C++">  template&lt;typename&gt;
    struct is_volatile
    : public false_type &#123; &#125;;

  template&lt;typename _Tp&gt;
    struct is_volatile&lt;_Tp volatile&gt;
    : public true_type &#123; &#125;;
</code></pre>
<h2 id="is-function"><a href="#is-function" class="headerlink" title="is_function"></a>is_function</h2><p>ä¼ å…¥ä¸€ä¸ªç±»å‹ï¼Œè¿”å›å…¶æ˜¯ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå¦‚æœå…·æœ‰ï¼Œè¿”å›å€¼&#x2F;ç±»å‹ä¸º true&#x2F;true_type, å¦åˆ™è¿”å›false&#x2F;false_typeã€‚</p>
<p>C++è¿˜æœ‰è¿™æ ·çš„åŠŸèƒ½ï¼è¿™æ˜¯é»‘é­”æ³•å—ï¼Ÿ</p>
<p>è¿™ä¸æ˜¯ä»€ä¹ˆé»‘é­”æ³•ï¼Œä½†ç¡®å®å¤Ÿé…·ã€‚åœ¨ä½ æƒŠå¹ä»–çš„æ—¶å€™ï¼Œåº”å½“äº†è§£ä¸€ä¸‹åŸç†ã€‚</p>
<p>å¯¹äºä¸€ä¸ªTç±»å‹ï¼Œå¦‚æœå…¶æ˜¯ä¸€ä¸ªå‡½æ•°&#x2F;&amp;ï¼Œå¯¹å…¶æ·»åŠ constä¸ä¼šå‘æˆä»»ä½•ç±»å‹ä¸Šçš„å˜åŒ–ã€‚ä¾‹å¦‚</p>
<pre><code class="C++">void fun() &#123; &#125;
template &lt;typename T&gt;
struct add_const &#123;
  using type = const T;
&#125;;
int main() &#123;
    typename add_const&lt;decltype(fun)&gt;::type c;
  return 0;
&#125;
</code></pre>
<p>ç¼–è¯‘å™¨ä¼šç”Ÿæˆè¿™æ ·çš„ä»£ç </p>
<pre><code class="C++">void fun()
&#123;
&#125;

template&lt;typename T&gt;
struct add_const
&#123;
  using type = const T;
&#125;;

/* First instantiated from: insights.cpp:10 */
#ifdef INSIGHTS_USE_TEMPLATE
template&lt;&gt;
struct add_const&lt;void ()&gt; 
&#123;
  using type = void (); //ç±»å‹ä¸Šæ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–
&#125;;

#endif

int main()
&#123;
  void c();
  return 0;
&#125;
</code></pre>
<p>åŸºäºè¿™ä¸ªåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å®ç°è¿™ä¸ªå…ƒå‡½æ•°ã€‚è€ƒè™‘åˆ°å¯¹äº<code>const T &amp;</code>,<code>const T &amp;&amp;</code>(Tä¸æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹) åº”ç”¨is_const:value&#x3D;&#x3D;false &amp;&#x2F;&amp;&amp;ç»§æ‰¿false_type,ä¸»æ¨¡æ¿æ·»åŠ constæ€§è´¨ä¹‹ååˆ¤æ–­å¾—åˆ°çš„ç±»å‹æ˜¯ä¸æ˜¯å…·æœ‰constæ€§è´¨ã€‚</p>
<pre><code class="C++">  template&lt;typename&gt;
    struct is_function;
  /// is_function
  template&lt;typename _Tp&gt;
    struct is_function
    : public __bool_constant&lt;!is_const&lt;const _Tp&gt;::value&gt; &#123; &#125;;
    
//å¯¹å¼•ç”¨è€ƒè™‘å³å¯ï¼Œå¯¹æŒ‡é’ˆæ·»åŠ constå˜ä¸º*const
  template&lt;typename _Tp&gt;
    struct is_function&lt;_Tp&amp;&gt; 
    : public false_type &#123; &#125;;

  template&lt;typename _Tp&gt;
    struct is_function&lt;_Tp&amp;&amp;&gt;
    : public false_type &#123; &#125;;
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Modern-C/" style="color: #00bcd4">
                Modern C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C/" style="color: #ff7d73">
                C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C-Library/" style="color: #03a9f4">
                C++ Library
            </a>
        </span>
        
    </div>
    <a href="/2022/09/26/type-traitsæºç åˆ†æ-ä¸€-/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2022/09/22/unique-ptræºç è§£æ/">
        <h2 class="post-title">Unique_ptræºç è§£æ</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/22
        </span>
    </div>
    <div class="excerpt">
        <div class="content" v-pre>
            
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™ç¯‡åšå®¢æ˜¯å¯¹unique_ptræºä»£ç çš„åˆ†æï¼Œæœ¬æ–‡ä½¿ç”¨çš„ç¼–è¯‘å™¨æ˜¯MinGW</p>
<p>æœ¬ç¯‡æ–‡ç« ä¸ä¿è¯èƒ½å¤Ÿè¯´æ˜æ¸…æ¥šunique_ptrå®ç°çš„æ‰€æœ‰ç»†èŠ‚ä»¥åŠåŸå› ï¼Œä½†ä¼šå°½å¯èƒ½çš„åšåˆ°è¿™æ ·</p>
<p>éœ€è¦è¯»è€…æœ‰TMPçš„åŸºç¡€ï¼Œä¾‹å¦‚ç†Ÿæ‚‰std::enable_if, std::remove_refereneç­‰ç­‰çš„å…ƒå‡½æ•°</p>
<p>æœ¬ç¯‡æ–‡ç« ä¸æ˜¯ä¸€ä¸ªunique_ptrçš„ä½¿ç”¨æ•™ç¨‹ï¼Œä½†æ˜¯ä¼šæåŠåˆ°ä¸€äº›ä½¿ç”¨ä¸­çš„ç»†èŠ‚</p>
<h2 id="æœ¯è¯­çº¦å®š"><a href="#æœ¯è¯­çº¦å®š" class="headerlink" title="æœ¯è¯­çº¦å®š"></a>æœ¯è¯­çº¦å®š</h2><ul>
<li>å¯¹å†…ç½®æŒ‡é’ˆæœ‰æ—¶å€™ç§°å…¶ä¸ºraw-pointer&#x2F;è£¸æŒ‡é’ˆ</li>
<li>å¯¹äºunique_ptrçš„æŒ‡å‘å †åŒºå¯¹è±¡çš„æŒ‡é’ˆï¼Œæœ‰æ—¶å€™ç§°å…¶ä¸ºå†…éƒ¨æŒ‡é’ˆï¼Œæœ‰æ—¶å€™ç§°å…¶ä¸ºæŒ‡å‘å †åŒºçš„æŒ‡é’ˆï¼Œæˆ–è€…å…¶ä»–ç§°å‘¼ã€‚è¯·è”ç³»ä¸Šä¸‹æ–‡åˆ¤åˆ«äºå†…ç½®æŒ‡é’ˆçš„åŒºåˆ«ã€‚</li>
<li>å¯¹äºç±»å‹éœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºçº¦æŸæ¡ä»¶</li>
</ul>
<h2 id="æè¿°çº¦å®š"><a href="#æè¿°çº¦å®š" class="headerlink" title="æè¿°çº¦å®š"></a>æè¿°çº¦å®š</h2><ul>
<li>å¯¹äºå¤§éƒ¨åˆ†çš„ç¯‡å¹…ï¼Œéƒ½ä¼šä½¿ç”¨æºä»£ç +æ³¨é‡Šçš„æ–¹å¼æ¥æè¿°ã€‚å¦‚æœä¸€ä¸ªé—®é¢˜ä½¿ç”¨æ³¨é‡Šæè¿°ç¯‡å¹…è¿‡å¤§ï¼Œä¼šå•ç‹¬æ‹¿å‡ºæ¥è¯´æ˜</li>
<li>å¯¹äºæ‰€æœ‰çš„æºç æ³¨é‡Šï¼Œå‡ä¿ç•™</li>
</ul>
<h1 id="unique-ptræ¦‚è¿°"><a href="#unique-ptræ¦‚è¿°" class="headerlink" title="unique_ptræ¦‚è¿°"></a>unique_ptræ¦‚è¿°</h1><p>unique_ptræ˜¯æ¯”rew-pointeræ›´ä¸ºå¥½çš„é€‰æ‹©ï¼Œæ ‡å‡†åº“å®ç°unique_pträ½¿æ¥å£å°½å¯èƒ½çš„æ¥è¿‘åŸç”ŸæŒ‡é’ˆã€‚ä¸åŒçš„ç¼–è¯‘å™¨å¯¹å…¶å®ç°æœ‰æ‰€ä¸åŒã€‚</p>
<p>gccç¼–è¯‘å™¨å¯¹ unique_ptrçš„å®ç°ï¼Œå¤§æ¦‚åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨åˆ†</p>
<ul>
<li>defaule_delete å®šä¹‰çš„é»˜è®¤åˆ é™¤å™¨ï¼Œå…¶ä¸­æ²¡æœ‰ä»»ä½•æ•°æ®æˆå‘˜ï¼Œæ˜¯unique_ptrçš„é»˜è®¤åˆ é™¤å™¨</li>
<li>__uniq_ptr_impl unique_ptrçš„æ ¸å¿ƒéƒ¨åˆ†</li>
<li>__uniq_ptr_data unique_ptr å’Œ __uniq_ptr_implçš„ä¸­é—´å±‚ï¼Œunique_ptrå†…å«ä¸€ä¸ª__uniq_ptr_data</li>
<li>unique_ptr<T>     éæ•°ç»„ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ç‰ˆæœ¬</li>
<li>unique_ptr&lt;T[]&gt;   æ•°ç»„ç‰ˆæœ¬ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æœ‰æ›´å¥½çš„æ›¿ä»£(vector,arrayç­‰) </li>
<li>std::make_uniqueï¼Œunique_ptrçš„é…å¥—å‡½æ•°ï¼Œç”¨äºåˆ›å»ºunique_ptr</li>
</ul>
<h1 id="éœ€è¦äº†è§£çš„å‰ç½®çŸ¥è¯†"><a href="#éœ€è¦äº†è§£çš„å‰ç½®çŸ¥è¯†" class="headerlink" title="éœ€è¦äº†è§£çš„å‰ç½®çŸ¥è¯†"></a>éœ€è¦äº†è§£çš„å‰ç½®çŸ¥è¯†</h1><h2 id="ç±»å‹å®‰å…¨"><a href="#ç±»å‹å®‰å…¨" class="headerlink" title="ç±»å‹å®‰å…¨"></a>ç±»å‹å®‰å…¨</h2><p>C++æ”¯æŒOOP,è¿™å°±æ¶‰åŠåˆ°çš„å¤šæ€ï¼Œæœ¬ç« çš„ä¸»é¢˜æ˜¯æŒ‡é’ˆï¼Œå¦‚æœæƒ³æ”¾å¿ƒçš„å¯¹äºunique_ptrçš„ä½¿ç”¨å°±åƒä½¿ç”¨å†…ç½®æŒ‡é’ˆä¸€æ ·(æŸäº›éƒ¨åˆ†)ï¼Œéœ€è¦åšç±»å‹å®‰å…¨çš„çº¦æŸã€‚åŒ…æ‹¬ä½†ä¸é™äº</p>
<ul>
<li>åŸºç±»å’Œæ´¾ç”Ÿç±»çš„æŒ‡é’ˆè½¬æ¢</li>
<li>æ•°ç»„å’ŒæŒ‡é’ˆçš„è½¬æ¢</li>
<li>åˆ é™¤å™¨çš„è½¬æ¢(è¯»è€…çœ‹åˆ°åˆ é™¤å™¨çš„å®ç°å°±ä¼šçŸ¥é“äº†)</li>
</ul>
<p>ä¸ºä»€ä¹ˆéœ€è¦é¢å¤–çš„ç±»å‹å®‰å…¨ï¼Œè€Œä¸æ˜¯é ç¼–è¯‘å™¨çš„æ£€æ“¦ï¼Ÿ</p>
<p>å› ä¸ºC++æ˜¯ä¸€ä¸ªå¼±ç±»å‹è¯­è¨€ï¼Œå°±æ˜¯è¯´åœ¨ä¸åŒçš„ç±»å‹ä¹‹é—´å¯ä»¥å®ç°éšå¼çš„ç±»å‹è½¬æ¢â€”â€”è¿™ç§è½¬æ¢æœ‰æ—¶å€™å¾ˆä¾¿åˆ©ã€‚ä½†æœ‰æ›´å¤šçš„æ—¶å€™ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚ä¾‹å¦‚ç²¾åº¦ä¸¢å¤±ï¼Œæ•°æ®æº¢å‡ºï¼Œç”šè‡³æ˜¯å†…å­˜æ³„æ¼å’Œæœªå®šä¹‰è¡Œä¸ºã€‚</p>
<h2 id="åŒºåˆ«T-å’ŒT"><a href="#åŒºåˆ«T-å’ŒT" class="headerlink" title="åŒºåˆ«T[]å’ŒT*"></a>åŒºåˆ«T[]å’ŒT*</h2><p>åœ¨Cä¸­<code>T[]</code>å’Œ<code>T*</code>å¯ä»¥çœ‹ä½œæ˜¯ç­‰ä»·çš„ç±»å‹ï¼Œä½†æ˜¯åœ¨C++çš„æ¨¡æ¿ä¸­ï¼Œè¯·å°†<code>T[]</code>å’Œ<code>T*</code>çœ‹ä½œä¸åŒç±»å‹<br>ä¾‹å¦‚std::is_arrayçš„å®ç°</p>
<pre><code class="C++">template&lt;typename&gt;
    struct is_array
    : public false_type &#123; &#125;;

  template&lt;typename _Tp, std::size_t _Size&gt;
    struct is_array&lt;_Tp[_Size]&gt;
    : public true_type &#123; &#125;;

  template&lt;typename _Tp&gt;
    struct is_array&lt;_Tp[]&gt;
    : public true_type &#123; &#125;;
</code></pre>
<p>ç±»ä¼¼çš„å¦‚æœæƒ³ç”¨unique_ptrå­˜æ”¾æ•°ç»„<code>unique_ptr&lt;T[]&gt;</code>æ˜¯æ­£ç¡®çš„,è€Œ<code>unique_ptr&lt;T*&gt;</code>æ˜¯ä¸æ­£ç¡®çš„</p>
<h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><p>gccå¯¹äºunique_ptrçš„å®ç°æ”¾åœ¨äº†unique_ptr.hä¸­</p>
<p>æœ¬ç¯‡æ–‡ç« å°†æŒ‰ç…§æºæ–‡ä»¶ä»ä¸Šè‡³ä¸‹çš„é¡ºåºæ¥å‰–æunique_ptrçš„å®ç°</p>
<h2 id="unique-ptrå®šä¹‰çš„é»˜è®¤åˆ é™¤å™¨"><a href="#unique-ptrå®šä¹‰çš„é»˜è®¤åˆ é™¤å™¨" class="headerlink" title="unique_ptrå®šä¹‰çš„é»˜è®¤åˆ é™¤å™¨"></a>unique_ptrå®šä¹‰çš„é»˜è®¤åˆ é™¤å™¨</h2><pre><code class="c++">//åŸºæœ¬çš„é»˜è®¤åˆ é™¤å™¨å®ç°
/// Primary template of default_delete, used by unique_ptr for single objects
  template &lt;typename _Tp&gt; struct default_delete &#123;
    /// Default constructor
    constexpr default_delete() noexcept = default;

    /** @brief Converting constructor.
     *
     * Allows conversion from a deleter for objects of another type, `_Up`,
     * only if `_Up*` is convertible to `_Tp*`.
     */
     // æ­£å¦‚æ³¨é‡Šæ‰€è¯´ï¼Œå¦‚æœåº•å±‚æŒ‡é’ˆå…è®¸å‡†æ¢ï¼Œåˆ™å…è®¸åˆ é™¤å™¨è½¬æ¢
     // ç©ºå®ç°ç›®çš„æ˜¯åšç±»å‹çº¦æŸ
     // ä½¿ç”¨_Requiresæ£€æŸ¥_Up * èƒ½å¦è½¬æ¢ä¸º_TP *
     // ä¾‹å¦‚èƒ½ç”¨åŸºç±»æŒ‡é’ˆæ¥ææ„ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹åƒï¼Œå´ä¸èƒ½ç”¨æ´¾ç”Ÿç±»æŒ‡é’ˆææ„åŸºç±»å¯¹è±¡(å…ˆé€šè¿‡è¯­æ³•å†è¯´)
    template &lt;typename _Up, typename = _Require&lt;is_convertible&lt;_Up *, _Tp *&gt;&gt;&gt;
    default_delete(const default_delete&lt;_Up&gt; &amp;) noexcept &#123;&#125;

    //é‡è½½çš„è°ƒç”¨è¿ç®—ç¬¦ï¼Œæ¥å—ä¸€ä¸ª_TpæŒ‡é’ˆï¼Œå¯¹å…¶è¿›è¡Œdelete
    /// Calls `delete __ptr`
    void operator()(_Tp *__ptr) const &#123;
        //å¦‚æœæ˜¯ä¸€ä¸ªéå®Œæ•´ç±»å‹ï¼Œä¾‹å¦‚åªå£°æ˜æ²¡æœ‰å®šä¹‰ï¼Œä¼šæ–­è¨€å¤±è´¥
      static_assert(!is_void&lt;_Tp&gt;::value,
                    &quot;can&#39;t delete pointer to incomplete type&quot;);
      static_assert(sizeof(_Tp) &gt; 0, &quot;can&#39;t delete pointer to incomplete type&quot;);
      delete __ptr;
    &#125;
  &#125;;
// _GLIBCXX_RESOLVE_LIB_DEFECTS
  // DR 740 - omit specialization for array objects with a compile time length

  /// Specialization of default_delete for arrays, used by `unique_ptr&lt;T[]&gt;`
  template &lt;typename _Tp&gt; struct default_delete&lt;_Tp[]&gt; &#123;
  public:
    /// Default constructor
    constexpr default_delete() noexcept = default;

    /** @brief Converting constructor.
     *
     * Allows conversion from a deleter for arrays of another type, such as
     * a const-qualified version of `_Tp`.
     *
     * Conversions from types derived from `_Tp` are not allowed because
     * it is undefined to `delete[]` an array of derived types through a
     * pointer to the base type.
     */
     //å…è®¸åˆ é™¤å…¶è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹çš„æ•°ç»„ï¼Œä¾‹å¦‚è½¬æ¢ä¸º_TPçš„consté™å®šç‰ˆæœ¬
     //ä½†æ˜¯ä¸å…è®¸ä»å­ç±»è½¬æ¢ä¸ºçˆ¶ç±»ï¼Œä¸è¦ç”¨å¤šæ€çš„æ–¹å¼å¤„ç†æ•°ç»„ï¼Œé€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤ç”±æ´¾ç”Ÿç±»çš„æ•°ç»„æ˜¯æœªå®šä¹‰çš„
     //æ‰€ä»¥ç¦æ­¢è¿™ç§è½¬æ¢
     //å…·ä½“çš„ä¿¡æ¯è¯·å‚è€ƒã€ŠMore Effective C++ã€‹æ¡æ¬¾5
    template &lt;typename _Up,
              typename = _Require&lt;is_convertible&lt;_Up (*)[], _Tp (*)[]&gt;&gt;&gt;
    default_delete(const default_delete&lt;_Up[]&gt; &amp;) noexcept &#123;&#125;

    /// Calls `delete[] __ptr`
    template &lt;typename _Up&gt;
    typename enable_if&lt;is_convertible&lt;_Up (*)[], _Tp (*)[]&gt;::value&gt;::type //æ³¨æ„è¿™é‡Œçš„ç±»å‹æ˜¯æ•°ç»„çš„æŒ‡é’ˆ
                                    //è™½ç„¶å…è®¸æ´¾ç”Ÿç±»æŒ‡é’ˆéšå¼çš„è½¬æ¢ä¸ºåŸºç±»æŒ‡é’ˆï¼Œä¸ºäº†æ£€æŸ¥è¿™ç§è½¬æ¢ï¼Œæˆ‘ä»¬è¦å†™æˆè¿™æ ·
                                    //ä¾‹å¦‚å¯ä»¥ä»non-const è½¬æ¢ä¸ºconstï¼Œä½†ä¸èƒ½ä»derived ** è½¬æ¢ä¸º base **
    operator()(_Up *__ptr) const &#123;
      static_assert(sizeof(_Tp) &gt; 0, &quot;can&#39;t delete pointer to incomplete type&quot;);
      //è°ƒç”¨delete[]
      delete[] __ptr;
    &#125;
  &#125;;
</code></pre>
<p>__uniq_ptr_implæ˜¯å®ç°éƒ¨åˆ†ï¼ŒæŠŠè¿™ä¸ªç±»è¯»æ‡‚ï¼Œå°±è¯»æ‡‚äº†unique_ptrçš„ä¸€åŠã€‚unique_ptrçš„æ ¸å¿ƒå®ç°ï¼Œå…¨éƒ¨åœ¨è¿™ä¸ªç±»ä¸­ã€‚æ²¡æœ‰å¤æ‚çš„é€»è¾‘ï¼Œä½†æ˜¯åšåˆ°ç±»å‹å®‰å…¨çš„å®ç°æ–¹æ³•ï¼Œè¿˜æ˜¯æ¯”è¾ƒéš¾çš„éƒ¨åˆ†ã€‚__uniq_ptr_implä¸­æ²¡æœ‰å¤æ‚çš„å…³äºç±»å‹å®‰å…¨çš„çº¦æŸã€‚æ¯”è¾ƒå¤æ‚çš„çº¦æŸåœ¨<code>uniqe_ptr&lt;T&gt;</code>å’Œ<code>unique_ptr&lt;T[]&gt;</code>ä¸­</p>
<pre><code class="C++">// Manages the pointer and deleter of a unique_ptr
//_TPæ˜¯æŒ‡å‘çš„ç±»å‹ï¼Œ _DPæ˜¯åˆ é™¤å™¨çš„ç±»å‹
  template &lt;typename _Tp, typename _Dp&gt; class __uniq_ptr_impl &#123;
    
    //è¿™é‡Œåšäº†ä¸€ä¸ªtype_traits
    //_Upå®é™…ä¸Šæ˜¯_Tp, _Epå®é™…ä¸Šæ˜¯_Dp
    //æŒ‡å‘å †åŒºå¯¹è±¡æŒ‡é’ˆçš„çš„ç±»å‹ä¸º_Up *
    template &lt;typename _Up, typename _Ep, typename = void&gt; struct _Ptr &#123;
      using type = _Up *;
    &#125;;

    //å¦‚æœåˆ é™¤å™¨ä¸­å£°æ˜äº†åˆ é™¤çš„æŒ‡é’ˆç±»å‹ï¼Œæœ‰ä¼˜å…ˆè€ƒè™‘è¿™ä¸ªæŒ‡é’ˆç±»å‹
    //å¦‚æœæ²¡æœ‰ï¼Œç±»å‹æ›¿æ¢å¤±è´¥ï¼Œè½¬è€ŒåŒ¹é…ä¸Šé¢çš„_Ptr
    //è¿™æ ·åšçš„åŸå› ï¼Œæƒ³æƒ³ä¸€ç§æƒ…å†µ
    //class B; class D : public B;
    //åˆ é™¤å™¨ä¸­æ¥å—B*è€Œå®é™…å­˜å‚¨çš„å¯¹è±¡ä¸ºDç±»å‹å¯¹è±¡ï¼Œåœ¨åˆ é™¤å™¨ä¸­å®šä¹‰äº†pointerä¸ºB*
    template &lt;typename _Up, typename _Ep&gt;
    struct _Ptr&lt;_Up, _Ep,
                __void_t&lt;typename remove_reference&lt;_Ep&gt;::type::pointer&gt;&gt; &#123;
      //è¿™é‡Œå‡å®šäº†ç»™å®šçš„_Epæœ‰typeç±»å‹ï¼Œå¹¶ä¸”typeä¸‹æœ‰pointerç±»å‹
      using type = typename remove_reference&lt;_Ep&gt;::type::pointer;
    &#125;;

  public:
    //è¿™é‡Œåšäº†ä¸€ä¸ªçº¦æŸæ¡ä»¶
    //åªæ˜¯ç®€å•çš„åˆ«åå®šä¹‰ï¼Œstd::enable_if::æ²¡æœ‰å–type
    //ç”¨åˆ°çš„åœ°æ–¹å†unique_pträ¸­
    //è¿™ä¸ªæ¨¡æ¿åˆ«åç›®çš„æ˜¯ä¸ºäº†çº¦æŸ_Dpä¹Ÿå°±æ˜¯åˆ é™¤å™¨ï¼Œä¸èƒ½æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸”è¦æ±‚å…·æœ‰é»˜è®¤æ„é€ å‡½æ•°
    using _DeleterConstraint = enable_if&lt;
        __and_&lt;__not_&lt;is_pointer&lt;_Dp&gt;&gt;, is_default_constructible&lt;_Dp&gt;&gt;::value&gt;;

    //pointerä¸º_Tp, _Epç»è¿‡ _Ptrç±»å‹èƒå–åçš„çš„åˆ«å
    //::typeèƒå–å‡ºæ¥ä¸€ä¸ªæŒ‡é’ˆç±»å‹
    //æˆ‘ä»¬æŠŠpointer è¿™ä¸ªç±»å‹ç›´æ¥å½“ä½œraw-pointerç±»å‹
    using pointer = typename _Ptr&lt;_Tp, _Dp&gt;::type;

    //æ­£å¦‚æ–­è¨€æ‰€è¨€ï¼Œunique_ptrçš„åˆ é™¤å…¶å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡æˆ–è€…ä¸€ä¸ªå·¦å€¼å¼•ç”¨
    //å¦‚æœæ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨, !value == false,æ–­è¨€å¤±è´¥
    static_assert(!is_rvalue_reference&lt;_Dp&gt;::value,
                  &quot;unique_ptr&#39;s deleter type must be a function object type&quot;
                  &quot; or an lvalue reference type&quot;);

    __uniq_ptr_impl() = default; // =defalutæ˜¯è°ƒç”¨tupleçš„é»˜è®¤æ„é€ ï¼Œtupleä¸­çš„é»˜è®¤æ„é€ ä¼šä¸ºæ¯ä¸ªå¯¹è±¡ç»™å®šä¸€ä¸ªåˆå€¼
                                 //ä¾‹å¦‚intç­‰ç±»å‹ä¼šè¢«åˆå§‹åŒ–ä¸º0ï¼Œè€ŒæŒ‡é’ˆç±»å‹ä¼šè¢«åˆå§‹åŒ–ä¸ºnullptr
    __uniq_ptr_impl(pointer __p) : _M_t() &#123; _M_ptr() = __p; &#125;

    //é€šè¿‡è£¸æŒ‡é’ˆ+åˆ é™¤å™¨çš„æ–¹å¼æ„é€ 
    //åˆ é™¤å™¨ä½¿ç”¨ä¸‡èƒ½å¼•ç”¨+è½¬å‘çš„å½¢å¼ä¼ é€’
    template &lt;typename _Del&gt;
    __uniq_ptr_impl(pointer __p, _Del &amp;&amp;__d)
        : _M_t(__p, std::forward&lt;_Del&gt;(__d)) &#123;&#125;

    //ç§»åŠ¨æ„é€ 
    //æ³¨æ„å¦‚æœç±»å‹æ²¡æœ‰ç§»åŠ¨æ„é€ å‡½æ•°æƒ…å†µå°±æ˜¯æ‹·è´æ„é€ 
    __uniq_ptr_impl(__uniq_ptr_impl &amp;&amp;__u) noexcept
    //å°†uä¸‹çš„_M_tç›´æ¥ç§»åŠ¨ç»™è‡ªå·±
        : _M_t(std::move(__u._M_t)) &#123;
      __u._M_ptr() = nullptr; //æ»ç©ºuä¸‹çš„_M_ptr
    &#125;

    //ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦
    __uniq_ptr_impl &amp;operator=(__uniq_ptr_impl &amp;&amp;__u) noexcept &#123;
      reset(__u.release());
      _M_deleter() = std::forward&lt;_Dp&gt;(__u._M_deleter()); //å°†åˆ é™¤å™¨è½¬å‘è¿‡å» ä¸ºä»€ä¹ˆç”¨è½¬å‘??
      return *this;
    &#125;

    //_M_ptrè·å¾—æŒ‡å‘å †åŒºå†…å­˜çš„æŒ‡é’ˆ
    pointer &amp;_M_ptr() &#123; return std::get&lt;0&gt;(_M_t); &#125;
    //å¯¹äºconstçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æŒ‰å€¼è¿”å›å³å¯ï¼Œå› ä¸ºæŒ‰å€¼è¿”å›pointerçš„è€—è´¹è¾ƒå°
    pointer _M_ptr() const &#123; return std::get&lt;0&gt;(_M_t); &#125;
    //_M_ptrè·å¾—åˆ é™¤å™¨
    _Dp &amp;_M_deleter() &#123; return std::get&lt;1&gt;(_M_t); &#125;
    //å¯¹äºåˆ é™¤å…¶ï¼Œä½¿ç”¨const &amp;æ–¹å¼è¿”å›ï¼Œå› ä¸ºåˆ é™¤å™¨æ˜¯å¯èƒ½æ˜¯å‡½æ•°å¯¹è±¡â€”â€”è¿™ç§æƒ…å€¼è¿”å›å¯èƒ½è€—è´¹è¾ƒå¤§
    //å¹¶ä¸”åˆ é™¤å™¨æœ‰å¯èƒ½ä¸æ”¯æŒæ‹·è´æ“ä½œ
    const _Dp &amp;_M_deleter() const &#123; return std::get&lt;1&gt;(_M_t); &#125;

    //resetè°ƒç”¨åˆ é™¤å™¨ææ„raw-pointeræŒ‡å‘çš„ç©ºé—´ï¼Œå¹¶é‡æ–°èµ‹å€¼ä¸º__p
    //å‡å®šä¸ä¼šæŠ›å‡ºå¼‚å¸¸ ä½¿ç”¨noexcept
    void reset(pointer __p) noexcept &#123;
      const pointer __old_p = _M_ptr();
      _M_ptr() = __p;
      //ä¸ä¸ºnullptr, è¿›è¡Œææ„æ“ä½œ
      if (__old_p)
        _M_deleter()(__old_p);
    &#125;

    //å¹¶ä¸ææ„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ï¼Œè€Œæ˜¯è¿”å›æŒ‡é’ˆ
    //å¹¶ä¸”å°†æŒ‡å‘å †åŒºéƒ¨åˆ†çš„æŒ‡é’ˆèµ‹å€¼ä¸ºnullptr
    pointer release() noexcept &#123;
      pointer __p = _M_ptr();
      _M_ptr() = nullptr;
      return __p;
    &#125;

    //å¯¹äºä¸¤ä¸ªunique_ptrçš„swapï¼Œåªéœ€è¦äº¤æ¢å…¶æŒ‡é’ˆéƒ¨åˆ†å’Œåˆ é™¤å™¨éƒ¨åˆ†å³å¯
    void swap(__uniq_ptr_impl &amp;__rhs) noexcept &#123;
      //è¿™é‡Œçš„using std::swapè¯·å‚è€ƒã€ŠEffective C++ã€‹æ¡æ¬¾25
      using std::swap;
      swap(this-&gt;_M_ptr(), __rhs._M_ptr());
      swap(this-&gt;_M_deleter(), __rhs._M_deleter());
    &#125;

  private:
    //ä½¿ç”¨ä¸€ä¸ªtupleæ¥å­˜å‚¨å…·ä½“æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆå’Œåˆ é™¤å™¨,ä¾¿äºå®ç°ï¼Œä¸Šé¢é»˜è®¤æ„é€ å‡½æ•°ä¸­æœ‰è§£é‡Š
    //å¹¶ä¸”ï¼Œtupleå…·æœ‰ç©ºé—´å‹ç¼©çš„åŠŸèƒ½(æ¨¡æ¿é€’å½’ç»§æ‰¿)
    //è¿™ç§æ–¹å¼ä¸ºä»€ä¹ˆèƒ½å¤Ÿå‹ç¼©ç©ºé—´,æ˜¯å¦ä¸€ä¸ªé—®é¢˜äº†,å‚è€ƒã€Šæ·±åº¦æ¢ç´¢C++å¯¹è±¡æ¨¡å‹ã€‹
    tuple&lt;pointer, _Dp&gt; _M_t;
  &#125;;
</code></pre>
<h3 id="å…³äºåˆ é™¤å™¨çš„çº¦æŸ"><a href="#å…³äºåˆ é™¤å™¨çš„çº¦æŸ" class="headerlink" title="å…³äºåˆ é™¤å™¨çš„çº¦æŸ"></a>å…³äºåˆ é™¤å™¨çš„çº¦æŸ</h3><p>æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è¯´åœ¨é»˜è®¤æ„é€ ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼Œä¸å…è®¸æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œ</p>
<p>è¿™æ˜¯ç”±äºå†…ç½®æŒ‡é’ˆåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤å™¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ˜¯ä¸€ä¸ªnullptrã€‚æ‰€ä»¥ï¼Œåœ¨é»˜è®¤æ„é€ çš„æƒ…å†µä¸‹ï¼Œä¸å…è®¸åˆ é™¤å™¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹</p>
<p>å¦‚æœæŠŠæŒ‡é’ˆç±»å‹çš„åˆ é™¤å™¨ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰å½“ä½œç±»å‹å‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šè¯´æˆ‘æ‰¾ä¸åˆ°é»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œè¿™æ˜¯å› ä¸ºunique_ptrçš„é»˜è®¤æ„é€ å‡½æ•°è¿›è¡Œäº†å¦‚æ­¤çš„çº¦æŸï¼Œç±»å‹æ›¿æ¢å¤±è´¥ï¼Œäºæ˜¯æ‰¾ä¸åˆ°é»˜è®¤æ„é€ å‡½æ•°ã€‚å¦‚æœææ„å™¨æ˜¯å‡½æ•°å¯¹è±¡æˆ–è€…lambdaï¼Œå°±ä¸ä¼šæœ‰è¿™æ ·çš„æƒ…å†µ</p>
<pre><code class="C++">namespace jan &#123;
    template&lt;typename _Dp&gt;
    using _DeleterConstraint = enable_if&lt;
            __and_&lt;__not_&lt;is_pointer&lt;_Dp&gt;&gt;, is_default_constructible&lt;_Dp&gt;&gt;::value&gt;;
&#125;
void fun() &#123; &#125;
struct Foo &#123;
    Foo() = delete;
&#125;;
int main() &#123;
    typename jan::_DeleterConstraint&lt;decltype(fun)&gt;::type; //error
    typename jan::_DeleterConstraint&lt;int&gt;::type;    //ok
    typename jan::_DeleterConstraint&lt;Foo&gt;::type;    //error
    return 0;
&#125;
</code></pre>
<h3 id="å…³äº-Ptrèƒå–æŒ‡é’ˆçš„è¯´æ˜"><a href="#å…³äº-Ptrèƒå–æŒ‡é’ˆçš„è¯´æ˜" class="headerlink" title="å…³äº_Ptrèƒå–æŒ‡é’ˆçš„è¯´æ˜"></a>å…³äº_Ptrèƒå–æŒ‡é’ˆçš„è¯´æ˜</h3><p>ä»æºä»£ç ä¸­å¯ä»¥çœ‹å‡º,å¦‚æœåˆ é™¤å™¨ä¸­å®šä¹‰äº†ä¸€ä¸ªpointerå‹åˆ«ï¼Œ_Pträ¼šæœ‰é™èƒå–å‡ºåˆ é™¤å™¨::pointerä½œä¸ºunique_ptrçš„raw-pointerç±»å‹ã€‚æˆ‘ä»¬æƒ³è±¡è¿™æ ·ä¸€ç§æƒ…å†µã€‚</p>
<pre><code class="C++">class A &#123; &#125;;
class B : public A &#123; &#125;;
class C : public B &#123; &#125;;

struct BDel &#123;
    using pointer = B*;
    void operator()(pointer p) &#123;
        delete p;
    &#125;
&#125;;
struct ADel&#123;
//    using pointer = B*;
    void operator()(A* p) &#123;
        //do something
        //ä½†æ˜¯å’ŒBDelåšçš„äº‹æƒ…ä¸ä¸€æ ·
        delete p;
    &#125;
&#125;;

int main() &#123;
    unique_ptr&lt;C,BDel&gt; p (new C, BDel&#123;&#125;);
    return 0;
&#125;
</code></pre>
<p>æŒ‡å®šBelä¸ºåˆ é™¤å™¨ç±»å‹ï¼Œå°±è¡¨æ˜ï¼Œæˆ‘ä»¬è¦å¤„ç†çš„ç±»å‹&#x2F;è¦åˆ é™¤çš„ç±»å‹ï¼Œæ˜¯Bç±»å‹æˆ–è€…Bçš„æ´¾ç”Ÿç±»ã€‚è®°è€…OOPä¸­çš„ä¸€æ¡è§„åˆ™å—?é¢å‘æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é¢å‘å®ä¾‹ç¼–ç¨‹ã€‚è¿™è¿™ä¸ªæƒ…å†µä¸­ï¼Œå°½ç®¡æ˜¯ä¸ªCå¯¹è±¡ï¼Œä½†æ˜¯ä»å½“ä½œBç±»å‹å¤„ç†ã€‚å¦‚æœæ²¡æœ‰_Ptrèƒå–ï¼Œunique_ptr::pointerå°±æ˜¯C*ï¼Œæ— æ³•åº”ç”¨äºBå¯¹è±¡ã€‚</p>
<p>å°±æ˜¯è¯´å°½ç®¡æˆ‘ä»¬è¿™æ ·å†™<code>unique_ptr&lt;C,BDel&gt; p (new C, BDel&#123;&#125;);</code>,ä»æ˜¯å¯ä»¥åº”ç”¨äºBå¯¹è±¡ï¼Œå°±åƒè¿™æ ·<code>unique_ptr&lt;C,BDel&gt; p (new B, BDel&#123;&#125;)</code></p>
<p>æ˜¯æœ‰ä¸€äº›è«åå…¶å¦™ï¼ï¼ï¼</p>
<h2 id="uniq-ptr-data"><a href="#uniq-ptr-data" class="headerlink" title="__uniq_ptr_data"></a>__uniq_ptr_data</h2><p>åœ¨__uniq_ptr_implå’Œunique_ptrï¼ŒåˆåŠ ä¸Šäº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œç›®çš„æ˜¯æ ¹æ®åˆ é™¤å™¨æ˜¯å¦æœ‰ç§»åŠ¨æ„é€ æˆ–è€…ç§»åŠ¨èµ‹å€¼å±æ€§ï¼Œ<br>éƒ¨åˆ†ç‰¹ä¾‹åŒ–ï¼Œæ¥åŒ¹é…ä¸åŒçš„æƒ…å†µ</p>
<pre><code class="C++">// Defines move construction + assignment as either defaulted or deleted.
  template &lt;typename _Tp, typename _Dp,
            bool = is_move_constructible&lt;_Dp&gt;::value,
            bool = is_move_assignable&lt;_Dp&gt;::value&gt;
  struct __uniq_ptr_data : __uniq_ptr_impl&lt;_Tp, _Dp&gt; &#123;
    //uisng ä½¿ç”¨__uniq_ptr_implçš„æ„é€ å‡½æ•°ï¼Œä¸‹åŒ
    using __uniq_ptr_impl&lt;_Tp, _Dp&gt;::__uniq_ptr_impl;
    __uniq_ptr_data(__uniq_ptr_data &amp;&amp;) = default;
    __uniq_ptr_data &amp;operator=(__uniq_ptr_data &amp;&amp;) = default;
  &#125;;

  template &lt;typename _Tp, typename _Dp&gt;
  struct __uniq_ptr_data&lt;_Tp, _Dp, true, false&gt; : __uniq_ptr_impl&lt;_Tp, _Dp&gt; &#123;
    using __uniq_ptr_impl&lt;_Tp, _Dp&gt;::__uniq_ptr_impl;
    __uniq_ptr_data(__uniq_ptr_data &amp;&amp;) = default;
    __uniq_ptr_data &amp;operator=(__uniq_ptr_data &amp;&amp;) = delete;
  &#125;;

  template &lt;typename _Tp, typename _Dp&gt;
  struct __uniq_ptr_data&lt;_Tp, _Dp, false, true&gt; : __uniq_ptr_impl&lt;_Tp, _Dp&gt; &#123;
    using __uniq_ptr_impl&lt;_Tp, _Dp&gt;::__uniq_ptr_impl;
    __uniq_ptr_data(__uniq_ptr_data &amp;&amp;) = delete;
    __uniq_ptr_data &amp;operator=(__uniq_ptr_data &amp;&amp;) = default;
  &#125;;

  template &lt;typename _Tp, typename _Dp&gt;
  struct __uniq_ptr_data&lt;_Tp, _Dp, false, false&gt; : __uniq_ptr_impl&lt;_Tp, _Dp&gt; &#123;
    using __uniq_ptr_impl&lt;_Tp, _Dp&gt;::__uniq_ptr_impl;
    __uniq_ptr_data(__uniq_ptr_data &amp;&amp;) = delete;
    __uniq_ptr_data &amp;operator=(__uniq_ptr_data &amp;&amp;) = delete;
  &#125;;
</code></pre>
<h2 id="åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼ŒçŠ¹æŠ±çµç¶åŠé®é¢"><a href="#åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼ŒçŠ¹æŠ±çµç¶åŠé®é¢" class="headerlink" title="åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼ŒçŠ¹æŠ±çµç¶åŠé®é¢"></a>åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼ŒçŠ¹æŠ±çµç¶åŠé®é¢</h2><pre><code class="C++">/// 20.7.1.2 unique_ptr for single objects.
  template &lt;typename _Tp, typename _Dp = default_delete&lt;_Tp&gt;&gt; class unique_ptr &#123;
    template &lt;typename _Up&gt;
    //å¦‚æœä¸ç¬¦åˆ __uniq_ptr_impl&lt;_Tp, _Up&gt;::_DeleterConstraintä¸­çš„çº¦æŸæ¡ä»¶
    //enable_if&lt;false&gt;ä¸ä¼šå–åˆ°typeè¿™ä¸ªç±»å‹ï¼Œç±»å‹æ›¿æ¢å¤±è´¥
    using _DeleterConstraint =
        typename __uniq_ptr_impl&lt;_Tp, _Up&gt;::_DeleterConstraint::type;

    //å†…æ¶µä¸€ä¸ª_uniq_ptr_dataæ¥å®ç°unique_ptr
    __uniq_ptr_data&lt;_Tp, _Dp&gt; _M_t;

  public:
    //ç®€å•çš„å‹åˆ«åˆ«å
    using pointer = typename __uniq_ptr_impl&lt;_Tp, _Dp&gt;::pointer;
    using element_type = _Tp;   //è¢«æŒ‡å‘å…ƒç´ ç±»å‹
    using deleter_type = _Dp;   //åˆ é™¤å™¨ç±»å‹

  private:
    // helper template for detecting a safe conversion from another unique_ptr
    //å¸®åŠ©æ¨¡æ¿æ¨åˆ°æ˜¯å¦æ˜¯å®‰å…¨çš„è½¬æ¢ä»å¦ä¸€ä¸ªunique_ptr
    template &lt;typename _Up, typename _Ep&gt;
    using __safe_conversion_up =
        //å…ˆæ¨å¯¼ä¸¤ä¸ªunique_ptrçš„å†…éƒ¨æŒ‡é’ˆè½¬æ¢æ˜¯å¦å®‰å…¨ï¼Œå†çœ‹_Upæ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„(æ•°ç»„å¯ä»¥é€€åŒ–ä¸ºæŒ‡é’ˆ,è¿™æ ·çš„è½¬æ¢æ˜¯ä¸å®‰å…¨çš„)
        //çº¦æŸ_Upä¸èƒ½æ˜¯ä¸€ä¸ªæ•°ç»„
        __and_&lt;is_convertible&lt;typename unique_ptr&lt;_Up, _Ep&gt;::pointer, pointer&gt;,
               __not_&lt;is_array&lt;_Up&gt;&gt;&gt;;

  public:
    //å…³äºunique_ptrçš„æ–¹æ³•åŠŸèƒ½ï¼Œå¯ä»¥çœ‹è§å·²ç»æœ‰å¾ˆå¥½çš„è¯´æ˜äº†ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä¸å†è¯´æ˜
    // Constructors.

    /// Default constructor, creates a unique_ptr that owns nothing.
    //æ¨¡æ¿çº¦æŸå†è¿™é‡Œä½¿ç”¨ï¼Œå› ä¸ºè¿™é‡Œçš„åˆ é™¤å™¨çº¦æŸæ¡ä»¶æ˜¯implä¸­çš„çº¦æŸæ¡ä»¶::type
    //ç›¸å½“äºå¯¹std::enable_ifå–type
    //å¦‚æœåˆ é™¤å™¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼Œæˆ–è€…æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼Œä¼šç¼–è¯‘å¤±è´¥
    template &lt;typename _Del = _Dp, typename = _DeleterConstraint&lt;_Del&gt;&gt;
    constexpr unique_ptr() noexcept : _M_t() &#123;&#125;


    /** Takes ownership of a pointer.
     *
     * @param __p  A pointer to an object of @c element_type
     *
     * The deleter will be value-initialized.
     */
     //åŒä¸Š
    template &lt;typename _Del = _Dp, typename = _DeleterConstraint&lt;_Del&gt;&gt;
    explicit unique_ptr(pointer __p) noexcept : _M_t(__p) &#123;&#125;

    /** Takes ownership of a pointer.
     *
     * @param __p  A pointer to an object of @c element_type
     * @param __d  A reference to a deleter.
     *
     * The deleter will be initialized with @p __d
     */
     //è¿™é‡Œåšçš„åˆ é™¤å™¨ç±»å‹çº¦æŸä¸ºï¼šéœ€è¦èƒ½æ‹·è´æ„é€ 
    template &lt;typename _Del = deleter_type,
              typename = _Require&lt;is_copy_constructible&lt;_Del&gt;&gt;&gt;
    unique_ptr(pointer __p, const deleter_type &amp;__d) noexcept
        : _M_t(__p, __d) &#123;&#125;

    /** Takes ownership of a pointer.
     *
     * @param __p  A pointer to an object of @c element_type
     * @param __d  An rvalue reference to a (non-reference) deleter.
     *
     * The deleter will be initialized with @p std::move(__d)
     */
     //è¿™é‡Œåšçš„åˆ é™¤å™¨ç±»å‹çº¦æŸä¸ºï¼šéœ€è¦èƒ½æ‹·è´æ„é€ 
    template &lt;typename _Del = deleter_type,
              typename = _Require&lt;is_move_constructible&lt;_Del&gt;&gt;&gt;
    unique_ptr(
        pointer __p,
        //çº¦æŸä¸ºä¸èƒ½æ˜¯ä¸€ä¸ªå·¦å€¼å¼•ç”¨
        __enable_if_t&lt;!is_lvalue_reference&lt;_Del&gt;::value, _Del &amp;&amp;&gt; __d) noexcept
        : _M_t(__p, std::move(__d)) &#123;&#125;

    //åˆ é™¤å™¨ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œå¹¶ä¸”å¯¹äºä¼ å…¥çš„åˆ é™¤å™¨æ˜¯ä¸€ä¸ªå³å€¼ï¼Œæ˜¯ä¸å…è®¸çš„æ‰€ä»¥  =delete
    template &lt;typename _Del = deleter_type,
              typename _DelUnref = typename remove_reference&lt;_Del&gt;::type&gt;
    unique_ptr(pointer,
               __enable_if_t&lt;is_lvalue_reference&lt;_Del&gt;::value, _DelUnref &amp;&amp;&gt;) =
        delete;

    //å¯¹äºnullptr,ä¹Ÿå°±æ˜¯std::nullptr_tç±»å‹çš„æ„é€ å‡½æ•°ä¾‹å¦‚unique_ptr&lt;Foo&gt; p(nullptr);
    /// Creates a unique_ptr that owns nothing.
    template &lt;typename _Del = _Dp, typename = _DeleterConstraint&lt;_Del&gt;&gt;
    constexpr unique_ptr(nullptr_t) noexcept : _M_t() &#123;&#125;


    /// Move constructor.
    //ä»…ä»…æ˜¯=default
    unique_ptr(unique_ptr &amp;&amp;) = default;

    /** @brief Converting constructor from another type
     *
     * Requires that the pointer owned by @p __u is convertible to the
     * type of pointer owned by this object, @p __u does not own an array,
     * and @p __u has a compatible deleter type.
     */
     //æ­£å¦‚æ³¨é‡Šæ‰€è¨€ï¼Œä»ä¸€ä¸ªunique_ptræ„é€ ä¸€ä¸ªunique_ptr,è¦æ±‚æ‹¥æœ‰çš„æŒ‡é’ˆèƒ½å¤Ÿè½¬æ¢å¹¶ä¸”ä¸æ˜¯æ•°ç»„ç±»å‹
     //å¹¶ä¸”è¦æ±‚__uçš„åˆ é™¤å™¨èƒ½å¤Ÿå…¼å®¹thisçš„åˆ é™¤å™¨
    template &lt;
        typename _Up, typename _Ep,
        typename = _Require&lt;
            __safe_conversion_up&lt;_Up, _Ep&gt;, //çœ‹çœ‹å†…éƒ¨æŒ‡é’ˆèƒ½ä¸èƒ½å®‰å…¨è½¬æ¢
            typename conditional&lt;is_reference&lt;_Dp&gt;::value, 
                                 is_same&lt;_Ep, _Dp&gt;, //çœ‹çœ‹åˆ é™¤å™¨æ˜¯ä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œæ˜¯ï¼Œéœ€è¦ç›¸åŒç±»å‹
                                 is_convertible&lt;_Ep, _Dp&gt;&gt;::type&gt;&gt; //ä¸æ˜¯éœ€è¦_Ep(__uçš„åˆ é™¤å™¨ç±»å‹)èƒ½å¤Ÿè½¬æ¢ä¸º_Dp
    unique_ptr(unique_ptr&lt;_Up, _Ep&gt; &amp;&amp;__u) noexcept
        : _M_t(__u.release(), std::forward&lt;_Ep&gt;(__u.get_deleter())) &#123;&#125;

#if _GLIBCXX_USE_DEPRECATED
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored &quot;-Wdeprecated-declarations&quot;
    /// Converting constructor from @c auto_ptr
    //å› ä¸ºauto_ptræ˜¯åºŸå¼ƒçš„ç‰¹æ€§ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä¸è¯´æ˜äº†ï¼Œæœ‰å…´è¶£çš„è¯è¯»è€…å¯ä»¥è‡ªå·±åˆ†æä¸€ä¸‹
    template &lt;typename _Up,
              typename = _Require&lt;is_convertible&lt;_Up *, _Tp *&gt;,
                                  is_same&lt;_Dp, default_delete&lt;_Tp&gt;&gt;&gt;&gt;
    unique_ptr(auto_ptr&lt;_Up&gt; &amp;&amp;__u) noexcept;
#pragma GCC diagnostic pop
#endif

    /// Destructor, invokes the deleter if the stored pointer is not null.
    ~unique_ptr() noexcept &#123;
      //å¦‚æœåˆ é™¤å™¨ä¸æ˜¯å¯è°ƒç”¨çš„ï¼Œä¼šæ–­è¨€å¤±è´¥
      //__is_invocableå…·ä½“çš„å®ç°ï¼Œè¿™é‡Œä¸è¯´æ˜
      static_assert(__is_invocable&lt;deleter_type &amp;, pointer&gt;::value,
                    &quot;unique_ptr&#39;s deleter must be invocable with a pointer&quot;);
      auto &amp;__ptr = _M_t._M_ptr(); //å…ˆç¼“å­˜æŒ‡é’ˆ
      if (__ptr != nullptr)        //å¦‚æœä¸æ˜¯ç©ºï¼Œä½¿ç”¨åˆ é™¤å™¨åˆ é™¤
        get_deleter()(std::move(__ptr)); 
      __ptr = pointer();   
    &#125;

    // Assignment.

    /** @brief Move assignment operator.
     *
     * Invokes the deleter if this object owns a pointer.
     */
     //åŒæ ·çš„ï¼Œç®€å•æ˜¯ä½¿ç”¨default
    unique_ptr &amp;operator=(unique_ptr &amp;&amp;) = default;

    /** @brief Assignment from another type.
     *
     * @param __u  The object to transfer ownership from, which owns a
     *             convertible pointer to a non-array object.
     *
     * Invokes the deleter if this object owns a pointer.
     */
     //æ¶‰åŠåˆ°ç±»å‹çš„è½¬æ¢ï¼Œè¿™ä¸ªé—®é¢˜ä¸Šé¢å·²ç»çœ‹åˆ°è¿‡äº†
     //å¯ä»¥ç±»ä¼¼çš„å¦‚æ³•ç‚®åˆ¶
    template &lt;typename _Up, typename _Ep&gt;
    typename enable_if&lt;__and_&lt;__safe_conversion_up&lt;_Up, _Ep&gt;,
                              is_assignable&lt;deleter_type &amp;, _Ep &amp;&amp;&gt;&gt;::value,
                       unique_ptr &amp;&gt;::type
    operator=(unique_ptr&lt;_Up, _Ep&gt; &amp;&amp;__u) noexcept &#123;
      reset(__u.release());
      get_deleter() = std::forward&lt;_Ep&gt;(__u.get_deleter());
      return *this;
    &#125;

    /// Reset the %unique_ptr to empty, invoking the deleter if necessary.
    //å¯¹äºnullptr_tçš„èµ‹å€¼æ“ä½œ
    unique_ptr &amp;operator=(nullptr_t) noexcept &#123;
      reset();
      return *this;
    &#125;

    // Observers.

    /// Dereference the stored pointer.
    //å¯¹element_typeæ·»åŠ ä¸€ä¸ªå·¦å€¼å¼•ç”¨
    //åœ¨type_traitsä¸­å®šä¹‰çš„add_lvalue_referenceçš„å®ç°ç»†èŠ‚ï¼Œåœ¨è¿™é‡Œå¹¶ä¸æƒ³å¤šè¯´
    //æˆ‘å¯ä»¥è´Ÿè´£ä»»çš„å‘Šè¯‰ä½ ,add_lvalue_referenceä¼šå¯¹T, T&amp;&amp;å˜ä¸ºT &amp;,å¯¹T &amp; ä¸å˜
    typename add_lvalue_reference&lt;element_type&gt;::type operator*() const &#123;
      __glibcxx_assert(get() != pointer());
      return *get();
    &#125;

    /// Return the stored pointer.
    //-&gt;è¿ç®—ç¬¦ï¼Œä¸ç”¨å¤šè¯´ï¼Œçœ‹ä¸€ä¸‹å°±æ‡‚
    pointer operator-&gt;() const noexcept &#123;
      _GLIBCXX_DEBUG_PEDASSERT(get() != pointer());
      return get();
    &#125;

    /// Return the stored pointer.
    pointer get() const noexcept &#123; return _M_t._M_ptr(); &#125;

    /// Return a reference to the stored deleter.
    deleter_type &amp;get_deleter() noexcept &#123; return _M_t._M_deleter(); &#125;

    /// Return a reference to the stored deleter.
    const deleter_type &amp;get_deleter() const noexcept &#123;
      return _M_t._M_deleter();
    &#125;

    //éšå¼è½¬æ¢ä¸ºboolï¼Œå¯ä»¥ç”¨åœ¨è¿™ç§åœºæ™¯ï¼Œä¾‹å¦‚
    //unique_ptr&lt;Foo&gt; a;
    //if(a) &#123;...&#125;
    /// Return @c true if the stored pointer is not null.
    explicit operator bool() const noexcept &#123;
      return get() == pointer() ? false : true;
    &#125;

    // Modifiers.

    /// Release ownership of any stored pointer.
    pointer release() noexcept &#123; return _M_t.release(); &#125;

    /** @brief Replace the stored pointer.
     *
     * @param __p  The new pointer to store.
     *
     * The deleter will be invoked if a pointer is already owned.
     */
    void reset(pointer __p = pointer()) noexcept &#123;
      static_assert(__is_invocable&lt;deleter_type &amp;, pointer&gt;::value,
                    &quot;unique_ptr&#39;s deleter must be invocable with a pointer&quot;);
      _M_t.reset(std::move(__p));
    &#125;

    /// Exchange the pointer and deleter with another object.
    void swap(unique_ptr &amp;__u) noexcept &#123;
        //æ–­è¨€æ£€æŸ¥åˆ é™¤å™¨æ˜¯å¦å³å¯äº¤æ¢çš„èƒ½åŠ›
      static_assert(__is_swappable&lt;_Dp&gt;::value, &quot;deleter must be swappable&quot;);
      //è°ƒç”¨_M_tçš„swapï¼Œå®é™…ä¸Šæ˜¯__uniq_ptr_implä¸­çš„swap
      _M_t.swap(__u._M_t);
    &#125;

    // Disable copy from lvalue.
    //æ‹·è´æ„é€ å’Œèµ‹å€¼è¿ç®—ç¬¦æ˜¯åˆ é™¤çš„
    unique_ptr(const unique_ptr &amp;) = delete;
    unique_ptr &amp;operator=(const unique_ptr &amp;) = delete;
  &#125;;
</code></pre>
<p>å¯¹äºéæ•°ç»„ç‰ˆæœ¬çš„unique_ptræˆ‘ä»¬å·²ç»åˆ†æå®Œæˆäº†ï¼Œä¸‹é¢æ˜¯å¯¹äºæ•°ç»„ç‰ˆæœ¬çš„ç‰¹ä¾‹åŒ–</p>
<p>ç›¸å¯¹äºéæ•°ç»„ç‰ˆæœ¬ï¼Œæ•°ç»„ç‰ˆæœ¬ä¸»è¦ä¿®æ”¹äº†</p>
<ul>
<li>é»˜è®¤åˆ é™¤å™¨åšdelete[]åŠ¨ä½œ</li>
<li>é‡è½½[]</li>
</ul>
<pre><code class="C++">  /// 20.7.1.3 unique_ptr for array objects with a runtime length
  // [unique.ptr.runtime]
  // _GLIBCXX_RESOLVE_LIB_DEFECTS
  // DR 740 - omit specialization for array objects with a compile time length
  // å¯¹ç¼–è¯‘æ—¶æœŸèƒ½ç¡®å®šé•¿åº¦çš„æ•°ç»„ç‰¹ä¾‹åŒ–
  // å¯¹äºå·²ç»è¯´è¿‡çš„é—®é¢˜ï¼Œå°±ä¸å†å†™æ³¨é‡Šäº†ï¼Œè¯·è¯»è€…è‡ªå·±æ³¨æ„
  template &lt;typename _Tp, typename _Dp&gt; class unique_ptr&lt;_Tp[], _Dp&gt; &#123;
    template &lt;typename _Up&gt;
    using _DeleterConstraint =
        typename __uniq_ptr_impl&lt;_Tp, _Up&gt;::_DeleterConstraint::type;

    __uniq_ptr_data&lt;_Tp, _Dp&gt; _M_t;

    //å°±åƒremove_cv_t
    template &lt;typename _Up&gt; using __remove_cv = typename remove_cv&lt;_Up&gt;::type;

    // like is_base_of&lt;_Tp, _Up&gt; but false if unqualified types are the same
    // ä»å®ç°ä¸­å’Œæ³¨é‡Šä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦åˆ¤æ–­Upæ˜¯å¦æ˜¯Tpçš„æ´¾ç”Ÿç±»
    template &lt;typename _Up&gt;
    using __is_derived_Tp =
        __and_&lt;is_base_of&lt;_Tp, _Up&gt;,
               __not_&lt;is_same&lt;__remove_cv&lt;_Tp&gt;, __remove_cv&lt;_Up&gt;&gt;&gt;&gt;;

  public:
    using pointer = typename __uniq_ptr_impl&lt;_Tp, _Dp&gt;::pointer;
    using element_type = _Tp;
    using deleter_type = _Dp;

    // helper template for detecting a safe conversion from another
    // unique_ptr
    //è¾…åŠ©æ¨¡æ¿æ¥å¸®åŠ©å®ç°ä»å¦ä¸€ä¸ªunique_ptrè½¬æ¢æ˜¯å¦å®‰å…¨
    //å®‰å…¨è½¬æ¢çš„æ¡ä»¶æ˜¯ï¼š
    //æ˜¯ä¸€ä¸ªæ•°ç»„
    //poniterå’Œelement_type*æ˜¯åŒä¸€ç±»å‹
    //å¦ä¸€ä¸ªunique_ptr::pointerå’Œ::element_type*æ˜¯åŒä¸€ä¸ªç±»å‹
    //å¦ä¸€ä¸ªunique_ptr::element_type(*)[]å¯ä»¥è½¬æ¢ä¸ºå½“å‰çš„unique_ptr::element_type(*)[]
    //è‡³äºä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Œè¿˜æ˜¯å’Œç”¨å¤šæ€æ–¹å¼å¤„ç†æ•°ç»„æœ‰å…³ï¼Œä¸‹é¢ä¼šè¯´åˆ°
    template &lt;typename _Up, typename _Ep, typename _UPtr = unique_ptr&lt;_Up, _Ep&gt;,
              typename _UP_pointer = typename _UPtr::pointer,
              typename _UP_element_type = typename _UPtr::element_type&gt;
    using __safe_conversion_up =
        __and_&lt;is_array&lt;_Up&gt;, is_same&lt;pointer, element_type *&gt;,
               is_same&lt;_UP_pointer, _UP_element_type *&gt;,
               is_convertible&lt;_UP_element_type (*)[], element_type (*)[]&gt;&gt;;

    // helper template for detecting a safe conversion from a raw pointer
    // è¾…åŠ©æ¨¡æ¿ä»è£¸æŒ‡é’ˆè½¬æ¢ä¸ºå½“å‰çš„unique_ptr::pointer
    //è¿™æ®µä»£ç å®åœ¨æ˜¯å¤ªéš¾ä»¥é˜…è¯»äº†ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è¿›è¡Œä¸€äº›æ ¼å¼ä¸Šçš„æ”¹å˜
    // template &lt;typename _Up&gt;
    // using __safe_conversion_raw = __and_&lt;
    //     __or_&lt;__or_&lt;is_same&lt;_Up, pointer&gt;, is_same&lt;_Up, nullptr_t&gt;&gt;,
    //           __and_&lt;is_pointer&lt;_Up&gt;, is_same&lt;pointer, element_type *&gt;,
    //                  is_convertible&lt;typename remove_pointer&lt;_Up&gt;::type (*)[],
    //                                 element_type (*)[]&gt;&gt;&gt;&gt;;
    //æ»¡è¶³è½¬æ¢è§„åˆ™åªéœ€è¦æ»¡è¶³å…¶ä¸­ä»¥ä¸‹æ¡ä»¶ä¹‹ä¸€(Upæ˜¯ä¸€ä¸ªraw-pointer)
    //- Upå’Œpointeræ˜¯åŒç±»å‹æˆ–è€…Upå’Œnullptr_tæ˜¯åŒç±»å‹
    //- Upæ˜¯ä¸€ä¸ªæŒ‡é’ˆå¹¶ä¸”pointerå’Œelement_type*æ˜¯åŒä¸€ç±»å‹å¹¶ä¸”Upç§»é™¤æŒ‡é’ˆåçš„ç±»å‹çš„æ•°ç»„æŒ‡é’ˆå¯ä»¥è½¬æ¢ä¸ºelement_typeçš„æ•°ç»„æŒ‡é’ˆ
    template&lt;typename Up&gt;

    using _safe_conversion_raw = __and_&lt;
            __or_&lt;
                    __or_&lt;is_same&lt;Up, pointer&gt;, is_same&lt;Up, nullptr_t&gt; &gt;,
                    __and_&lt;
                            is_pointer&lt;Up&gt;, is_same&lt;pointer, element_type *&gt;,
                            is_convertible&lt;typename remove_pointer&lt;Up&gt;::type (*)[], element_type (*)[]&gt;
                          &gt;
                 &gt;
    &gt;;
    // Constructors.

    /// Default constructor, creates a unique_ptr that owns nothing.
    template &lt;typename _Del = _Dp, typename = _DeleterConstraint&lt;_Del&gt;&gt;
    constexpr unique_ptr() noexcept : _M_t() &#123;&#125;

    /** Takes ownership of a pointer.
     *
     * @param __p  A pointer to an array of a type safely convertible
     * to an array of @c element_type
     *
     * The deleter will be value-initialized.
     */
    template &lt;
        typename _Up, typename _Vp = _Dp, typename = _DeleterConstraint&lt;_Vp&gt;,
        typename =
            typename enable_if&lt;__safe_conversion_raw&lt;_Up&gt;::value, bool&gt;::type&gt; //åšäº†ä¸€ä¸ªç±»å‹çº¦æŸ
    explicit unique_ptr(_Up __p) noexcept : _M_t(__p) &#123;&#125;

    /** Takes ownership of a pointer.
     *
     * @param __p  A pointer to an array of a type safely convertible
     * to an array of @c element_type
     * @param __d  A reference to a deleter.
     *
     * The deleter will be initialized with @p __d
     */
     //ä»ä¸€ä¸ªraw-pointerå’Œä¸€ä¸ªåˆ é™¤å™¨æ„é€ ä¸€ä¸ªuniuqe_ptr
     //å¾ˆæ˜æ˜¾çš„éœ€è¦raw-pointerå¯ä»¥å®‰å…¨çš„è½¬æ¢ä¸ºunique_ptrå¹¶ä¸”åˆ é™¤å™¨æ˜¯å¯ä»¥æ‹·è´ç‹—ä»”çš„
    template &lt;typename _Up, typename _Del = deleter_type,
              typename = _Require&lt;__safe_conversion_raw&lt;_Up&gt;, //åªæ˜¯ç±»å‹çº¦æŸå’Œéæ•°ç»„ç‰ˆçš„ä¸ä¸€æ ·
                                  is_copy_constructible&lt;_Del&gt;&gt;&gt;
    unique_ptr(_Up __p, const deleter_type &amp;__d) noexcept : _M_t(__p, __d) &#123;&#125;

    /** Takes ownership of a pointer.
     *
     * @param __p  A pointer to an array of a type safely convertible
     * to an array of @c element_type
     * @param __d  A reference to a deleter.
     *
     * The deleter will be initialized with @p std::move(__d)
     */
    template &lt;typename _Up, typename _Del = deleter_type,
              typename = _Require&lt;__safe_conversion_raw&lt;_Up&gt;,
                                  is_move_constructible&lt;_Del&gt;&gt;&gt;
    unique_ptr(
        _Up __p,
        __enable_if_t&lt;!is_lvalue_reference&lt;_Del&gt;::value, _Del &amp;&amp;&gt; __d) noexcept
        : _M_t(std::move(__p), std::move(__d)) &#123;&#125;

    template &lt;typename _Up, typename _Del = deleter_type,
              typename _DelUnref = typename remove_reference&lt;_Del&gt;::type,
              typename = _Require&lt;__safe_conversion_raw&lt;_Up&gt;&gt;&gt;
    unique_ptr(_Up,
               __enable_if_t&lt;is_lvalue_reference&lt;_Del&gt;::value, _DelUnref &amp;&amp;&gt;) =
        delete;

    /// Move constructor.
    unique_ptr(unique_ptr &amp;&amp;) = default;

    /// Creates a unique_ptr that owns nothing.
    template &lt;typename _Del = _Dp, typename = _DeleterConstraint&lt;_Del&gt;&gt;
    constexpr unique_ptr(nullptr_t) noexcept : _M_t() &#123;&#125;

    template &lt;
        typename _Up, typename _Ep,
        typename = _Require&lt;
            __safe_conversion_up&lt;_Up, _Ep&gt;,
            typename conditional&lt;is_reference&lt;_Dp&gt;::value, is_same&lt;_Ep, _Dp&gt;,
                                 is_convertible&lt;_Ep, _Dp&gt;&gt;::type&gt;&gt;
    unique_ptr(unique_ptr&lt;_Up, _Ep&gt; &amp;&amp;__u) noexcept
        : _M_t(__u.release(), std::forward&lt;_Ep&gt;(__u.get_deleter())) &#123;&#125;

    /// Destructor, invokes the deleter if the stored pointer is not null.
    ~unique_ptr() &#123;
      auto &amp;__ptr = _M_t._M_ptr();
      if (__ptr != nullptr)
        get_deleter()(__ptr);
      __ptr = pointer();
    &#125;

    // Assignment.

    /** @brief Move assignment operator.
     *
     * Invokes the deleter if this object owns a pointer.
     */
    unique_ptr &amp;operator=(unique_ptr &amp;&amp;) = default;

    /** @brief Assignment from another type.
     *
     * @param __u  The object to transfer ownership from, which owns a
     *             convertible pointer to an array object.
     *
     * Invokes the deleter if this object owns a pointer.
     */
    template &lt;typename _Up, typename _Ep&gt;
    typename enable_if&lt;__and_&lt;__safe_conversion_up&lt;_Up, _Ep&gt;,
                              is_assignable&lt;deleter_type &amp;, _Ep &amp;&amp;&gt;&gt;::value,
                       unique_ptr &amp;&gt;::type
    operator=(unique_ptr&lt;_Up, _Ep&gt; &amp;&amp;__u) noexcept &#123;
      reset(__u.release());
      get_deleter() = std::forward&lt;_Ep&gt;(__u.get_deleter());
      return *this;
    &#125;

    /// Reset the %unique_ptr to empty, invoking the deleter if necessary.
    unique_ptr &amp;operator=(nullptr_t) noexcept &#123;
      reset();
      return *this;
    &#125;

    // Observers.
    // é‡è½½çš„[]ï¼Œå®ç°ä¹Ÿæ˜¯éå¸¸ç®€å•
    /// Access an element of owned array.
    typename std::add_lvalue_reference&lt;element_type&gt;::type
    operator[](size_t __i) const &#123;
      __glibcxx_assert(get() != pointer());
      return get()[__i];
    &#125;

    /// Return the stored pointer.
    pointer get() const noexcept &#123; return _M_t._M_ptr(); &#125;

    /// Return a reference to the stored deleter.
    deleter_type &amp;get_deleter() noexcept &#123; return _M_t._M_deleter(); &#125;

    /// Return a reference to the stored deleter.
    const deleter_type &amp;get_deleter() const noexcept &#123;
      return _M_t._M_deleter();
    &#125;

    /// Return @c true if the stored pointer is not null.
    explicit operator bool() const noexcept &#123;
      return get() == pointer() ? false : true;
    &#125;

    // Modifiers.

    /// Release ownership of any stored pointer.
    pointer release() noexcept &#123; return _M_t.release(); &#125;

    /** @brief Replace the stored pointer.
     *
     * @param __p  The new pointer to store.
     *
     * The deleter will be invoked if a pointer is already owned.
     */
    template &lt;
        typename _Up,
        typename = _Require&lt;__or_&lt;
            is_same&lt;_Up, pointer&gt;,
            __and_&lt;is_same&lt;pointer, element_type *&gt;, is_pointer&lt;_Up&gt;,
                   is_convertible&lt;typename remove_pointer&lt;_Up&gt;::type (*)[],
                                  element_type (*)[]&gt;&gt;&gt;&gt;&gt;
    void reset(_Up __p) noexcept &#123;
      _M_t.reset(std::move(__p));
    &#125;

    void reset(nullptr_t = nullptr) noexcept &#123; reset(pointer()); &#125;

    /// Exchange the pointer and deleter with another object.
    void swap(unique_ptr &amp;__u) noexcept &#123;
      static_assert(__is_swappable&lt;_Dp&gt;::value, &quot;deleter must be swappable&quot;);
      _M_t.swap(__u._M_t);
    &#125;

    // Disable copy from lvalue.
    unique_ptr(const unique_ptr &amp;) = delete;
    unique_ptr &amp;operator=(const unique_ptr &amp;) = delete;
  &#125;;
</code></pre>
<h2 id="std-make-unique"><a href="#std-make-unique" class="headerlink" title="std::make_unique"></a>std::make_unique</h2><p>ä»¤äººå¤´å¤§çš„éƒ¨åˆ†ç»ˆäºè¿‡å»äº†ï¼Œå æ®äº†æœ¬æ–‡ç« ç»å¤§ç¯‡å¹…çš„é‚£äº›éƒ¨åˆ†ã€‚æ¥ä¸‹æ¥æ”¾æ¾ä¸€ä¸‹ï¼Œçœ‹ä¸€çœ‹<code>std::make_unique</code>çš„å®ç°å§</p>
<pre><code>åœ¨è¿™é‡Œä»…ä»…åˆ†æ14çš„éƒ¨åˆ†(make_uniqueæ˜¯14å¢æ·»çš„)ï¼Œå¯¹äº14ä»¥ä¸Šçš„ä»£ç ï¼Œè¯»è€…æœ‰å…´è¶£å¯ä»¥è‡ªè¡Œäº†è§£
</code></pre>
<h3 id="MakeUniq"><a href="#MakeUniq" class="headerlink" title="_MakeUniq"></a>_MakeUniq</h3><p>åšçš„åŠŸèƒ½å°±æ˜¯ç±»å‹èƒå–ï¼Œç”¨ä½œäºmake_uniqueçš„è¿”å›å€¼ï¼Œè¿™æ ·åšçš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†å®ç°ç±»å‹å®‰å…¨</p>
<p>ç±»å‹å‚æ•°åº”ä¸ºTçš„åœ°æ–¹å†™æˆT[]ä¼šå¯¼è‡´ç±»å‹æ›¿æ¢å¤±è´¥ï¼Œåä¹‹äº¦ç„¶</p>
<pre><code class="C++">  template&lt;typename _Tp&gt;
    struct _MakeUniq
    &#123; typedef unique_ptr&lt;_Tp&gt; __single_object; &#125;;

  template&lt;typename _Tp&gt;
    struct _MakeUniq&lt;_Tp[]&gt;
    &#123; typedef unique_ptr&lt;_Tp[]&gt; __array; &#125;;

  template&lt;typename _Tp, size_t _Bound&gt;
    struct _MakeUniq&lt;_Tp[_Bound]&gt;
    &#123; struct __invalid_type &#123; &#125;; &#125;;
</code></pre>
<p>make_uniqueçš„å®ç°éƒ¨åˆ†</p>
<pre><code class="C++">  /// std::make_unique for single objects
  // éæ•°ç»„ç‰ˆæœ¬
  template&lt;typename _Tp, typename... _Args&gt;
    inline typename _MakeUniq&lt;_Tp&gt;::__single_object
    make_unique(_Args&amp;&amp;... __args) //&amp;&amp; ... +forward çš„å½¢å¼è½¬å‘å‚æ•°
    &#123; return unique_ptr&lt;_Tp&gt;(new _Tp(std::forward&lt;_Args&gt;(__args)...)); &#125;

  /// std::make_unique for arrays of unknown bound
  //è¿”å›ä¸€ä¸ªunique_ptræŒ‡å‘ä¸€ä¸ªé•¿åº¦ä¸º__numçš„æ•°ç»„
  //å…³äºremove_extent_t,è¯·å‚è€ƒhttps://www.apiref.com/cpp-zh/cpp/types/remove_extent.html
  template&lt;typename _Tp&gt;
    inline typename _MakeUniq&lt;_Tp&gt;::__array
    make_unique(size_t __num)
    &#123; return unique_ptr&lt;_Tp&gt;(new remove_extent_t&lt;_Tp&gt;[__num]()); &#125;
  
  //ä¸èƒ½ä»ä¸€ä¸ªå·²çŸ¥ç•Œé™çš„æ•°ç»„è¿”å›ä¸€ä¸ªunique_ptr
  /// Disable std::make_unique for arrays of known bound
  template&lt;typename _Tp, typename... _Args&gt;
    typename _MakeUniq&lt;_Tp&gt;::__invalid_type
    make_unique(_Args&amp;&amp;...) = delete;
</code></pre>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>unique_ptrçš„æºç åˆ†æï¼Œå°±å‘Šä¸€æ®µè½äº†ã€‚è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šç»†èŠ‚å’Œå®ç°æ‰‹æ³•æ²¡æœ‰å‰–æï¼Œå‰–æäº†çš„ç»†èŠ‚å’Œå®ç°æ‰‹æ³•ï¼Œä¸€äº›ä¹Ÿæ²¡æœ‰è¯´æ˜ä¸ºä»€ä¹ˆè¦è¿™æ ·åšã€‚</p>
<p>å¦‚æœæ—¥åå‘ç°çš„é”™è¯¯ï¼Œä¼šåœ¨è¿™é‡Œæ›´æ–°å‹˜è¯¯è¡¨ã€‚</p>
<p>å¦‚æœä½ æœ‰ä»»ä½•çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡é‚®ç®±ï¼ŒQQæ¥è”ç³»åˆ°æˆ‘ã€‚</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Modern-C/" style="color: #ffa2c4">
                Modern C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C/" style="color: #00bcd4">
                C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C-Library/" style="color: #03a9f4">
                C++ Library
            </a>
        </span>
        
    </div>
    <a href="/2022/09/22/unique-ptræºç è§£æ/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2022/09/18/ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½ä¸­çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ/">
        <h2 class="post-title">ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½ä¸­çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/18
        </span>
    </div>
    <div class="excerpt">
        <div class="content" v-pre>
            
            <h1 id="ä½¿ç”¨ä¸‡èƒ½å¼•ç”¨æ¥é€šç”¨å¼çš„å¤„ç†å·¦å€¼å³å€¼æ’åˆ—ç»„åˆçš„æƒ…å†µ"><a href="#ä½¿ç”¨ä¸‡èƒ½å¼•ç”¨æ¥é€šç”¨å¼çš„å¤„ç†å·¦å€¼å³å€¼æ’åˆ—ç»„åˆçš„æƒ…å†µ" class="headerlink" title="ä½¿ç”¨ä¸‡èƒ½å¼•ç”¨æ¥é€šç”¨å¼çš„å¤„ç†å·¦å€¼å³å€¼æ’åˆ—ç»„åˆçš„æƒ…å†µ"></a>ä½¿ç”¨ä¸‡èƒ½å¼•ç”¨æ¥é€šç”¨å¼çš„å¤„ç†å·¦å€¼å³å€¼æ’åˆ—ç»„åˆçš„æƒ…å†µ</h1><p>æˆ‘æ›¾ç»åœ¨ä¸€æ¬¡å¼€å‘ä¸­é‡åˆ°è¿‡è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘æœ‰ä¸€ä¸ªUser classï¼Œä»–é‡Œé¢æœ‰stringï¼šid, name, passwardï¼Œä»¥åŠå…¶ä»–å†…ç½®ç±»å‹.å¦‚æœæ˜¯åœ¨C++11ä¹‹å‰ï¼Œå†™å‡ºä¸€ä¸ªå¥½çš„æ„é€ å‡½æ•°åº”å½“æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä½†æ˜¯C++11ä¹‹åï¼Œæœ‰äº†ç§»åŠ¨è¯­ä¹‰ï¼Œå†™å‡ºä¸€ä¸ªå®Œç¾çš„æ„é€ å‡½æ•°ç¡®å®ä¸å®¹æ˜“ã€‚</p>
<p>è¿™æ ·æƒ³ï¼Œæˆ‘æƒ³å°½å¯èƒ½çš„åˆ©ç”¨å¥½ç§»åŠ¨è¯­ä¹‰ï¼Œå‡è®¾æˆ‘ä»¬çš„nameç­‰ç­‰æˆå‘˜ä¸æ˜¯ä¸€ä¸ªçŸ­å­—ç¬¦ä¸²ï¼Œè¿™æ—¶å€™ç§»åŠ¨è¯­ä¹‰å¯¹æ€§èƒ½ä¼šæœ‰ä¼˜åŒ–ã€‚ç°åœ¨åˆ3ä¸ªstringç±»å‹çš„æˆå‘˜ï¼Œè€ƒè™‘åˆ°æ¯ä¸ªæˆå‘˜çš„å·¦å€¼å’Œå³å€¼ï¼Œæœ‰8ç§æ„é€ å‡½æ•°çš„å†™æ³•(ä¸ç®—é»˜è®¤æ„é€ )ã€‚è¦æ˜¯è¿™ç§å¯ä»¥è¿›è¡Œç§»åŠ¨çš„æˆå‘˜å†å¤šå‡ ä¸ªå‘¢â€”â€”è¿™æ˜¯ä¸€ä¸ªæŒ‡æ•°çº§å¢é•¿çš„è¶‹åŠ¿ã€‚è¿™ç§å†™æ³•æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚é‚£å°±ç”¨æ¨¡æ¿â€”â€”è¿˜è¦æ˜¯ä¸‡èƒ½æ¨¡æ¿ã€‚å¯ä»¥åˆæ­¥è®¾è®¡å‡ºè¿™æ ·çš„æ„é€ å‡½æ•°ã€‚</p>
<pre><code class="C++">class User &#123;
public:
    template &lt;typename T&gt;
    User(T &amp;&amp; _name, T &amp;&amp; _id, T &amp;&amp; _password) :
        name(forward&lt;T&gt;(_name), forward&lt;T&gt;(_id),forward&lt;T&gt;(_password)) &#123; &#125;
&#125;
</code></pre>
<p>è¿™æ ·å“ªä¸ªæ— è®ºä»€ä¹ˆæ ·çš„ç»„åˆï¼Œæˆ‘ä»¬å‡å¯ç”¨ä¸€ä¸ªå‡½æ•°æ¥å®Œæˆã€‚è€Œä¸”å¯¹äºå…¶ä»–æœ‰ç§»åŠ¨è¯­ä¹‰çš„ç±»å‹æ¥ä¹¦ï¼Œå†åŠ ä¸Šä¸€ä¸ªF &amp;&amp;å³å¯ï¼Œè¿™æ˜¯çº¿æ€§å¢åŠ çš„ï¼Œè¿˜ç®—ä¸é”™ã€‚</p>
<h1 id="ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½ä¼šäº’ç›¸å†²çª"><a href="#ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½ä¼šäº’ç›¸å†²çª" class="headerlink" title="ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½ä¼šäº’ç›¸å†²çª"></a>ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½ä¼šäº’ç›¸å†²çª</h1><p>å½“å½¢å‚åªæœ‰ä¸€ä¸ªçš„æ—¶å€™ï¼Œä¼šæœ‰äº›å¾®å¦™çš„å˜åŒ–ã€‚</p>
<p>ç°åœ¨å‡è®¾Userä¸­åªæœ‰ä¸€ä¸ªstringç±»å‹çš„nameï¼Œå¦‚æœä½ ä¾æ—§è€ƒè™‘åƒä¸Šé¢ä¸€æ ·å®ç°æ„é€ å‡½æ•°ï¼Œä¼šæœ‰ä¸€äº›éšæ™¦çš„é”™è¯¯ã€‚</p>
<pre><code class="C++">class User &#123;
public:
    template&lt;typename T&gt;
    User(T &amp;&amp; _name): name(std::forward&lt;T&gt;(_name)) &#123; &#125;
private:
    string name;
&#125;;


int main()
&#123;
    User user(&quot;hello&quot;); //å¾ˆå¥½ï¼Œè¿™ä¸ªç”šè‡³æ˜¯ç›´æ¥å†ç±»ä¸­ç”¨const char * ç›´æ¥æ„é€ äº†ä¸€ä¸ªå­—ç¬¦ä¸²
    User user1(user);       // error
    return 0;
&#125;
</code></pre>
<p>ç¼–è¯‘å™¨ä¼šç»™å‡ºæˆ‘ä»¬è¿™æ ·çš„ä¸€ä¸ªé”™è¯¯</p>
<blockquote>
<p>No matching constructor for initialization of â€˜std::stringâ€™ (aka â€˜basic_string<char>â€˜)</p>
</blockquote>
<p>ç¼–è¯‘å™¨è¯´æ— æ³•åŒ¹é…stringçš„æ„é€ å‡½æ•°ï¼Œè«åå¥‡å¦™æœ‰äº›ã€‚<br>å®é™…ä¸Šï¼Œç¼–è¯‘å™¨ç»™å‡ºçš„é”™è¯¯ä¸€ç‚¹é—®é¢˜ä¹Ÿæ²¡æœ‰ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥å›å¤ä¸€ä¸ªæ‹·è´æ„é€ çš„å‡½æ•°åŸå‹ <code>User(const User &amp; user)</code><br>æˆ‘ä»¬ä¼ é€’çš„userä¸å…·æœ‰constæ€§è´¨ï¼Œè€Œæ¨¡æ¿ä¼šç”Ÿæˆä¸€ä¸ªnon-constçš„å½¢å‚ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·<code>User(User &amp; _name): name(_name)</code>(æ­¤å¤„çœç•¥forward,ä¸‹åŒ)ï¼Œç¼–è¯‘å™¨è§‰å¾—è¿™ä¸ªnon-constçš„ç‰ˆæœ¬æ›´åŠ åŒ¹é…ï¼Œéšåä½¿ç”¨ä¸€ä¸ªUserå¯¹è±¡æ¥æ„é€ stringï¼Œé‚£è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚<br>å¦‚æœæˆ‘ä»¬çš„userå…·æœ‰constæ€§è´¨ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="C++">int main()
&#123;
    const User user(&quot;hello&quot;); 
    User user1(user);       // å·¥ä½œçš„å¾ˆå¥½
    return 0;
&#125;
</code></pre>
<p>è¿™ç§å’Œç›´è§‰ä¸Šä¸æœçš„è¡Œä¸ºè‚¯å®šä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå¦‚æœä½ ç•™æ„ç¼–è¯‘å™¨çš„è­¦å‘Šï¼Œæˆ–è€…è¯´æ˜¯clang-tidyçš„é™æ€åˆ†æï¼Œä½ ä¼šçœ‹è§è¿™æ ·çš„è­¦å‘Š</p>
<blockquote>
<p>Clang-Tidy: Constructor accepting a forwarding reference can hide the copy and move constructors</p>
<p>Clang-Tidyï¼šæ¥å—è½¬å‘å¼•ç”¨çš„æ„é€ å‡½æ•°å¯ä»¥éšè—å¤åˆ¶å’Œç§»åŠ¨æ„é€ å‡½æ•°</p>
</blockquote>
<p>è¿˜æœ‰è¿™æ ·çš„æƒ…å†µï¼Œå‡è®¾æˆ‘ä»¬åªéœ€è¦æ„é€ ä¸€ä¸ªintç±»å‹çš„æ•°æ®æˆå‘˜ï¼Œå…¶ä»–çš„æ•°æ®æˆå‘˜éƒ½è°ƒç”¨é»˜è®¤æ„é€ ã€‚</p>
<pre><code class="C++">class User &#123;
public:
    template&lt;typename T&gt;
    explicit User(T &amp;&amp; _name): name(std::forward&lt;T&gt;(_name)) &#123;
        cout &lt;&lt; &quot;T&amp;&amp;&quot; &lt;&lt; endl;
    &#125;
    explicit User(int _age): age(_age), name() &#123; &#125;
private:
    string name;
    int age;
&#125;;
int main()
&#123;
    User user(25);
    //...å‡è®¾è¿™é‡Œç»è¿‡ç®—æ³•çš„è®¡ç®—ï¼Œå¾—å‡ºçš„ä¸€ä¸ªdoubleç±»å‹æ¥å½“ä½œageï¼Œ æˆ‘ä»¬ä¹ŸæœŸæœ›è¿™ç§éšå¼è½¬æ¢double -&gt; int(å³å‘ä¸‹å–æ•´)
    double ans = 18.63;
    User user1(ans)
    return 0;
&#125;
</code></pre>
<p>ä¸å¥½äº†ï¼Œç¼–è¯‘å™¨åˆç»™å‡ºäº†é”™è¯¯ï¼</p>
<p>åŸå› æ˜¯ä¸‡èƒ½å¼•ç”¨ä¸ºæˆ‘ä»¬å®ä¾‹åŒ–äº†ä¸€ä¸ª<code>User (double &amp; _name): name(_name)</code>,ç²¾ç¡®åº¦é«˜äºæ‰‹å†™çš„intç‰ˆæœ¬çš„æ„é€ å‡½æ•°â€”â€”ç”¨ä¸€ä¸ªdoubleæ„é€ ä¸€ä¸ªstringï¼Œå½“ç„¶æ˜¯ä¸è¡Œçš„äº†ã€‚</p>
<p>ç±»ä¼¼çš„æˆå‘˜å‡½æ•°åº”ç”¨ä¸‡èƒ½æ¨¡æ¿ä¹Ÿæœ‰è¿™æ ·çš„é‡è½½é—®é¢˜ã€‚</p>
<h2 id="åœ¨ç»§æ‰¿ä½“ç³»ä¸­ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿä¼šå‡ºç°ï¼Œç”šè‡³æ›´åŠ é”™ç»¼å¤æ‚"><a href="#åœ¨ç»§æ‰¿ä½“ç³»ä¸­ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿä¼šå‡ºç°ï¼Œç”šè‡³æ›´åŠ é”™ç»¼å¤æ‚" class="headerlink" title="åœ¨ç»§æ‰¿ä½“ç³»ä¸­ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿä¼šå‡ºç°ï¼Œç”šè‡³æ›´åŠ é”™ç»¼å¤æ‚"></a>åœ¨ç»§æ‰¿ä½“ç³»ä¸­ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿä¼šå‡ºç°ï¼Œç”šè‡³æ›´åŠ é”™ç»¼å¤æ‚</h2><p>ç°åœ¨Readerç»§æ‰¿User</p>
<pre><code class="C++">class User &#123;
public:
    template&lt;typename T&gt;
    explicit User(T &amp;&amp; _name): name(std::forward&lt;T&gt;(_name)) &#123;
        cout &lt;&lt; &quot;T&amp;&amp;&quot; &lt;&lt; endl;
    &#125;
    explicit User(int _age): age(_age), name() &#123; &#125;
    User(const User &amp; user) = default;
private:
    string name;
    int age;
&#125;;

class Reader : public User &#123;
public:
    Reader(const Reader &amp; reader) :
            User(reader), phone_number(reader.phone_number) &#123; &#125;
private:
    string phone_number;
&#125;;
</code></pre>
<p>ç¼–è¯‘å™¨ä¾æ—§è¿˜æ˜¯è¿™ä¸ªé”™è¯¯</p>
<blockquote>
<p>No matching constructor for initialization of â€˜std::stringâ€™ (aka â€˜basic_string<char>â€˜)</p>
</blockquote>
<p>åŸå› æ˜¯Reader &amp; cast -&gt; User &amp; æ˜¯ä¸€ç§éšå¼è½¬æ¢ã€‚</p>
<p>ä¸‡èƒ½å¼•ç”¨åˆå‡ºæ¥ä½œæ€ªï¼Œç”Ÿæˆè¿™æ ·çš„ç‰ˆæœ¬<code>User(Reader &amp; _name): name(_name))</code></p>
<p>æ˜¾ç„¶ï¼Œè¿™ä¸ªç‰ˆæœ¬æ›´åŠ ç²¾ç¡®ï¼Œä½¿ç”¨Reader &amp; æ„é€  stringå½“ç„¶ä¸è¡Œã€‚</p>
<p>ã€ŠModern Effective C++ã€‹,å¯¹äº›æƒ…å†µæ˜¯è¿™æ ·æ€»ç»“çš„</p>
<ul>
<li>æŠŠä¸‡èƒ½å¼•ç”¨ä½œä¸ºå€™é€‰é‡è½½å‹åˆ«ï¼Œå‡ ä¹æ€»ä¼šè®©è¯¥é‡è½½ç‰ˆæœ¬åœ¨å§‹æ–™æœªåŠçš„æƒ…å†µä¸‹è¢«è°ƒç”¨</li>
<li>å®Œç¾è½¬å‘æ„é€ å‡½æ•°çš„é—®é¢˜å°¤ä¸ºä¸¥é‡ï¼Œå› ä¸ºå¯¹äºéå¸¸é‡çš„å·¦å€¼å‹åˆ«è€Œè¨€ï¼Œä»–ä»¬ä¸€èˆ¬éƒ½ä¼šå½¢æˆç›¸å¯¹äºå¤åˆ¶æ„é€ å‡½æ•°çš„æ›´åŠ åŒ¹é…ï¼Œå¹¶ä¸”è¿˜ä¼šåŠ«æŒæ´¾ç”Ÿç±»ä¸­å¯¹åŸºç±»çš„å¤åˆ¶å’Œæ„é€ å‡½æ•°çš„è°ƒç”¨ã€‚</li>
</ul>
<h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•è¿˜æ˜¯æœ‰å¾ˆå¤šçš„ï¼Œæˆ‘ä»¬å¯ä»¥æƒè¡¡åˆ©å¼Šçš„æ¥è€ƒè™‘ã€‚</p>
<h2 id="é€€è€Œæ±‚å…¶æ¬¡"><a href="#é€€è€Œæ±‚å…¶æ¬¡" class="headerlink" title="é€€è€Œæ±‚å…¶æ¬¡"></a>é€€è€Œæ±‚å…¶æ¬¡</h2><p>ä¸æ˜¯è°éƒ½æœ‰ç²¾åŠ›å»å­¦ä¹ å¤æ‚çš„Modern C++(è¿™é‡Œå¤§éƒ¨åˆ†çš„æ„æ€æ˜¯å…³äºTMP)ï¼Œä½¿ç”¨ä¸€äº›ç®€å•çš„æ–°ç‰¹æ€§ä¹Ÿæ˜¯ä¸é”™çš„ã€‚æˆ‘ä»¬å¯ä»¥å®Œå…¨ä¸ç”¨ä¸‡èƒ½å¼•ç”¨ï¼Œå› ä¸ºç›¸æ¯”ä»£ç å¯è¯»æ€§æå…·ä¸‹é™è€Œå¸¦æ¥ä¸ç¨³å®šçš„æ€§èƒ½æå‡ï¼Œå¦‚æœä½ ä¸æ˜¯ä¸€ä¸ªå®Œç¾ä¸»ä¹‰è€…ï¼Œä»£ç å¯è¯»æ€§åº”å½“æ˜¯åº”è¯¥çš„é€‰æ‹©ã€‚</p>
<h3 id="èˆå¼ƒé‡è½½"><a href="#èˆå¼ƒé‡è½½" class="headerlink" title="èˆå¼ƒé‡è½½"></a><strong>èˆå¼ƒé‡è½½</strong></h3><p>å¤§å¯åƒRusté‚£æ ·ï¼Œèˆå¼ƒé‡è½½ï¼Œä¹Ÿæ˜¯è§£å†³åŠæ³•ä¹‹ä¸€ï¼Œä½†æ˜¯ç”±äºè¯­æ³•é—®é¢˜ï¼Œæ„é€ å‡½æ•°æ—¶è¯­è¨€å›ºæœ‰çš„ï¼Œæˆ–è®¸ä½ ä¹Ÿå¯ä»¥éº»çƒ¦ä¸€ç‚¹ï¼Œç”¨staticå‡½æ•°å®ç°ï¼Ÿå°±ä½¿ç”¨é»˜è®¤æ„é€ ï¼Œç„¶åä¸€ä¸€ä¿®æ”¹å€¼â€”â€”è¿™æ ·æ•ˆç‡åè€Œä½äº†ï¼Œèˆæœ¬é€æœ«ä¸å¯å–ã€‚æ€»ä¹‹ï¼Œèˆå¼ƒé‡è½½å¯ä»¥æš‚æ—¶çš„è§£å†³é—®é¢˜ï¼Œä½†ä¸æ˜¯ä¸€ä¸ªé•¿ä¹…ä¹‹è®¡ã€‚</p>
<h3 id="ä¼ é€’const-T-amp"><a href="#ä¼ é€’const-T-amp" class="headerlink" title="ä¼ é€’const T &amp;"></a>ä¼ é€’const T &amp;</h3><p>è¿™å°±æ˜¯98æ—¶å€™çš„å†™æ³•äº†ï¼Œç»å…¸æ°¸ä¸è¿‡æ—¶ï¼Œè¿™ç§å†™æ³•ç®€æ´åˆä¸å¤±é«˜æ€§èƒ½ï¼Œå¹¶ä¸”ä¸ä¼šåˆå…¶ä»–çš„é—®é¢˜å‡ºç°ï¼Œè¿™ç§æ–¹å¼å¤§å®¶åº”å½“éƒ½å¾ˆç†Ÿæ‚‰ï¼Œè¿˜æ˜¯å¾ˆå€¼å¾—è€ƒè™‘çš„ã€‚</p>
<h2 id="ä½¿ç”¨ç°ä»£æ–¹æ³•"><a href="#ä½¿ç”¨ç°ä»£æ–¹æ³•" class="headerlink" title="ä½¿ç”¨ç°ä»£æ–¹æ³•"></a><strong>ä½¿ç”¨ç°ä»£æ–¹æ³•</strong></h2><p>å¦‚æœä½ é€‰æ‹©äº†ä½¿ç”¨ç°ä»£æ–¹æ³•è§£å†³æ­¤é—®é¢˜ï¼Œå°±ä»£è¡¨äº†ä½ è¸è¿›äº†Modern C++çš„å¤§é—¨ï¼Œä¸ä»…ä»…æ˜¯å…³äº&amp;&amp;å’Œ&amp;çš„è¯­æ³•æ¸¸æˆï¼Œä½ å¿…é¡»å…·æœ‰TMP(æ¨¡æ¿å…ƒç¼–ç¨‹çš„åŸºç¡€),æ‰å¯ä»¥æ¸¸åˆƒæœ‰ä½™çš„å†™å‡ºå¥‡å¦™çš„Modern C++ä»£ç ï¼Œå¦‚æœä½ è¿˜ä¸å…·å¤‡è¿™é¡¹æŠ€èƒ½ï¼Œåˆæƒ³ä½¿ç”¨é«˜çº§æ‰‹æ³•æ¥è§£å†³é—®é¢˜ï¼Œé‚£ä½ åº”å½“åšå¥½å‡†å¤‡è¿æ¥ä¸€è½®åˆä¸€è½®çš„æ–°ç‰¹æ€§å­¦ä¹ ã€‚</p>
<blockquote>
<p>é¢˜å¤–è¯ï¼šæˆ‘æŠŠModern C++ä»£ç è¯´åšæ˜¯â€œå¥‡å¦™çš„â€ï¼Œè€Œä¸æ˜¯â€œç²¾ç¾çš„â€ã€â€œç®€æ´çš„â€è¿™ç±»è¯æ˜¯æœ‰åŸå› çš„ï¼Œä¸€ä¸ªåŸºæœ¬çš„äº‹å®ï¼ŒModern C++ä»£ç å¹¶ä¸ç®€æ´ï¼Œç”šè‡³æ˜¯ä¸‘é™‹å’Œå¤æ‚ï¼Œä½†è¿™äº›å¤æ‚çš„ä»£ç èƒŒåçš„å·¥ä½œåŸç†ï¼Œäº†è§£ä¹‹åæ²¡æœ‰äººä¸ä¼šæƒŠå¹ï¼Œä¸ä¼šå¤§å‘¼å¥‡å¦™ã€‚</p>
</blockquote>
<h3 id="ä¼ å€¼"><a href="#ä¼ å€¼" class="headerlink" title="ä¼ å€¼"></a><strong>ä¼ å€¼</strong></h3><p>å¯ä»¥ä½¿ç”¨å€¼ä¼ é€’+ç§»åŠ¨æ„é€ çš„æ–¹å¼æ¥ä»£æ›¿ä¸‡èƒ½å¼•ç”¨å’Œè½¬å‘ã€‚å¦‚æœå¯¹è±¡çš„ç§»åŠ¨è¯­ä¹‰æœ‰è¾ƒä½çš„æˆæœ¬ä½¿ç”¨ pass by value and use std::moveä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚</p>
<p>æ¯”å¦‚è¯´åƒè¿™æ ·</p>
<pre><code class="C++">class User &#123;
public:
    template&lt;typename T&gt;
    explicit User(string _name): name(std::move(_name)) &#123;
    &#125;
    explicit User(int _age): age(_age), name() &#123; &#125;
    User(const User &amp; user) = default;
private:
    string name;
    int age&#123;&#125;;
&#125;;
</code></pre>
<p>ä½†æ˜¯è¿™ä¸ªé€‰æ‹©ä¸å¤Ÿé€šç”¨ï¼Œå¦‚æœå¯¹è±¡æ²¡æœ‰ç§»åŠ¨è¯­ä¹‰ï¼Œæˆ–è€…æ˜¯PODç±»å‹ï¼Œè¿™æ ·åšæ€§èƒ½åè€Œä¼šä¸‹é™ã€‚ä½ å¯ä»¥é˜…è¯»è¿™ä¸ªæ–‡ç« <a target="_blank" rel="noopener" href="https://jan6055.github.io/2022/09/17/pass-by-value-and-use-std-move/">https://jan6055.github.io/2022/09/17/pass-by-value-and-use-std-move/</a> æ¥äº†è§£ç›¸å…³ä¿¡æ¯ã€‚</p>
<h3 id="æ ‡ç­¾åˆ†æ´¾"><a href="#æ ‡ç­¾åˆ†æ´¾" class="headerlink" title="æ ‡ç­¾åˆ†æ´¾"></a><strong>æ ‡ç­¾åˆ†æ´¾</strong></h3><p>å¦‚æœä½ çœ‹è¿‡ä¸€äº›STLçš„æºä»£ç ï¼Œå¯èƒ½ä¼šç†Ÿæ‚‰è¿™ç§æ–¹å¼ï¼Œå¤§è‡´çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬æŠŠæ„é€ å‡½æ•°å§”æ´¾ç»™å…¶ä»–å‡½æ•°ï¼Œè¿™äº›å‡½æ•°åšå…·ä½“çš„å®ç°ï¼Œå¹¶ä¸”ä»–ä»¬æœ‰ä¸åŒçš„é‡è½½ç‰ˆæœ¬ï¼Œåˆ†åˆ«æ¥å—æ„é€ æ‰€éœ€è¦çš„å‚æ•°å’Œä¸€ä¸ªåä¸ºtrue_type&#x2F;false_typeç±»å‹çš„å¯¹è±¡</p>
<blockquote>
<p>true_typeå’Œfalse_typeç”±æ ‡å‡†åº“æä¾›ï¼Œä»…ä»…æ˜¯å®šä¹‰ï¼Œå¹¶æœªæ·»åŠ ä»»ä½•æ•°æ®å’Œè¡Œä¸ºï¼Œ å®ç°æ ‡ç­¾çš„æ•ˆæœã€‚</p>
</blockquote>
<p>åˆ¤æ–­Tæ˜¯ä¸æ˜¯æ•´å½¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>std::is_integral</code>ï¼Œä½†æ˜¯è€ƒè™‘å·¦å€¼çš„æƒ…å†µï¼ŒTè¢«æ¨æ–­ä¸ºint &amp;ï¼Œæˆ‘ä»¬åº”å½“å…ˆæŠŠå¼•ç”¨æ€§è´¨ç»™ç§»é™¤ï¼Œå¯ä»¥ä½¿ç”¨<code>std::remove_reference</code>å¾—å‡ºçš„ä»£ç å°±æ˜¯è¿™æ ·<code>std::is_integral&lt;std::remove_reference_t&lt;T&gt;&gt;()</code>, æˆ‘ä»¬ä½¿ç”¨çš„_tåç¼€çš„æ¨¡æ¿ï¼ˆTMPä¸­å«åšå…ƒå‡½æ•°ï¼‰æ¥ç›´æ¥è·å¾—ç±»å‹â€”â€”è¿™æ˜¯C++14æ”¯æŒçš„ï¼Œä½†æ˜¯ï¼Œåˆ«å¿˜äº†ä½¿ç”¨<code>()</code>æ¥ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œæ‰å¯ç”¨äºé‡è½½ã€‚</p>
<p>å…·ä½“çš„å®ç°å¦‚ä¸‹</p>
<pre><code class="C++">class User &#123;
public:
    template&lt;typename T&gt;
    explicit User(T &amp;&amp; arg) &#123;
        init(std::forward&lt;T&gt;(arg),
        typename std::is_integral&lt;std::remove_reference_t&lt;T&gt;&gt;()
        );
    &#125;

    template&lt;typename T&gt;
    void init(T &amp;&amp; _name, false_type) &#123;
        name = std::forward&lt;T&gt;(_name);  //è¿™é‡Œæ˜¯èµ‹å€¼æ“ä½œï¼Œå¦‚æœä½¿ç”¨è¿™æ ·çš„æ‰‹æ³•å¯¹äºæ„é€ å‡½æ•°è€Œè¨€ï¼Œå°±åªèƒ½è¿™æ ·
        age = 0;
    &#125;
    void init(int _age, true_type) &#123;
        //nameä¼šéšå¼çš„åˆå§‹åŒ–
        age = _age;
    &#125;
    User(const User &amp; user) = default;
private:
    string name;
    int age&#123;&#125;;
&#125;;
</code></pre>
<p>è¿™ç¡®å®å¤Ÿå¤æ‚ï¼Œå…ˆåˆ«æ”¾æ¾ï¼Œæ›´å¤æ‚çš„è¿˜åœ¨åé¢ï¼</p>
<h3 id="ä½¿ç”¨TMPå¯¹ä¸‡èƒ½æ¨¡æ¿åšå‡ºé™åˆ¶"><a href="#ä½¿ç”¨TMPå¯¹ä¸‡èƒ½æ¨¡æ¿åšå‡ºé™åˆ¶" class="headerlink" title="ä½¿ç”¨TMPå¯¹ä¸‡èƒ½æ¨¡æ¿åšå‡ºé™åˆ¶"></a><strong>ä½¿ç”¨TMPå¯¹ä¸‡èƒ½æ¨¡æ¿åšå‡ºé™åˆ¶</strong></h3><p>å…ˆè¯´æ˜ä¸€ç‚¹ï¼Œä½ åº”å½“äº†è§£TMPå¹¶ä¸”ç†Ÿæ‚‰å…¶æœ€åŸºæœ¬æ„æˆï¼Œè¿˜åº”å½“çŸ¥é“SFINAEï¼Œå¦‚æœä½ ä¸çŸ¥é“ï¼Œå¿«å»æ‰¾ç›¸å…³ä¹¦ç±çœ‹å§ï¼Œå¦‚æœæˆ‘æŠŠè¿™é‡Œå±•å¼€è¯´æ˜ï¼Œå¹¶ä¸”æŠŠç”¨åˆ°çš„TMPæŠ€å·§ç»†èŠ‚å…¨éƒ¨è¯´ä¸€éï¼Œé‚£å°±åç¦»ä¸»é¢˜äº†ã€‚å¹¶ä¸”ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰è¶³å¤Ÿçš„èƒ½åŠ›è®²æ¸…TMPä¸­çš„æ‰€æœ‰ç»†èŠ‚å’Œé—®é¢˜ï¼Œè¿™ä»¶äº‹æƒ…ä½ åº”å½“è¯·æ•™C++æ ‡å‡†å§”å‘˜ä¼š(bushi</p>
<p>æˆ‘ä»¬å¯ä»¥è®©ä¸‡èƒ½å¼•ç”¨æ‹’ç»Userç±»çš„å¯¹è±¡ï¼Œä¹Ÿæ‹’ç»intç±»çš„å¯¹è±¡ã€‚åœ¨ç°ä»£C++ä¸­ï¼Œè¿™æ˜¯å¯ä»¥å®ç°çš„â€”â€”ä½ ç”šè‡³èƒ½åœ¨98é‡Œå®ç°ï¼Œä½†æ˜¯éœ€è¦ç‚¹æŠ€å·§ã€‚</p>
<p>ä½¿ç”¨enable_ifæ¥è®©ç¼–è¯‘å™¨ç±»å‹æ›¿æ¢å¤±è´¥ï¼Œä¹Ÿå°±æ˜¯SFINAE, ä½†æ˜¯æˆ‘ä»¬åº”å½“è€ƒè™‘åˆ°å·¦å€¼çš„æƒ…å†µT , T&amp;å¹¶ä¸æ˜¯ä¸€ç§ç±»å‹ï¼Œæ¯”å¦‚int, int&amp;, è¿˜æœ‰<code>const T, volatile T, const volatileT</code> è¿™äº›å’ŒTå‡ä¸æ˜¯ä¸€ç§ç±»å‹ã€‚å¯ä»¥ä½¿std::decayæ¥å»æ‰cvræ€§è´¨ã€‚</p>
<p>å…·ä½“çš„å®ç°æ˜¯è¿™æ ·</p>
<pre><code class="C++">class User &#123;
public:
    template&lt;typename T,
             typename = typename std::enable_if&lt;!std::is_same&lt;User,std::decay_t&lt;T&gt;&gt;::value &amp;&amp;
                                                !std::is_integral&lt;std::remove_reference&lt;T&gt;&gt;::value
                                               &gt;::type&gt;
    explicit User(T &amp;&amp; _name) : name(std::forward&lt;T&gt;(_name)) &#123; &#125;
    explicit User(int _age) : age(_age), name()&#123; &#125;
    User(const User &amp; user) = default;
private:
    string name;
    int age&#123;&#125;;
&#125;;
</code></pre>
<p>è¿™æ ·å®ç°è¿˜çœŸæ˜¯å¤æ‚ï¼Œå¦‚æœæ²¡æœ‰C++14<code>_t</code>çš„å…ƒå‡½æ•°ï¼Œé‚£ä¹ˆå°†ä¼šæ›´åŠ å¤æ‚ï¼Œæ„Ÿè°¢C++14!<br>å¤§åŠŸå‘Šæˆäº†å—ï¼Œå¹¶æ²¡æœ‰ã€‚å¯¹äºç»§æ‰¿å…³ç³»æ¥è¯´ï¼Œè¿˜æ˜¯å­˜åœ¨é—®é¢˜ã€‚å¦‚æœå­ç±»ä¸­è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬è®¨è®ºè¿‡çš„å“ªä¸ªé—®é¢˜ã€‚åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œåœ¨ç»è¿‡ç±»å‹é€€åŒ–åï¼ŒTè¢«æ¨æ–­ä¸ºReaderï¼Œè¿™å°±åˆå›åˆ°äº†æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é—®é¢˜ã€‚</p>
<p>å¥½åœ¨STLä¸­æä¾›äº†<code>is_base_of</code>è¿™ä¸ªå…ƒå‡½æ•°ï¼Œèƒ½å¤Ÿåˆ¤æ–­ä¸€ä¸ªç±»å‹æ˜¯å¦æ˜¯å¦ä¸€ä¸ªç±»å‹çš„åŸºç±»,<code>is_base_of&lt;T,T&gt;::value = ture</code></p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥ç®€å•çš„ä¿®æ”¹ä¸€ä¸‹ä»£ç ã€‚</p>
<pre><code class="C++">class User &#123;
public:
    template&lt;typename T,
             typename = typename std::enable_if&lt;!std::is_base_of&lt;User,std::decay_t&lt;T&gt;&gt;::value &amp;&amp;
                                                !std::is_integral&lt;std::remove_reference&lt;T&gt;&gt;::value
                                               &gt;::type&gt;
    explicit User(T &amp;&amp; _name) : name(std::forward&lt;T&gt;(_name)) &#123; &#125;
    explicit User(int _age) : age(_age), name()&#123; &#125;
    User(const User &amp; user) = default;
private:
    string name;
    int age&#123;&#125;;
&#125;;

class Reader : public User &#123;
public:
    Reader(const Reader &amp; reader) :
            User(reader), phone_number(reader.phone_number) &#123; &#125;
private:
    string phone_number;
&#125;;
</code></pre>
<p>é—®é¢˜è¿åˆƒè€Œè§£ï¼ä½ ç°åœ¨æ˜¯å¦æ„Ÿå¹Modern C++çš„å·§å¦™äº†å‘¢ï¼Ÿ</p>
<h1 id="ä¸‡èƒ½æ¨¡æ¿çš„ä¸è¶³"><a href="#ä¸‡èƒ½æ¨¡æ¿çš„ä¸è¶³" class="headerlink" title="ä¸‡èƒ½æ¨¡æ¿çš„ä¸è¶³"></a>ä¸‡èƒ½æ¨¡æ¿çš„ä¸è¶³</h1><p>ä½ ä¼šè¯´ï¼Œèƒ½æœ‰ä»€ä¹ˆä¸è¶³å‘¢ï¼Ÿè¿™ä¹ˆé«˜çº§çš„æŠ€å·§ï¼Œå¤šä¹ˆçš„ç¥å¥‡ã€‚å®é™…ä¸Šï¼Œä¸‡èƒ½å¼•ç”¨çš„å¼ºå¤§å¦‚æ­¤ï¼Œä¸è¶³ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å›å¤´çœ‹çœ‹ç»å…¸ç‰ˆæœ¬</p>
<pre><code class="C++">class User &#123;
public:
    explicit User(const string &amp; _name): name(_name) &#123; &#125;
    explicit User(int _age) : age(_age), name() &#123; &#125;
    User(const User &amp;) = default;
private:
    string name;
    int age&#123;&#125;;
&#125;;
</code></pre>
<p>æ­£æ‰€è°“æ´—å»é“…ååªå‰©é‡‘ï¼Œå®ç°äº†åŒæ ·çš„åŠŸèƒ½ï¼Œéš¾é“æˆ‘ä»¬è¦ä¸ºæ€§èƒ½èˆå¼ƒæ‰å¦‚æ­¤çš„å¯è¯»æ€§å’Œç®€æ´æ€§å—ã€‚åŒæ ·çš„ï¼Œå¦‚æœæ˜¯å›¢é˜Ÿåˆä½œï¼Œå°ä¼™ä¼´ä»¬å¯éƒ½ä¸ä¸€å®šä¼šè¿™æ ·çš„é«˜çº§æŠ€å·§ã€‚åˆ°å¤´æ¥è¿˜è¦ä½ è‡ªå·±ç»´æŠ¤ã€‚å¦‚æœæ²¡æœ‰æ³¨é‡Šï¼Œç­‰ä¸ªå‡ å¤©â€”â€”ä½ å°±ä¸çŸ¥é“è‡ªå·±å†™çš„æ˜¯ä»€ä¹ˆå•¦ï¼ŒçœŸæ˜¯å¤ªæ£’äº†ï¼</p>
<p>ä½¿ç”¨æ¨¡æ¿çš„ä¸€ä¸ªä¸å¯é¿å…çš„é—®é¢˜å°±æ˜¯å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œä¸å¥½å®šä½ã€‚ä½ åº”è¯¥æœ‰æ²¡æœ‰æŒ‰ç…§è§„èŒƒä½¿ç”¨è¿‡STLå®¹å™¨çš„ç»å†ï¼Œçœ‹è§äº†ç¼–è¯‘å™¨ç»™ä½ æŠ¥å‘Šçš„é”™è¯¯ã€‚å¾ˆå“äººï¼Œå¦‚æœæ²¡æœ‰ç»éªŒçš„äººçœ‹åˆ°è¿™äº›é”™è¯¯ï¼ˆå¯èƒ½æœ‰å‡ ç™¾è¡Œç”šè‡³å‡ åƒè¡Œï¼‰ã€‚è¯¥æ€ä¹ˆå®šä½é—®é¢˜ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>statci_assert</code>æ¥æœªé›¨ç»¸ç¼ªã€‚ä½†ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„æ—¶å€™æƒ…å†µéƒ½å¾ˆå®¢è§‚ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»ä¹‹ï¼Œè¦ä¸è¦ä½¿ç”¨å¦‚æ­¤æ™¦æ¶©å¤æ‚çš„ç‰¹æ€§ï¼Œè¿˜æ˜¯å–å†³äºç¨‹åºå‘˜æœ¬èº«ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨const &amp;å¿«å¿«ä¹ä¹çš„å†™ä»£ç ï¼Œæ­£å› ä¸º</p>
<blockquote>
<p>ä½ æ²¡æœ‰ç”¨åˆ°çš„ä¸œè¥¿ï¼Œä¸åº”å½“ç»™ä½ å¢æ·»ä»»ä½•è´Ÿæ‹…ï¼Œä½ ç”¨åˆ°çš„ä¸œè¥¿ï¼Œæ²¡æœ‰ä»€ä¹ˆæ¯”C++æä¾›çš„æ›´å¥½äº†</p>
</blockquote>
<p>ä½¿ç”¨Modern C++ä¹Ÿæ˜¯ä½ è‡ªå·±çš„é€‰æ‹©ï¼Œé™¤éå†™åº“ï¼Œå¾ˆå°‘æœ‰äººèƒ½ç”¨åˆ°æ¨¡æ¿å¼€å‘ï¼ŒçœŸæ­£æŠŠè¿™äº›Modern C++ç‰¹æ€§ç”¨åˆ°ç”Ÿäº§ç¯å¢ƒçš„ï¼Œå¹¶ä¸”ç”¨å¥½çš„ï¼Œæˆ‘æƒ³éƒ½æ˜¯åœ¨C++é¢†åŸŸå‘å…‰å‘çƒ­çš„å¤§ç‰›ä»¬å§ã€‚</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Modern-C/" style="color: #ffa2c4">
                Modern C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C/" style="color: #00bcd4">
                C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/TMP/" style="color: #00bcd4">
                TMP
            </a>
        </span>
        
    </div>
    <a href="/2022/09/18/ä¸‡èƒ½å¼•ç”¨å’Œé‡è½½ä¸­çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2022/09/17/ROV/">
        <h2 class="post-title">ROV</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/17
        </span>
    </div>
    <div class="excerpt">
        <div class="content" v-pre>
            
            <h1 id="è¿”å›å€¼ä¼˜åŒ–"><a href="#è¿”å›å€¼ä¼˜åŒ–" class="headerlink" title="è¿”å›å€¼ä¼˜åŒ–"></a>è¿”å›å€¼ä¼˜åŒ–</h1><p>æˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€æ®µä»£ç </p>
<pre><code class="C++">X getX() &#123;
    X x;
    //...
    return x;
&#125;
</code></pre>
<p>ä½ å¯èƒ½ä¼šè¯´ï¼Œwåœ¨è¿”å›çš„æ—¶å€™éœ€è¦è¿›è¡Œæ‹·è´ä¸€æ¬¡ã€‚å¦‚æœä½ è¿˜æŠ±æœ‰è¿™ç§æƒ³æ³•ï¼Œä½ åº”è¯¥æ‹¥å‘ç°ä»£C++çš„æ€€æŠ±äº†ï¼Œç°åœ¨çš„æ ‡å‡†è§„å®šï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µä»¥åŠç±»ä¼¼çš„æƒ…å†µï¼Œç¼–è¯‘å™¨åº”å½“åšè¿”å›å€¼ä¼˜åŒ–(return value optimmization)ã€‚ä½¿å¾—è°ƒç”¨getWidgetå°±åƒç›´æ¥åœ¨è°ƒç”¨å¤„æ„é€ äº†ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸ç”¨ç»è¿‡ä¸€æ¬¡å¤åˆ¶ã€‚</p>
<h1 id="C-æ ‡å‡†å¯¹äºè¿”å›å€¼çš„ä¼˜åŒ–"><a href="#C-æ ‡å‡†å¯¹äºè¿”å›å€¼çš„ä¼˜åŒ–" class="headerlink" title="C++æ ‡å‡†å¯¹äºè¿”å›å€¼çš„ä¼˜åŒ–"></a>C++æ ‡å‡†å¯¹äºè¿”å›å€¼çš„ä¼˜åŒ–</h1><blockquote>
<p>æ­¤å¤„å‚è€ƒC++æ ‡å‡†åº“ä¸­æ–‡ç¬¬äºŒç‰ˆ P22-P23</p>
</blockquote>
<p>C++æ ‡å‡†æŒ‡å‡ºï¼Œå¯¹äºä»¥ä¸Šçš„ä»£ç ï¼Œæœ‰ç€è¿™æ ·çš„ä¿è¯ã€‚</p>
<ul>
<li>å¦‚æœXæœ‰ä¸€ä¸ªå¯å–çš„copy&#x2F;moveæ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å¯ä»¥é€‰æ‹©å¿½ç•¥å…¶ä¸­çš„copyç‰ˆæœ¬ã€‚</li>
<li>å¦åˆ™ï¼Œå¦‚æœXæœ‰ä¸€ä¸ªmoveæ„é€ å‡½æ•°ï¼ŒXå°±è¢«moved</li>
<li>å¦åˆ™ï¼Œå¦‚æœXæœ‰ä¸€ä¸ªcopyæ„é€ å‡½æ•°ï¼ŒXå°±è¢«copied</li>
<li>å¦åˆ™ï¼ŒæŠ¥å‘Šå‡ºä¸€ä¸ªç¼–è¯‘å™¨é”™è¯¯</li>
</ul>
<p>æˆ‘ä»¬éœ€è¦å¯¹ä¸Šè¿°çš„è§„åˆ™ä¸€ä¸€è§£é‡Š<br>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬ä¾æ—§éœ€è¦å‡†å¤‡ä¸€ä¸ªæµ‹è¯•æ‰€ç”¨çš„ç±»</p>
<pre><code class="c++">#include &lt;iostream&gt;
using namespace std;
struct Foo &#123;
    int a = 0;
    double b = 0;
    string c;
    Foo() = default;
    Foo(int _a, double _b, const string &amp; _c) : a(_a), b(_b), c(_c) &#123; &#125;
    Foo(const Foo &amp; foo) : a(foo.a), b(foo.b), c(foo.c) &#123;
        cout &lt;&lt;  &quot;call &amp;&quot; &lt;&lt; endl;
    &#125;
    Foo(Foo &amp;&amp; foo)  noexcept : a(foo.a), b(foo.b), c(std::move(foo.c))  &#123;
        cout &lt;&lt; &quot;call &amp;&amp;&quot; &lt;&lt; endl;
    &#125;

&#125;;

Foo getFoo_1(int a = 0, double b = 0, const string &amp; c = &#123; &#125;) &#123;
    cout &lt;&lt; &quot;+++++&quot; &lt;&lt; endl;
    Foo ret(a,b,c);
    return ret;
&#125;
Foo getFoo_2(int a = 0, double b = 0, const string &amp; c = &#123; &#125;) &#123;
    cout &lt;&lt; &quot;+++++&quot; &lt;&lt; endl;
    Foo ret(a,b,c);
    return std::move(ret);
&#125;
Foo getFoo_3() &#123;
    cout &lt;&lt; &quot;+++++&quot; &lt;&lt; endl;
    Foo ret;
    ret.a = 10;
    ret.a *= 20;
    return ret;
&#125;
Foo getFoo_4() &#123;
    cout &lt;&lt; &quot;+++++&quot; &lt;&lt; endl;
    Foo ret;
    Foo &amp; r_ret = ret;
    return r_ret;
&#125;

Foo getFoo_5() &#123;
    cout &lt;&lt; &quot;+++++&quot; &lt;&lt; endl;
    static Foo ret;
    return ret;
&#125;
void work(const Foo &amp; foo) &#123;
&#125;
int main()
&#123;
    work(getFoo_1(0,0,&quot;hello&quot;));
    work(getFoo_2());
    work(getFoo_3());
    work(getFoo_4());
    work(getFoo_5());
    return 0;
&#125;
</code></pre>
<p>æµ‹è¯•çš„ç»“æœå¦‚ä¸‹</p>
<pre><code>+++++   //RVO
+++++   
call &amp;&amp; //æˆ‘ä»¬çš„è‡ªä½œèªæ˜ï¼Œç»„ç»‡äº†ç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œå› ä¸ºmoveå°†å¯¹è±¡å˜ä¸º&amp;&amp;ï¼Œåˆ™moved
+++++   //RVO
+++++   
call &amp;  //è¿™é‡Œæˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªå¼•ç”¨ï¼Œç¼–è¯‘å™¨ä¸å†è¿›è¡ŒRVOè€Œæ˜¯copide
+++++   
call &amp;  //è¿”å›äº†ä¸€ä¸ªstaticå˜é‡ï¼Œmoveæ˜¯ä¸å¯è¡Œçš„ï¼Œå› æ­¤copide
</code></pre>
<h1 id="æµ‹è¯•ç»“æœçš„æ€è€ƒ"><a href="#æµ‹è¯•ç»“æœçš„æ€è€ƒ" class="headerlink" title="æµ‹è¯•ç»“æœçš„æ€è€ƒ"></a>æµ‹è¯•ç»“æœçš„æ€è€ƒ</h1><p>ä¸éš¾çœ‹å‡ºï¼Œç¼–è¯‘å™¨åœ¨å¾ˆå¤šçš„æƒ…å†µä¸‹éƒ½ä¼šä¸ºæˆ‘ä»¬åšè¿”å›å€¼ä¼˜åŒ–ï¼Œå³ä½¿æˆ‘ä»¬åœ¨å·¥å‚å‡½æ•°ä¸­è¿›è¡Œäº†ä¸€äº›é¢å¤–çš„æ“ä½œã€‚</p>
<p>æˆ‘ä»¬è‡ªä½œèªæ˜çš„moveæ“ä½œï¼Œåè€Œä¼šé˜»æ­¢ç¼–è¯‘å™¨çš„RVOï¼Œå¦‚æœå¯¹è±¡çš„ç§»åŠ¨è¯­ä¹‰æˆæœ¬ä¸ä½ï¼Œæˆ‘ä»¬ä¼šèªæ˜åè¢«èªæ˜è¯¯ã€‚</p>
<p>å¯¹äºé‚£äº›ä¸å¯é¿å…çš„copyï¼Œæ˜¯æ²¡æœ‰åŠæ³•è§„é¿çš„ã€‚</p>
<h1 id="ä¸è¦è‡ªä½œèªæ˜"><a href="#ä¸è¦è‡ªä½œèªæ˜" class="headerlink" title="ä¸è¦è‡ªä½œèªæ˜"></a>ä¸è¦è‡ªä½œèªæ˜</h1><p>ä½ ä¹Ÿè®¸ä¼šç»å°½è„‘æ±çš„æƒ³è±¡å‡ºè¿™æ ·çš„ä»£ç ï¼Œç”šè‡³è¿˜ä¼šå¾ˆå¾—æ„çš„ä»¥ä¸ºè‡ªå·±è§£å†³çš„è¿”å›å€¼ä¼˜åŒ–çš„é—®é¢˜</p>
<pre><code class="C++">X &amp;&amp; getX() &#123;
    X x;
    return x;
&#125;
</code></pre>
<p>å®é™…ä¸Šè¿™æ ·çš„è¡Œä¸ºä¸å¯å–ï¼Œå› ä¸ºå³å€¼å¼•ç”¨ä¹Ÿæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œè¿”å›å±€éƒ¨å¯¹è±¡çš„å¼•ç”¨â€”-ä½ æ˜¯å«Œå¼ƒdebugæ—¶å€™æ¶ˆè€—çš„ç²¾åŠ›è¿˜ä¸å¤Ÿå¤šå—ã€‚</p>
<p>ä½ å¯èƒ½åˆä¼šåé©³è¯´ï¼Œé‚£æˆ‘å¯ä»¥è¿™æ ·</p>
<pre><code class="C++">X &amp;&amp; getX() &#123;
    X x;
    return std::move(x);
&#125;
</code></pre>
<p>å¾ˆé—æ†¾ï¼Œè¿˜æ˜¯ä¸å¯ä»¥ï¼Œä½ å¤§å¯å¯ä»¥è‡ªå·±è¯•è¯•ï¼Œä½ ä¸€æ—¦è®¿é—®è¿™æ ·è¿”å›çš„å¯¹è±¡ï¼Œç¨‹åºå°±ä¼šé©¬ä¸Šå´©æºƒï¼ï¼ï¼åŒç†çš„ï¼Œä½ ä¹Ÿä¸åº”å½“å¯¹è¦è¿”å›çš„å±€éƒ¨å¯¹è±¡å®æ–½forward.</p>
<p>æ‰€ä»¥ï¼Œä¸è¦è‡ªå·±è€å°èªæ˜äº†ï¼Œè¯¥æ€ä¹ˆå†™å°±æ€ä¹ˆå†™ï¼Œç¼–è¯‘å™¨ä¼šä¸ºä¼˜åŒ–åšæ“åŠ³ã€‚</p>
<h1 id="å¯¹äºå‚æ•°åŒ…çš„ä¼˜åŒ–"><a href="#å¯¹äºå‚æ•°åŒ…çš„ä¼˜åŒ–" class="headerlink" title="å¯¹äºå‚æ•°åŒ…çš„ä¼˜åŒ–"></a>å¯¹äºå‚æ•°åŒ…çš„ä¼˜åŒ–</h1><p>å¯¹äºå‚æ•°çš„å‚æ•°åŒ…çš„ä¼˜åŒ–ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä½ å°±æŠŠä»–å½“ä½œå’Œä¸Šé¢çš„æƒ…å†µä¸€æ ·å°±å¯ä»¥ã€‚</p>
<pre><code class="C++">template&lt;typename ... Args&gt;
Foo getFoo_6(Args &amp;&amp; ... args) &#123;
    cout &lt;&lt; &quot;+++++&quot; &lt;&lt; endl;
    Foo foo(std::forward&lt;Args&gt;(args)...);
    return foo;
&#125;

...

work(getFoo_6(10,10.3,&quot;hello&quot;));
</code></pre>
<p>ä½ å¯ä»¥è‡ªå·±è¿è¡Œä¸€ä¸‹è¯•è¯•çœ‹ã€‚</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Modern-C/" style="color: #00a596">
                Modern C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C/" style="color: #00bcd4">
                C++
            </a>
        </span>
        
    </div>
    <a href="/2022/09/17/ROV/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2022/09/17/template/">
        <h2 class="post-title">C++æ¨¡æ¿è¯¦è§£</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/17
        </span>
    </div>
    <div class="excerpt">
        <div class="content" v-pre>
            
            <p>æ¨¡æ¿æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„C++åŠŸèƒ½ï¼ŒSTLçš„å„ç§ç»„ä»¶ä¹Ÿæ˜¯åŸºäºæ¨¡æ¿çš„ã€‚æ‰€ä»¥ï¼Œæ— è®ºæ˜¯å†™ç¨‹åºäº†ï¼Œè¿˜æ˜¯è¯»ç¨‹åºï¼Œéƒ½æœ‰å¿…è¦äº†è§£ä¸€ä¸‹C++çš„æ¨¡æ¿ã€‚</p>
<p>å…³äºä»€ä¹ˆæ˜¯æ¨¡æ¿æˆ–è€…æ¨¡æ¿çš„åŸºæœ¬å®šä¹‰ï¼Œè¿™é‡Œå°±ä¸è®²è¿°äº†ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦ç½—åˆ—å‡ºåœ¨ä½¿ç”¨æ¨¡æ¿è¿‡ç¨‹ä¸­çš„ä¸€äº›é—®é¢˜å’Œæ¨¡æ¿ä¸€äº›ä»¤äººå¤´ç–¼çš„è¯­æ³•ï¼Œå¹¶é…åˆç®€å•çš„demoï¼Œå¦‚æœä½ åªæ˜¯å¸Œæœ›æŸ¥é˜…è¯­æ³•æˆ–è€…äº†è§£ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œè¿™ç¯‡æ–‡ç« å¯èƒ½ä¼šå¸®åˆ°ä½ ã€‚</p>
<p>å£°æ˜ï¼šä½¿ç”¨äº†using namespace stdã€‚å¯¹äºåº”è¯¥åŒ…å«è¿›æ¥çš„å¤´æ–‡ä»¶ï¼Œä¸å†æ˜¾ç¤ºçš„å£°æ˜ã€‚æ–‡ä¸­æ‰€æœ‰demoå‡ç»è¿‡æµ‹è¯•ã€‚æœ¬æ–‡ç« åŸºäºã€ŠC++ Primer Plusã€‹å’Œã€ŠC++ Primeã€‹ã€‚</p>
<hr>
<h2 id="æ¨¡æ¿çš„åŸºæœ¬å£°æ˜å’Œå®šä¹‰"><a href="#æ¨¡æ¿çš„åŸºæœ¬å£°æ˜å’Œå®šä¹‰" class="headerlink" title="æ¨¡æ¿çš„åŸºæœ¬å£°æ˜å’Œå®šä¹‰"></a>æ¨¡æ¿çš„åŸºæœ¬å£°æ˜å’Œå®šä¹‰</h2><h3 id="æ¨¡æ¿çš„å£°æ˜"><a href="#æ¨¡æ¿çš„å£°æ˜" class="headerlink" title="æ¨¡æ¿çš„å£°æ˜"></a>æ¨¡æ¿çš„å£°æ˜</h3><pre><code>template &lt;typename T&gt;  int compare (T t1, T t2);
template &lt;typename T&gt; class compare;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="å®šä¹‰ä¸€ä¸ªæ¨¡æ¿å‡½æ•°"><a href="#å®šä¹‰ä¸€ä¸ªæ¨¡æ¿å‡½æ•°" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæ¨¡æ¿å‡½æ•°"></a>å®šä¹‰ä¸€ä¸ªæ¨¡æ¿å‡½æ•°</h3><pre><code class="cpp">template &lt;typename T&gt;
int compare(T &amp; t1, T &amp; t2)
&#123;
    if(t1 &gt; t2) 
        return 1;
    if(t1 == t2)
        return 0;
    if(t1 &lt; t2)
        return -1;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="å®šä¹‰ä¸€ä¸ªæ¨¡æ¿ç±»"><a href="#å®šä¹‰ä¸€ä¸ªæ¨¡æ¿ç±»" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæ¨¡æ¿ç±»"></a>å®šä¹‰ä¸€ä¸ªæ¨¡æ¿ç±»</h3><pre><code class="cpp">template &lt;typename T&gt;
class compare
&#123;
private:
    T _val;
public:
    explicit compare(T &amp; val) : _val(val) &#123; &#125;
    explicit compare(T &amp;&amp; val) : _val(val) &#123; &#125;
    bool operator==(T &amp; t)
    &#123;
        return _val == t;
    &#125;
&#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="æ¨¡æ¿å‚æ•°ä½œç”¨åŸŸ"><a href="#æ¨¡æ¿å‚æ•°ä½œç”¨åŸŸ" class="headerlink" title="æ¨¡æ¿å‚æ•°ä½œç”¨åŸŸ"></a>æ¨¡æ¿å‚æ•°ä½œç”¨åŸŸ</h3><p>å°±å¦‚åŒå…¶ä»–çš„å‡½æ•°å‚æ•°ä¸€æ ·ï¼Œæˆ–è€…æ˜¯å˜é‡ä¸€æ ·ï¼Œå°±æ˜¯æ™®é€šçš„ä½œç”¨åŸŸè§„åˆ™ã€‚</p>
<pre><code class="cpp">using T = int;
T a = 10;
template &lt;typename T&gt; class A;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> æ¨¡æ¿å£°æ˜é‡Œçš„Tä¸æ˜¯ä¸Šé¢çš„intè€Œæ˜¯æ¨¡æ¿å‚æ•°ã€‚</p>
<pre><code class="cpp">template &lt;typename T&gt; class A
&#123;
    U val; //error
    template&lt;typename U&gt; class B;
&#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="å…³äºæ¨¡æ¿å·¥ä½œåŸç†"><a href="#å…³äºæ¨¡æ¿å·¥ä½œåŸç†" class="headerlink" title="å…³äºæ¨¡æ¿å·¥ä½œåŸç†"></a>å…³äºæ¨¡æ¿å·¥ä½œåŸç†</h3><blockquote>
<p>æ¨¡æ¿å®šä¹‰å¹¶ä¸æ˜¯çœŸæ­£çš„å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°æˆ–è€…ç±»ï¼Œè€Œæ˜¯ç¼–è¯‘å™¨æ ¹æ®ç¨‹åºå‘˜ç¼©å†™çš„æ¨¡æ¿å’Œå½¢å‚æ¥è‡ªå·±å†™å‡ºä¸€ä¸ªå¯¹åº”ç‰ˆæœ¬çš„å®šä¹‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšæ¨¡æ¿å®ä¾‹åŒ–ã€‚ç¼–è¯‘å™¨æˆæˆçš„ç‰ˆæœ¬é€šå¸¸è¢«ç§°ä¸ºæ¨¡æ¿çš„å®ä¾‹ã€‚ç¼–è¯‘å™¨ä¸ºç¨‹åºå‘˜ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬çš„å…·ä½“è¿‡ç¨‹ã€‚ç±»ä¼¼å®æ›¿æ¢ã€‚</p>
<p>æ¨¡æ¿ç±»åœ¨æ²¡æœ‰è°ƒç”¨ä¹‹å‰æ˜¯ä¸ä¼šç”Ÿæˆä»£ç çš„ã€‚</p>
<p>ç”±äºç¼–è¯‘å™¨å¹¶ä¸ä¼šç›´æ¥ç¼–è¯‘æ¨¡æ¿æœ¬èº«ï¼Œæ‰€ä»¥æ¨¡æ¿çš„å®šä¹‰é€šå¸¸æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ã€‚</p>
</blockquote>
<h3 id="éç±»å‹æ¨¡æ¿å‚æ•°"><a href="#éç±»å‹æ¨¡æ¿å‚æ•°" class="headerlink" title="éç±»å‹æ¨¡æ¿å‚æ•°"></a>éç±»å‹æ¨¡æ¿å‚æ•°</h3><p>é¡¾åæ€ä¹‰ï¼Œæ¨¡æ¿å‚æ•°ä¸æ˜¯ä¸€ä¸ªç±»å‹è€Œæ˜¯ä¸€ä¸ªå…·ä½“çš„å€¼â€”â€”è¿™ä¸ªå€¼æ˜¯å¸¸é‡è¡¨è¾¾å¼ã€‚</p>
<p>å½“ä¸€ä¸ªæ¨¡æ¿è¢«å®ä¾‹åŒ–æ—¶ï¼Œï¼Œéç±»å‹å‚æ•°è¢«ä¸€ä¸ª<strong>ç”¨æˆ·æä¾›</strong>çš„æˆ–è€…<strong>ç¼–è¯‘å™¨æ¨æ–­</strong>å‡ºçš„å€¼æ‰€ä»£æ›¿ã€‚æ­£å› ä¸ºæ¨¡æ¿åœ¨ç¼–è¯‘é˜¶æ®µç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥å…¶å€¼åº”è¯¥èƒ½å¤Ÿç¼–è¯‘æ—¶ç¡®å®šï¼Œé‚£ä¹ˆä»–åº”è¯¥æ˜¯ä¸€ä¸ªå¸¸é‡æˆ–è€…å¸¸é‡è¡¨è¾¾å¼ã€‚</p>
<p>æœ‰ä¸€å¥è¯è¯´ï¼šC++çš„å¼ºå¤§åœ¨äºä»–çš„ç¼–è¯‘å™¨å¼ºå¤§ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­å°±æ˜¯å¾ˆå¥½çš„è¯´æ˜ã€‚</p>
<pre><code class="cpp">template &lt;size_t N, size_t M&gt;
int str_compare(const char (&amp;str1)[N], const char (&amp;str2)[M])
&#123;
    return strcmp(str1,str2);
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> ä½¿ç”¨æ–¹æ³•</p>
<pre><code class="cpp">str_compare(&quot;hello&quot;,&quot;nihao&quot;)
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿæˆ‘ä»¬ç”šè‡³æ²¡æœ‰ç”¨&lt;&gt;æ¥ä¼ é€’æ¨¡æ¿å‚æ•°ã€‚è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå·²ç»å¸®åŠ©æˆ‘ä»¬è®¡ç®—å¥½äº†åº”è¯¥å¼€è¾Ÿå¤šå¤§ç©ºé—´çš„æ•°ç»„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šé•¿åº¦ã€‚Nï¼ŒMåªæ˜¯éšå¼çš„ä¼ å…¥è¿›å»ã€‚</p>
<p>ç¼–è¯‘å™¨ä¹Ÿå¯ä»¥è‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬æ¨æ–­å‚æ•°æ—¶ä»€ä¹ˆç±»å‹ï¼Œä»è€Œä¸ç”¨æ˜¾ç¤ºçš„è°ƒç”¨æ¨¡æ¿å‡½æ•°ï¼Œå¯¹äºä¸Šé¢çš„compareå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è°ƒç”¨ï¼Œå‰ææ—¶ä¿è¯å‚æ•°ç±»å‹ç›¸åŒã€‚</p>
<pre><code class="cpp">compare(10,20);
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>éç±»å‹æ¨¡æ¿å‚æ•°çš„èŒƒå›´</p>
<p>æ•´å½¢ï¼ŒæŒ‡é’ˆæˆ–è€…å·¦å€¼å¼•ç”¨éƒ½æ˜¯ä¸€ä¸ªéç±»å‹æ¨¡æ¿å‚æ•°ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æƒ³åˆ°ï¼Œå¯¹äºæŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼Œåº”å½“ä¿è¯å®å‚å¿…é¡»å…·æœ‰é™æ€çš„ç”Ÿå­˜æœŸï¼Œä¿è¯å…¶ä¸ä¼šè¢«é‡Šæ”¾ã€‚</p>
<h3 id="inlineå’Œconstexp"><a href="#inlineå’Œconstexp" class="headerlink" title="inlineå’Œconstexp"></a>inlineå’Œconstexp</h3><p>æ”¾åœ¨æ¨¡æ¿ä¹‹åï¼Œå‡½æ•°ä¹‹å‰å³å¯</p>
<pre><code class="cpp">template &lt;typename T&gt;
inline int compare(T t1, T  t2);
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="åœ¨æ¨¡æ¿ç±»ä¸­ä½¿ç”¨æ¨¡æ¿ç±»"><a href="#åœ¨æ¨¡æ¿ç±»ä¸­ä½¿ç”¨æ¨¡æ¿ç±»" class="headerlink" title="åœ¨æ¨¡æ¿ç±»ä¸­ä½¿ç”¨æ¨¡æ¿ç±»"></a>åœ¨æ¨¡æ¿ç±»ä¸­ä½¿ç”¨æ¨¡æ¿ç±»</h3><p>è¿™ä¸ªåº”è¯¥å¾ˆå¥½ç†è§£ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰</p>
<pre><code class="cpp">template &lt;typename T&gt;
class A
&#123;
private:
    vector&lt;T&gt; vec;
&#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> ä¹Ÿå¯ä»¥è¿™æ ·å®šä¹‰</p>
<pre><code class="cpp">template &lt;typename T&gt;
class B
&#123;
private:
    vector&lt;int&gt; vec;
&#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="å‹å…ƒä¸æ¨¡æ¿ç±»"><a href="#å‹å…ƒä¸æ¨¡æ¿ç±»" class="headerlink" title="å‹å…ƒä¸æ¨¡æ¿ç±»"></a>å‹å…ƒä¸æ¨¡æ¿ç±»</h3><p>é€šè¿‡ä¸Šé¢ç¼–è¯‘å™¨ä¸ºæ¨¡æ¿ç”Ÿæˆå…·ä½“ä»£ç çš„åŸç†å¯ä»¥çœ‹å‡ºè¿™æ ·æœ‰ä»€ä¹ˆä¸åŒ</p>
<pre><code class="cpp">template &lt;typename N&gt;  
class C
  friend A&lt;N&gt;;
  friend B&lt;int&gt;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> ç”±äºå…·ä½“çš„åŸç†ç±»ä¼¼å®æ›¿æ¢ï¼Œæ¯ä¸ªå¯¹åº”çš„C<N>éƒ½æœ‰å‹å…ƒA<N>å’ŒB<int>ã€</p>
<p>å³æœ‰è¿™æ ·å‹å…ƒå…³ç³»C<int> A<int> B<int>, C<string> A<string> B<string>ä»¥æ­¤ç±»æ¨ã€‚</p>
<p>è¿˜æœ‰è¿™æ ·çš„æ¨¡æ¿å‹å…ƒâ€”â€”æ‰€æœ‰çš„å®ä¾‹åŒ–éƒ½æ˜¯å…¶å‹å…ƒ</p>
<pre><code class="cpp">template &lt;typename N&gt;
class C
    template &lt;typename T&gt; friend class D;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> ä½†æ˜¯æ²¡æœ‰è¿™æ ·çš„å†™æ³•</p>
<pre><code class="cpp">template &lt;typename T&gt; friend class D&lt;T&gt;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æˆ–è€…è¿™æ ·çš„å†™æ³•</p>
<pre><code class="cpp">template &lt;typename T&gt; friend D&lt;T&gt;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æ¨¡æ¿å…è®¸æ¨¡æ¿å‚æ•°ä¸ºè‡ªå·±çš„å‹å…ƒ</p>
<p>é¦–å…ˆè¯´æ˜ï¼Œæ¨¡æ¿å…è®¸å†…ç½®ç±»å‹ä¸ºè‡ªå·±çš„å‹å…ƒã€‚</p>
<pre><code class="cpp">friend int;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿™æ ·å†™æ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œä½†æ˜¯å®é™…ä¸Šæœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ</p>
<p>è¿˜æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™</p>
<pre><code class="cpp">template &lt;typename T&gt;
class People
&#123;
    friend T;
&#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿™æ ·å°±ä¿è¯äº†åœ¨ä¼ å…¥å†…ç½®ç±»å‹çš„æ—¶å€™ä¸ä¼šæœ‰é”™è¯¯ã€‚</p>
<h3 id="é»˜è®¤æ¨¡æ¿å®å‚"><a href="#é»˜è®¤æ¨¡æ¿å®å‚" class="headerlink" title="é»˜è®¤æ¨¡æ¿å®å‚"></a>é»˜è®¤æ¨¡æ¿å®å‚</h3><p>ç”¨æ³•å’Œå‡½æ•°çš„é»˜è®¤å‚æ•°åŸºæœ¬ç›¸åŒ</p>
<pre><code class="cpp">template &lt;typename T = int&gt; class A;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>é»˜è®¤çš„æƒ…å†µä¸‹Tå°±æ˜¯int</p>
<pre><code class="cpp">A&lt;&gt; a; // T is int
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="äºŒä¹‰æ€§çš„è§£å†³"><a href="#äºŒä¹‰æ€§çš„è§£å†³" class="headerlink" title=": : äºŒä¹‰æ€§çš„è§£å†³"></a>: : äºŒä¹‰æ€§çš„è§£å†³</h3><p>å¯¹äºæ™®é€šç±»çš„:: ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å®ƒç©¶ç«Ÿæ˜¯ä¸€ä¸ªç±»è¿˜æ˜¯ä¸€ä¸ªé™æ€æˆå‘˜ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚</p>
<pre><code class="cpp">string::size_type a;
string::npos;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å¯¹äºæ¨¡æ¿ç±»æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜æ˜¯çŸ¥é“è¡¨è¾¾çš„æ˜¯ä»€ä¹ˆï¼Œä½†æ˜¯å·²ç»è¯´è¿‡äº†ï¼Œæ¨¡æ¿ç±»åœ¨æ²¡æœ‰ è°ƒç”¨ä¹‹å‰ä¸ä¼šç”Ÿæˆä»£ç ï¼Œè¿™å¯åäº†ã€‚å¯¹äºT::memï¼Œç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯é™æ€æˆå‘˜ï¼Ÿè¿˜æ˜¯ä¸€ä¸ªç±»å‹çš„typedefï¼Ÿ</p>
<p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨typenameä¿®é¥°ã€‚</p>
<p>å½“æˆ‘ä»¬å¸Œæœ›é€šçŸ¥ç¼–è¯‘å™¨ä¸€ä¸ªåå­—è¡¨ç¤ºä¸€ä¸ªç±»å‹æ—¶ï¼Œä½¿ç”¨ä¸”å¿…é¡»ä½¿ç”¨å…³é”®å­—typenameï¼Œæ¥è¡¨ç¤ºå…¶æ˜¯ä¸€ä¸ªç±»å‹ã€‚</p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºè¿™æ ·çš„ä»£ç ã€‚</p>
<pre><code class="cpp">template &lt;typename T&gt;
typename T::val_typefunc ();
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¡¨çš„ä¸æ˜¯ä¸€ä¸ªé™æ€æ•°æ®æˆå‘˜è€Œæ˜¯ä¸€ä¸ªç±»å‹ã€‚</p>
<p>æˆ–è€…è¿™æ ·çš„ä»£ç </p>
<pre><code class="cpp">typedef typename T::mem s_type;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¡¨ç¤ºs_typeæ˜¯ä¸€ä¸ªç±»å‹çš„åˆ«åè€Œä¸æ˜¯æ•°æ®æˆå‘˜çš„åˆ«åã€‚</p>
<p>å¦‚æœè½¬åˆ°string::size_typeçš„å®šä¹‰ï¼Œå¯ä»¥çœ‹è§ä»–æ˜¯ä¸€ä¸ªtypename çš„ typedefã€‚</p>
<h3 id="ç±»æ¨¡æ¿æˆå‘˜å‡½æ•°"><a href="#ç±»æ¨¡æ¿æˆå‘˜å‡½æ•°" class="headerlink" title="ç±»æ¨¡æ¿æˆå‘˜å‡½æ•°"></a>ç±»æ¨¡æ¿æˆå‘˜å‡½æ•°</h3><p>æœ¬è´¨ä¸Šå°±æ˜¯ä¸ªå‡½æ•°ï¼Œåªè¦æŒæ¡äº†æ¨¡æ¿çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬æˆ‘ä»¬å°±å¯ä»¥è½»æ¾çš„å†™å‡ºç±»æ¨¡æ¿æˆå‘˜å‡½æ•°ã€‚</p>
<pre><code class="cpp">class Math
&#123;
public:
    template &lt;typename N&gt; inline static  N sqrt(N);
&#125;;

template&lt;typename N&gt;
N Math::sqrt(N val)
&#123;
    return val * val;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>é¦–å…ˆæ¥ä¸€ç‚¹ä¸€ç‚¹è§£æ</p>
<p>è¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œè¿”å›å€¼ä¸ºNç±»å‹ï¼Œæ‰€ä»¥ï¼Œæ¨¡æ¿è¯­æ³•å†™åœ¨å‰é¢ï¼Œè®©ç¼–è¯‘å™¨çŸ¥é“åº”è¯¥è¿”å›ç±»å‹ï¼Œç´§æ¥ç€å°±æ˜¯è¿”å›ç±»å‹ï¼Œè¿”å›ç±»å‹åŒä¸Šéƒ½æ˜¯å†™åœ¨æ¯”è¾ƒé å‰çš„ä½ç½®ã€‚æ¥ç€å°±æ˜¯å‡½æ•°çš„æ ‡ç­¾ã€‚</p>
<p>å¯¹äºå®šä¹‰æ¥è¯´ï¼Œåº”è¯¥çŸ¥é“æ˜¯å“ªä¸ªç±»ä¸‹çš„å‡½æ•°ï¼Œæ‰€ä»¥å’Œæ™®é€šçš„æ–¹æ³•ä¸€æ ·åŠ ä¸Šä¸€ä¸ªä½œç”¨åŸŸå³å¯ã€‚</p>
<p>å‡å¦‚æŠŠç±»å†™æˆè¿™æ ·å‘¢ï¼Ÿ</p>
<pre><code class="cpp">template &lt;typename N&gt;
class Math
&#123;
public:
    inline static  N sqrt(N);
&#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>é‚£æ–¹æ³•çš„å®šä¹‰åº”è¯¥æ˜¯å†™æˆè¿™æ ·çš„ã€‚</p>
<pre><code class="cpp">template&lt;typename N&gt;
N Math&lt;N&gt;::sqrt(N val) 
&#123;
    return val * val;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿™é‡Œå°±å¯ä»¥çœ‹å‡º</p>
<blockquote>
<p>å‰é¢è¯´åˆ°çš„ï¼Œæ¨¡æ¿ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œè€Œæ˜¯æ ¹æ®è¿™ä¸ªæ¨¡æ¿ç¼–è¯‘å™¨ç”Ÿæˆå¯¹åº”çš„ç‰ˆæœ¬ã€‚</p>
<p>å¯¹äºæ¯ä¸€ä¸ªç‰ˆæœ¬ï¼Œéƒ½æ˜¯ä¸åŒçš„ç±»ã€‚å°±åƒé‡è½½å‡½æ•°ä¸€æ ·ï¼Œå³ä¾¿å‚æ•°ä¸ªæ•°å’Œå‡½æ•°çš„å…·ä½“ç®—æ³•å®Œå…¨ä¸€æ ·ï¼Œä½†ç±»å‹ä¸åŒä»–ä»¬ä¹Ÿæ˜¯ä¸åŒçš„å‡½æ•°ï¼Œåªä¸è¿‡å‡½æ•°åç›¸åŒè€Œå·²ã€‚</p>
<p>é‚£ä¹ˆå°±åº”è¯¥å¯ä»¥å¾—åˆ°æ¯ä¸ªç‰ˆæœ¬çš„ç±»éƒ½å¯¹åº”çš„ä¸€ä¸ªç›¸åº”ç‰ˆæœ¬çš„é™æ€æˆå‘˜ã€‚æ‰€ä»¥Math<N>::è¿™æ ·å†™ä¹Ÿå°±å¾ˆå¥½ç†è§£äº†ã€‚</p>
</blockquote>
<h3 id="ç±»æ¨¡æ¿çš„æˆå‘˜æ¨¡æ¿"><a href="#ç±»æ¨¡æ¿çš„æˆå‘˜æ¨¡æ¿" class="headerlink" title="ç±»æ¨¡æ¿çš„æˆå‘˜æ¨¡æ¿"></a>ç±»æ¨¡æ¿çš„æˆå‘˜æ¨¡æ¿</h3><p>æˆ‘å·²ç»ä¸çŸ¥é“ç”¨ä»€ä¹ˆè¯­è¨€æ¥ä¸‹é¢çš„ä»£ç äº†ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“äº†ä¸€äº›äº‹æƒ…ã€‚</p>
<p>æ— è®ºæ˜¯å®šä¹‰è¿˜æ˜¯å£°æ˜ï¼Œæ¨¡æ¿è¯­æ³•çš„ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ï¼Œä¸åŒæ¨¡æ¿çš„ä¼˜å…ˆçº§åˆæ ¹æ®å…¶å£°æ˜é¡ºåºæ¥åˆ¤æ–­ï¼Œå…¶æ¬¡æ˜¯å‡½æ•°ä¿®é¥°ï¼Œç„¶åæ˜¯è¿”å›å€¼ã€‚æ ¹æ®è¿™ä¸ªåŸåˆ™æˆ‘ä»¬å¯ä»¥è½»æ¾çš„è§£æè¿™ä¸ªå‡½æ•°ã€‚ </p>
<pre><code class="cpp">template &lt;typename T&gt; class A
&#123;
public:
    template &lt;typename It&gt;  A&lt;T&gt; sum(It _begin, It _end);
&#125;;

template &lt;typename T&gt;        //æœ€å¤–å±‚æ¨¡æ¿
template &lt;typename It&gt;       //å†…å±‚æ¨¡æ¿
A&lt;T&gt;                         //è¿”å›å€¼
A&lt;T&gt;::sum(It _begin, It _end)//å‡½æ•°æ ‡ç­¾ 
&#123;&#125;                           //ç®—æ³•å®ç°

//ä¸å¦¨å†™çš„æ›´ç¾è§‚ä¸€ç‚¹
template &lt;typename T&gt;
  template &lt;typename It&gt;
  A&lt;T&gt; A&lt;T&gt;::sum(It _begin, It _end)&#123;
      
  &#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æ³¨æ„ï¼šä¸Šé¢çš„ä»£ç å’Œä¸‹é¢çš„ä»£ç å†™çš„è¶³å¤Ÿå¤æ‚ï¼Œä¸‹é¢çš„ä»£ç å¯¹å…¶è¿›è¡Œä¸€äº›å°å°çš„ä¿®æ”¹ã€‚ </p>
<p>å…·ä½“çš„ç”¨æ³•ï¼Œè™½ç„¶ä¸‹é¢çš„ä¾‹å­çœ‹èµ·æ¥æœ‰äº›é€ ä½œï¼Œä½†æ˜¯è¿˜æ˜¯èƒ½è¯´æ˜ä¸€äº›é—®é¢˜çš„</p>
<pre><code class="cpp">#include &lt;iostream&gt;
#include &lt;cstring&gt;
#include &lt;vector&gt;
using namespace std;
template &lt;typename T&gt; class A
&#123;
private:
    vector&lt;T&gt; vec;
public:
    template &lt;typename It&gt;  T sum(It _begin, It _end);
    A(initializer_list&lt;T&gt; initlist)    
    &#123;
        for(auto it = initlist.begin();it != initlist.end();++it)
        &#123;
            vec.push_back(*it);
        &#125;
    &#125;
    typename vector&lt;T&gt;::iterator begin()
    &#123;
        return vec.begin();
    &#125;
    typename vector&lt;T&gt;::iterator end()
    &#123;
        return vec.end();
    &#125;
&#125;;

template &lt;typename T&gt;
  template &lt;typename It&gt;
  T A&lt;T&gt;::sum(It _begin, It _end)
  &#123;
    T tot ;
    memset(&amp;tot,0,sizeof (T));
    while(_begin != _end)
    &#123;
        tot += *_begin++;
    &#125;
    return tot;
  &#125;


int main()
&#123;
    A&lt;int&gt; a &#123;1,2,3,4&#125;;
    cout &lt;&lt; a.sum(a.begin(),a.end());
    return 0;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> è™½ç„¶è¿™æ ·çš„è¯­æ³•å¾ˆæ˜¯ä»¤äººå¤´ç–¼ï¼Œä½†æ˜¯å¤šç”¨å³å¯ç†Ÿç»ƒï¼Œæˆ–è€…è¯´ä½¿ç”¨ç±»å‹åˆ«åæ¥é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œå¹¶ä¸”æœ€å¥½ä¸è¦æŠŠå­¦ä¹ ç²¾åŠ›æ”¾åœ¨è¯­æ³•ä¸Šâ€”â€”åœ¨æ²¡æœ‰ç†Ÿæ‚‰è¯­æ³•ä¹‹å‰ã€‚</p>
<h3 id="å®ä¾‹åŒ–ä¼˜åŒ–"><a href="#å®ä¾‹åŒ–ä¼˜åŒ–" class="headerlink" title="å®ä¾‹åŒ–ä¼˜åŒ–"></a>å®ä¾‹åŒ–ä¼˜åŒ–</h3><p>å½“æ¨¡æ¿è¢«è°ƒç”¨æ—¶æ‰ä¼šè¢«ç¼–è¯‘ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨è¿™æ ·ä¸€ç§æƒ…å†µâ€”â€”<strong>ç›¸åŒåœ°å®ä¾‹åŒ–å¯èƒ½å‡ºç°åœ¨å¤šä¸ªæ–‡ä»¶å¯¹è±¡ä¸­</strong>ã€‚å½“ä¸¤ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹ç¼–è¯‘åœ°æºæ–‡ä»¶é€‚ç”¨äº†ç›¸åŒåœ°æ¨¡æ¿ï¼Œå¹¶æä¾›äº†ç›¸åŒåœ°æ¨¡æ¿å‚æ•°æ—¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­å°±éƒ½ä¼šæœ‰è¯¥æ¨¡æ¿çš„ä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶æ˜¾ç¤ºå®ä¾‹åŒ–ã€‚å…·ä½“çš„åšæ³•å¦‚ä¸‹</p>
<p>ç”¨å…³é”®å­—externæ˜¾ç¤ºçš„å®ä¾‹åŒ–å£°æ˜</p>
<pre><code class="cpp">extern template class A&lt;string&gt;;                   //å£°æ˜
template int compare(const int &amp;, const int &amp;);    //å®šä¹‰
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>å°†ä¸€ä¸ªå®ä¾‹åŒ–å£°æ˜ä¸ºexternå°±è¡¨ç¤ºæ‰¿è¯ºåœ¨ç¨‹åºçš„å…¶ä»–ä½ç½®æœ‰è¯¥å®ä¾‹åŒ–çš„ä¸€ä¸ªéexternå£°æ˜ï¼ˆå®šä¹‰ï¼‰ã€‚</p>
<p>ç”±äºç¼–è¯‘å™¨åœ¨ä½¿ç”¨ä¸€ä¸ªæ¨¡æ¿æ—¶è‡ªåŠ¨å¯¹å…¶å®ä¾‹åŒ–ï¼Œå› æ­¤externå£°æ˜å¿…é¡»å‡ºç°åœ¨ä»»ä½•ç”¨æ­¤å®ä¾‹åŒ–ç‰ˆæœ¬çš„ä»£ç ä¹‹å‰ã€‚ </p>
</blockquote>
<p>è§£é‡Šçš„æ¥è¯´ï¼šå› ä¸ºæ–‡ä»¶å…¶ä»–å¤„å·²å°†æœ‰ä¸€ä¸ªå®ä¾‹åŒ–â€”â€”ç¼–è¯‘å™¨ç”Ÿæˆå¥½çš„æˆ–è€…æ˜¯è‡ªå·±å®šä¹‰çš„ï¼Œç”±äºç¼–è¯‘å•å…ƒä¸º.cppæ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®ä¾‹å·çš„ä»£ç å¹¶ä¸èƒ½ç”¨äºå¦ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™å°±æ˜¾ç€å¾ˆæã€‚è€Œexternæ­£æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚ </p>
<h2 id="ç±»å‹è½¬æ¢å’Œå‚æ•°æ¨æ–­"><a href="#ç±»å‹è½¬æ¢å’Œå‚æ•°æ¨æ–­" class="headerlink" title="ç±»å‹è½¬æ¢å’Œå‚æ•°æ¨æ–­"></a>ç±»å‹è½¬æ¢å’Œå‚æ•°æ¨æ–­</h2><p>ä¸éæ™®é€šåœ°ç±»å‹è½¬æ¢ä¸€æ ·ï¼Œæ¨¡æ¿ç±»åœ¨ä¼ é€’æ¨¡æ¿å‚æ•°çš„æ—¶å€™ä¹Ÿä¼šè¿›è¡Œç›¸åº”çš„è½¬æ¢ï¼Œåªä¸è¿‡è¿™ç§è½¬æ¢å¢æ·»äº†æ›´å¤šçš„è§„åˆ™ï¼Œå‚æ•°æ¨æ–­å’Œç±»å‹è½¬æ¢çš„å…³ç³»æ˜¯éå¸¸ç´§å¯†çš„ã€‚</p>
<p>ç±»å‹è½¬æ¢è¿™é‡Œçš„é—®é¢˜å¦‚æœæƒ³è¦æ¸…æ¥šçš„äº†è§£ï¼Œé‚£ææ€•æ˜¯éå¸¸å¯æ€•çš„ï¼Œæˆ‘æœ‰æ—¶å€™åœ¨æƒ³ï¼Œé€šè¿‡è¿™ä¹ˆå¤šçš„è½¬æ¢è§„åˆ™ ï¼Œæˆ‘ä»¬å°±å¯è§ä¸€æ–‘çš„çœ‹å‡ºC++çš„è®¾è®¡æ˜¯å¤šä¹ˆçš„å·§å¦™ã€‚è™½ç„¶è¿™çš„çŸ¥è¯†ç‚¹å¾ˆä¹±ï¼Œä½†å…¶å®åªè¦æŠ“ä½éšè—åœ¨è¿™èƒŒåçš„è§‚å¿µå°±èƒ½æ¸…æ™°çš„å¯¹ä»˜å„ç§è½¬æ¢äº†ã€‚</p>
<p>å…¶ä¸­ä¸€ä¸ªè§„åˆ™æ˜¯ï¼šå¦‚æœèƒ½å¤Ÿè¿›è¡Œå®‰å…¨è½¬æ¢ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥éšå¼è½¬æ¢</p>
<p>æœ€ç»å…¸çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯non-const åˆ°constçš„è½¬æ¢ã€‚</p>
<p>ä¸ºäº†å±•ç¤ºçš„æ–¹ä¾¿ï¼Œä¼šå¿½ç•¥æ‰ä¸€äº›ä»£ç </p>
<pre><code class="cpp">template&lt;typename T&gt;
bool func(const T t1, const T t2)
&#123;
    return less&lt;T&gt;()(t1,t2);
&#125;

...

    int a = 10;
    const int b = 20;
    func&lt;int&gt;(a,b);
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿™é‡Œçš„intè½¬ä¸ºconst intæ˜¯å…è®¸çš„ï¼Œå› ä¸ºè¿™æ˜¯æŒ‰å€¼ä¼ é€’ï¼Œå¹¶ä¸”non-const è½¬ä¸º constä¹Ÿä¸ä¼šå¸¦æ¥ä»€ä¹ˆåå¤„ã€‚å› æ­¤ï¼Œç¼–è¯‘å™¨ä¼šæ‰§è¡Œè¿™æ ·çš„è½¬æ¢ã€‚</p>
<p>æˆ‘ä»¬ä¸å¦¨ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°</p>
<pre><code class="cpp">bool func(const T &amp; t1, const T &amp; t2);
bool func(T &amp; t1, T &amp; t2);
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä¸Šè¿°ç¬¬ä¸€ä¸ªå£°æ˜ä¼šæ­£å¸¸è°ƒç”¨â€”â€”è™½ç„¶æ˜¯å¼•ç”¨ï¼Œå’Œä¸Šé¢çš„æ˜¯åŒæ ·çš„é“ç†ã€‚</p>
<p>è€Œç¬¬äºŒä¸ªå´ä¸ä¼šæ­£å¸¸è°ƒç”¨â€”â€”å› ä¸ºbæ˜¯ä¸€ä¸ªconst å°†è¦è½¬æ¢ä¸ºnon-constï¼Œæˆ‘ä¸­è½¬æ¢æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥ç¼–è¯‘ä¸å…è®¸è¿™æ ·çš„è½¬æ¢ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬è¿™æ ·è°ƒç”¨ä¸¤ä¸ªå‡½æ•°</p>
<pre><code class="cpp">func&lt;int&gt;(10,20);
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>åŒæ ·çš„ï¼Œå¯¹äºç¬¬ä¸€ä¸ªæ˜¯å…è®¸çš„â€”â€”è™½ç„¶å°†å³å€¼ç»‘å®šåˆ°å·¦å€¼å¼•ç”¨ä¸Šï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨constä¿®é¥°å½¢å‚ï¼Œä¿è¯å…¶ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨åŒæ„è¿™æ ·çš„è½¬æ¢ã€‚</p>
<p>è€Œå¯¹äºç¬¬äºŒä¸ªï¼Œç¼–è¯‘å™¨åˆ™ä¸å…è®¸è¿™æ ·çš„è½¬æ¢ï¼Œå› ä¸ºæˆ‘ä»¬çš„å½¢å‚æ˜¯non-constçš„ï¼Œä¸èƒ½ä¿è¯ä¸ä¿®æ”¹å½¢å‚çš„å€¼ï¼Œå½¢å‚æ­£å¥½åˆæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œè¿™æ ·å¯ä»¥ä¿®æ”¹å®å‚çš„å€¼â€”â€”æ°å¥½å®å‚æ˜¯ä¸€ä¸ªå³å€¼â€”â€”æ˜¯ä¸å…è®¸è¢«ä¿®æ”¹çš„ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¸å…è®¸è¿™æ ·çš„è½¬æ¢ã€‚</p>
<p>åŸºäºä¸Šé¢çš„è½¬æ¢è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¦‚æœå‡½æ•°å½¢å‚ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ™å¯ä»¥å¯¹æ•°ç»„æˆ–è€…å‡½æ•°ç±»å‹çš„å®å‚åº”ç”¨æ­£å¸¸çš„æŒ‡é’ˆè½¬æ¢ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹ä»£ç </p>
<pre><code class="cpp">template &lt;typename T&gt; bool func(const T &amp; t1, const T &amp; t2);
...
int a[10];
int b[10];
func(a,b);
</code></pre>
<p>å…¶å®æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢çš„è®¨è®ºï¼Œéƒ½é€‚ç”¨äºæ™®é€šå‡½æ•°ï¼Œæ¨¡æ¿çš„æœ¬è´¨å…¶å®ä¹Ÿæ˜¯æ¨¡æ¿ä¸ºæˆ‘ä»¬ç”Ÿæˆå¯¹åº”çš„ç‰ˆæœ¬ï¼Œä¸ºäº†è§£å¼€ä¸Šé¢çš„ç–‘æƒ‘ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¥å¤ä¹ ä»¥ä¸‹å¼•ç”¨çš„çŸ¥è¯†ã€‚</p>
<pre><code class="cpp">    int *&amp; ref_apple_point = &amp;apple; //error
    int * const &amp; ref_apple_point_const = &amp;apple; //ok
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æ ¹æ®è¿™ä¸¤è¡Œä»£ç æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€äº›å¯ç¤ºã€‚</p>
<p>å› ä¸ºæ•°ç»„åæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œconst T &amp; t1è¿™æ ·çš„å½¢å‚æ˜¯å¯ä»¥æ¥å—çš„ã€‚ä½†å¯¹äºè¿”å›å€¼æ¥è¯´ï¼Œå¯å°±éº»çƒ¦äº†ã€‚è¿”å›å€¼ä¸ºå†…ç½®æ•°æ®ç±»å‹çš„æ¨¡æ¿å‡½æ•°ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ã€‚è¿”å›ç±»å‹ä¸ºTçš„æ¨¡æ¿å‡½æ•°ï¼Œä»–è¿”å›çš„æ˜¯ä¸€ä¸ªä»€ä¹ˆå…·ä½“ç±»å‹å‘¢ï¼Ÿé¦–å…ˆTè¢«uæ¨æ–­ä¸º* constï¼Œé‚£ä¹ˆè¿”å›ç±»å‹ä¹Ÿåº”è¯¥æ˜¯ *const</p>
<p> åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆç•™ä¸‹ä¸€ä¸ªæ‚¬å¿µï¼Œå½“æˆ‘ä»¬ç†è§£å’Œç¼–è¯‘å™¨æ˜¯å¦‚ä½•æ¨æ–­Tæ˜¯ä½•ç§ç±»å‹çš„æ—¶å€™ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½å°±ä¼šè¿åˆƒè€Œè§£ã€‚</p>
<h3 id="è¿”å›å€¼ç±»å‹æ¨æ–­"><a href="#è¿”å›å€¼ç±»å‹æ¨æ–­" class="headerlink" title="è¿”å›å€¼ç±»å‹æ¨æ–­"></a>è¿”å›å€¼ç±»å‹æ¨æ–­</h3><p>åœ¨ç¼–è¯‘å™¨é‡è§å‡½æ•°åˆ—è¡¨ä¹‹å‰ï¼Œæ‰€æœ‰çš„å½¢å‚éƒ½æ˜¯ä¸å­˜åœ¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™æ ·çš„å°¾ç½®è¿”å›ç±»å‹ã€‚</p>
<pre><code class="cpp">auto func(It &amp; _beg, It &amp; _end) -&gt; decltype(*_beg)
&#123;
    //...
    auto sum = *_beg;
    sum = 0;
    for_each(_beg,_end,[&amp;sum](const int &amp; val)&#123; sum+= val;&#125;);
    //...
    return sum;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿™æ ·çš„ä»£ç è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜çš„ï¼Œå¦‚æœæˆ‘ä»¬è¦è¿”å›ä¸€ä¸ªæ‹·è´è€Œä¸æ˜¯å¼•ç”¨å‘¢ï¼Ÿè¦ç”¨åˆ°ä¸€ä¸ªç±»å‹è½¬æ¢æ¨¡æ¿å·¥å…·ã€‚</p>
<p>remove_reference&lt;&gt;    ç§»é™¤å¼•ç”¨â€”â€”å…³äºå…¶ä»–çš„ç±»å‹è½¬æ¢ï¼Œä¸å†æœ¬æ–‡ç« è®¨è®ºèŒƒå›´å†…è¯»è€…å¯è‡ªè¡ŒæŸ¥é˜…ã€‚</p>
<p>è¿™ä¸ªæ¨¡æ¿ç±»æœ‰ä¸€ä¸ªåä¸ºtypeçš„publicæˆå‘˜ï¼Œèƒ½å¤Ÿè·å¾—ç›¸åº”çš„ç±»å‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™</p>
<pre><code class="cpp">template &lt;typename It&gt;
auto func(It &amp; _beg, It &amp; _end) -&gt; typename remove_reference&lt;decltype(*_beg)&gt;::type //don&#39;t forget typename
&#123;
    //...
    auto sum = *_beg;
    sum = 0;
    for_each(_beg,_end,[&amp;sum](const int &amp; val)&#123; sum+= val;&#125;);
    //...
    return sum;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥æŒ‡å®šè¿”å›uç±»å‹ï¼Œä¾‹å¦‚</p>
<pre><code class="cpp">template&lt;typename T1, typename T2, typename T3&gt;
T1 sum(T2 t2, T3 t3)
&#123;
    return t2 + t3;
&#125;

sum&lt;long long&gt;(10,200); //or sum&lt;long long, int, int&gt;();
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æ˜¾ç¤ºæ¨¡æ¿å‚æ•°æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºä¸€æ¬¡åŒ¹é…ã€‚</p>
<h3 id="å…¼å®¹ç±»å‹çš„æ¨¡æ¿é—®é¢˜"><a href="#å…¼å®¹ç±»å‹çš„æ¨¡æ¿é—®é¢˜" class="headerlink" title="å…¼å®¹ç±»å‹çš„æ¨¡æ¿é—®é¢˜"></a>å…¼å®¹ç±»å‹çš„æ¨¡æ¿é—®é¢˜</h3><p>æœ‰è¿™æ ·çš„ä»£ç </p>
<pre><code class="cpp">template&lt;typename T&gt;
T sum(T t1, T t2)
&#123;
    return t1 + t2;
&#125;

sum(10,3.14);
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è™½ç„¶intå’Œdoubleå…¼å®¹ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œç¼–è¯‘å™¨å‚»äº†ï¼ŒTä¸ºintï¼Ÿç²¾åº¦ä¼šä¸¢å¤±ï¼Œè‚¯å®šæ˜¯ä¸å¯è¡Œçš„ï¼ŒTä¸ºdouble?è²Œä¼¼ä¹Ÿä¸è¡Œï¼Œè¿™æ ·ä¼šå¯¼è‡´æ•°æ®æº¢å‡ºã€‚æ— å¥ˆæˆ‘ä»¬åªå¥½è¿™æ ·äº†ã€‚</p>
<pre><code class="cpp">template&lt;typename T1ï¼Œ typename T2&gt;
??? sum(T1 t1, T2 t2)
&#123;
    return t1 + t2;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è‡³äºè¿”å›ç±»å‹ï¼Œå…¨äº¤ç»™ç¨‹åºå‘˜æ¥è§„å®šï¼Œæˆ–è€…ç”¨å°¾éƒ¨è¿”å›ç±»å‹ã€‚</p>
<h3 id="å‡½æ•°æŒ‡é’ˆå®å‚æ¨æ–­"><a href="#å‡½æ•°æŒ‡é’ˆå®å‚æ¨æ–­" class="headerlink" title="å‡½æ•°æŒ‡é’ˆå®å‚æ¨æ–­"></a>å‡½æ•°æŒ‡é’ˆå®å‚æ¨æ–­</h3><p>æœ‰è¶£çš„æ˜¯ï¼Œè™½ç„¶åœ¨æœªå®ä¾‹åŒ–ä¹‹å‰ï¼Œç¼–è¯‘å™¨æ²¡æœ‰ç”Ÿæˆå…·ä½“çš„ä»£ç ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥è¿›è¡Œå‡½æ•°æŒ‡é’ˆç»‘å®šçš„æ“ä½œã€‚</p>
<pre><code class="cpp">template &lt;typename T&gt; int compare(const T &amp; t1, const T &amp; t2) &#123; &#125;

int (*pf_int)(const int &amp;,const int &amp;) = compare;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>åŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ¨¡æ¿å‡½æ•°ä½œä¸ºå›è°ƒå‡½æ•°è¿›è¡Œä¼ å‚ï¼Œä½†æ­¤æ—¶å¯èƒ½ä¼šäº§ç”ŸäºŒä¹‰æ€§ï¼Œæ‰€ä»¥æ³¨æ„æ˜¾ç¤ºçš„å†™å‡ºæ¨¡æ¿å‚æ•°ã€‚</p>
<blockquote>
<p>å½“å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿å®ä¾‹çš„åœ°å€æ—¶ï¼Œç¨‹åºä¸Šä¸‹æ–‡å¿…é¡»æ»¡è¶³ï¼šå¯¹äºæ¯ä¸ªæ¨¡æ¿å‚æ•°ï¼Œèƒ½å”¯ä¸€ç¡®å®šå…¶ç±»å‹çš„å€¼ã€‚</p>
</blockquote>
<h2 id="æ¨¡æ¿å®å‚æ¨æ–­"><a href="#æ¨¡æ¿å®å‚æ¨æ–­" class="headerlink" title="æ¨¡æ¿å®å‚æ¨æ–­"></a>æ¨¡æ¿å®å‚æ¨æ–­</h2><p>è¿™é‡Œæ˜¯é‡ä¸­ä¹‹é‡ï¼ï¼ï¼é‡ä¸­ä¹‹é‡ï¼ï¼ï¼</p>
<p>å¾ˆå¤šçš„æ¨¡æ¿é—®é¢˜éƒ½ä¸æ­¤æœ‰å…³ã€‚</p>
<p>å…³äºconstå’Œ&amp;çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸Šé¢å·²ç»è®²è¿‡äº†ã€‚è¿™é‡Œå†è¿›è¡Œè¿›ä¸€æ­¥çš„è¯´æ˜ã€‚</p>
<h3 id="å·¦å€¼å¼•ç”¨"><a href="#å·¦å€¼å¼•ç”¨" class="headerlink" title="å·¦å€¼å¼•ç”¨"></a>å·¦å€¼å¼•ç”¨</h3><pre><code class="cpp">template &lt;typename T&gt; void func1(T &amp;) &#123; &#125;
template &lt;typename T&gt; void func2(const T &amp;) &#123; &#125;
void aa()
&#123;
    int a = 10;
    const int b = 20;
    func1(a);   //T is int 
    func1(b);      //T is const int
    func2(a);      //T is int
    func2(b);      //T is int
    func2(10);     //T is int 
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿˜æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼Œçœ‹func2(b)çš„è°ƒç”¨ï¼Œè™½ç„¶æˆ‘ä»¬å°†const intç±»å‹ä¼ å…¥è¿›å»ï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬æ¨å¯¼çš„è¿˜æ˜¯intï¼ŒåŸå› åº”è¯¥å’Œå‚æ•°ç±»å‹æœ‰å…³ï¼Œå¦‚æœç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬æ¨å¯¼çš„æ˜¯const int ï¼Œé‚£ä¹ˆconst const intæ˜¯ä¸åˆæ³•çš„ï¼Œæ‰€ä»¥åªå¥½ä¸ºæˆ‘ä»¬æ¨å€’ä¸ºintï¼Œå³ä½¿æˆ‘ä»¬è°ƒç”¨æ—¶å€™çš„ç±»å‹æ˜¯const intã€‚</p>
<h3 id="å³å€¼å¼•ç”¨"><a href="#å³å€¼å¼•ç”¨" class="headerlink" title="å³å€¼å¼•ç”¨"></a>å³å€¼å¼•ç”¨</h3><pre><code class="cpp">template &lt;typename T&gt; void func(T &amp;&amp;);
func(10);         //T is int
func(b);          //b is a left_val T is ???
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®å¼•ç”¨æŠ˜å å¯ä»¥æ¨æ–­å‡ºç±»å‹ã€‚</p>
<h3 id="å¼•ç”¨æŠ˜å å’Œä¸‡èƒ½å¼•ç”¨"><a href="#å¼•ç”¨æŠ˜å å’Œä¸‡èƒ½å¼•ç”¨" class="headerlink" title="å¼•ç”¨æŠ˜å å’Œä¸‡èƒ½å¼•ç”¨"></a><strong>å¼•ç”¨æŠ˜å å’Œä¸‡èƒ½å¼•ç”¨</strong></h3><p>ä¼—æ‰€å‘¨çŸ¥åœ¨éæ¨¡æ¿å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨const &amp; æ¥æ¥å—ä»»æ„ç±»å‹å‚æ•°ï¼Œåœ¨æ¨¡æ¿ä¸­ï¼Œä¹Ÿæœ‰ç±»ä¼¼è¿™æ ·çš„ä¸‡èƒ½å¼•ç”¨ï¼Œå°±æ˜¯&amp;&amp;ã€‚çŸ¥é“äº†è¿™æ ·çš„åŸå› æ˜¯æœ‰ç€å¼•ç”¨æŠ˜å å¾—çš„å­˜åœ¨ã€‚</p>
<p>å…ˆè¯´ç»“è®ºï¼šåœ¨ä¼ é€’å‚æ•°çš„è¿‡ç¨‹ä¸­ï¼Œæ— è®ºå¤šä¹ˆå¤æ‚çš„å¼•ç”¨ä¼ å‚ï¼Œæœ€åéƒ½ä¼šè¢«æŠ˜å ä¸º&amp; æˆ–è€… &amp;&amp;.</p>
<blockquote>
<p>å¦‚æœæˆ‘ä»¬é—´æ¥åˆ›å»ºäº†ä¸€ä¸ªå¼•ç”¨çš„å¼•ç”¨ï¼Œåˆ™è¿™äº›å¼•ç”¨å½¢æˆæŠ˜å ã€‚é™¤äº†å³å€¼å¼•ç”¨çš„å³å€¼å¼•ç”¨ä¼šè¢«æŠ˜å ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œå‰©ä¸‹å…¨éƒ¨æŠ˜å ä¸ºä¸€ä¸ªå·¦å€¼å¼•ç”¨ã€‚å³</p>
<p>T&amp; &amp;, T&amp; &amp;&amp;ï¼Œ T&amp;&amp; &amp;éƒ½ä¼šæŠ˜å ä¸ºT&amp;</p>
<p>T&amp;&amp; &amp;&amp;ä¼šè¢«æŠ˜å ä¸º&amp;&amp;</p>
</blockquote>
<p>è¿™å°±æ„å‘³ç€æˆ‘ä»¬ å¯ä»¥è§£é‡Šä¸Šé¢çš„é—®é¢˜ã€‚</p>
<p>å½“æˆ‘ä»¬å°†ä¸€ä¸ªå·¦å€¼ä¼ é€’ç»™ä¸€ä¸ªå³å€¼å¼•æ—¶å€™ï¼Œç¼–è¯‘å™¨æ¨æ–­Tçš„ç±»å‹ä¸º&amp;ã€‚æ³¨æ„æ˜¯Tçš„ç±»å‹ä¸ºå·¦å€¼å¼•ç”¨ï¼Œä¸æ˜¯æ•´ä¸ªå½¢å‚æ˜¯T &amp;ã€‚</p>
<p>æ‰€ä»¥</p>
<pre><code class="cpp">func(b);          //b is a left_val T is int&amp;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä¸Šè¿°çš„ä¸¤ä¸ªè§„åˆ™å¯¼è‡´äº†</p>
<blockquote>
<p>å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯ä¸€ä¸ªæŒ‡å‘æ¨¡æ¿ç±»å‹å‚æ•°çš„å³å€¼å¼•ç”¨ï¼Œåˆ™ä»–å¯ä»¥è¢«ç»‘å®šåˆ°ä¸€ä¸ªå·¦å€¼ã€‚</p>
<p>å¦‚æœå®å‚æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œåˆ™æ¨æ–­å‡ºçš„æ¨¡æ¿å®å‚ç±»å‹å°†æ˜¯ä¸€ä¸ªå·¦å€¼å¼•ç”¨ï¼Œä¸”å‡½æ•°å°†è¢«å‚æ•°å°†è¢«å®ä¾‹åŒ–ä¸ºä¸€ä¸ªæ™®é€šå·¦å€¼å¼•ç”¨å‚æ•°ã€‚</p>
</blockquote>
<p> è¿™ä¸¤ä¸ªè§„åˆ™åˆæš—ç¤ºäº†æˆ‘ä»¬â€”â€”æˆ‘ä»¬å¯ä»¥å°†ä»»æ„ç±»å‹çš„å®å‚ä¼ é€’ç»™å‚æ•°ä¸ºå³å€¼å¼•ç”¨çš„å‡½æ•°ã€‚</p>
<p>å½“ä»£ç ä¸­æ¶‰åŠçš„ç±»å‹å¯èƒ½æ˜¯éå¼•ç”¨ç±»å‹ï¼Œä¹Ÿå¯èƒ½æ˜¯å¼•ç”¨ç±»å‹çš„æ—¶å€™ï¼Œç¼–å†™æ­£ç¡®çš„ä»£ç å°±å˜å¾—å¼‚å¸¸å›°éš¾ï¼ˆè™½ç„¶remove_referenceè¿™æ ·çš„è½¬æ¢ç±»å‹å¯¹æˆ‘ä»¬å¯èƒ½æœ‰æ‰€å¸®åŠ©ï¼‰ã€‚</p>
<blockquote>
<p>PSï¼šç”±äºè¿™é‡Œçš„çŸ¥è¯†æ˜¯åœ¨æ˜¯å¾ˆä¹±ï¼Œç¬”è€…åœ¨å†™è¿™é‡Œçš„æ—¶å€™ä¹Ÿå®åœ¨æ— èƒ½ä¸ºåŠ›ï¼Œæ‰€ä»¥å¤§é‡äº†å¼•ç”¨C++ Primerçš„åŸæ–‡ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹å¯ä»¥ä¿è¯â€”â€”ç¬”è€…åœ¨è¿™é‡Œå†™çš„demoè™½ç„¶æ²¡æœ‰ä»€ä¹ˆå®é™…æ„ä¹‰ä»…ç”¨äºæ¼”ç¤ºâ€”â€”ä½†æ˜¯ä¹Ÿèƒ½è¯´æ˜ä¸€äº›é—®é¢˜ã€‚</p>
<p>å¦‚æœè¯»è€…å¯¹æ¨¡æ¿çš„ç»†èŠ‚æƒ³ä»¥æ¢ç©¶ç»ï¼Œå¯ä»¥ç¿»è¶ŠC++ Primerâ€”â€”ä¸­æ–‡ç¬¬äº”ç‰ˆP508-P610ã€‚</p>
<p>å¦‚æœæƒ³å·©å›ºè¿™é‡Œçš„è¯­æ³•ï¼Œå¯ä»¥ä½œç›¸åº”çš„é…å¥—ä¹ é¢˜ã€‚</p>
</blockquote>
<h2 id="std-move"><a href="#std-move" class="headerlink" title="std::move"></a>std::move</h2><p>æŠ˜ç£¨çš„ç¯‡ç« ç»ˆäºè¿‡å»äº†ï¼Œè®©æˆ‘ä»¬ç”¨å¥½å¥‡å¿ƒæ¥çœ‹ä¸€çœ‹std::moveè¿™ä¸ªå·¥å…·ã€‚</p>
<h3 id="çŸ­å°ç²¾æ‚çš„std-moveå®šä¹‰"><a href="#çŸ­å°ç²¾æ‚çš„std-moveå®šä¹‰" class="headerlink" title="çŸ­å°ç²¾æ‚çš„std::moveå®šä¹‰"></a>çŸ­å°ç²¾æ‚çš„std::moveå®šä¹‰</h3><p>å¦‚ä¸‹</p>
<pre><code class="cpp">template &lt;typename T&gt;
typename remove_reference&lt;T&gt;::type &amp;&amp; move(T &amp;&amp; t)
&#123;
    return static_cast&lt;typename remove_reference&lt;T&gt;::type&amp;&amp;&gt;(t); 
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="std-moveçš„è§£æ"><a href="#std-moveçš„è§£æ" class="headerlink" title="std::moveçš„è§£æ"></a>std::moveçš„è§£æ</h3><p>å› ä¸ºmoveå¯ä»¥æ¥å—ä»»æ„å¯¹è±¡ï¼Œæ‰€ä»¥åº”å½“æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬è¦ä¿è¯è¿”å›ä¸€ä¸ªå³å€¼ï¼Œé‚£æˆ‘ä»¬åº”å½“æ˜ç¡®çš„å¾—åˆ°ä¸€ä¸ªéå·¦å³å€¼å¼•ç”¨ç±»å‹â€”â€”å³æ™®é€šç±»å‹ã€‚</p>
<p>é‚£ä¹ˆå°±å¯ä»¥å…ˆç§»é™¤å¼•ç”¨å†åŠ ä¸Šå³å€¼å¼•ç”¨â€”â€”è¿™æ ·ä¿è¯äº†è¿”å›ä¸€ä¸ªå³å€¼å¼•ç”¨å¯¹åº”äº†</p>
<pre><code class="cpp">typename remove_reference&lt;T&gt;::type &amp;&amp;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æ—¢ç„¶æ¥å—ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ç¾å¯ä»¥ç”¨&amp;&amp;æ¥æ¥å—å®å‚ï¼Œå¯¹åº”</p>
<pre><code class="cpp">move(T &amp;&amp; t)
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>æˆ‘ä»¬åªéœ€è¦è¿”å›ä¸€ä¸ªå³å€¼å³å¯ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªreturnè¯­å¥ã€‚</p>
<p>æˆ‘ä»¬å›æƒ³ä»¥ä¸‹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨std::moveâ€”â€”è·å¾—ä¸€ä¸ªå³å€¼è¿›è¡Œç§»åŠ¨æ„é€ ï¼Ÿåˆæˆ–è€…æ˜¯ä»…ä»…éœ€è¦ä¸€ä¸ªå³å€¼ï¼Ÿä¸ç®¡å‡ºäºä»€ä¹ˆåŸå› ï¼Œæœ€ç»ˆçš„ç›®çš„å°±æ˜¯ä¸ºäº†ä¼˜åŒ–ç¨‹åºï¼Œæ‰€ä»¥é€šè¿‡å½¢å‚åˆ›å»ºä¸€ä¸ªé¢å¤–çš„å³å€¼å¹¶è¿”å›è¿™æ ·æ˜¯ä¸å¯å–çš„ï¼Œæ˜¯è„±è£¤å­æ”¾å±ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨è¿™æ¡è¯­å¥</p>
<pre><code class="cpp">static_cast&lt;typename remove_reference&lt;T&gt;::type&amp;&amp;&gt;(t);
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œstaticâ€”â€”castç”¨äºåˆæ³•çš„ç±»å‹è½¬æ¢ï¼Œä½†æ˜¯åˆä¸€ç§æƒ…å†µä¾‹å¤–ï¼Œè™½ç„¶ä¸€ä¸ªå·¦å€¼ä¸èƒ½éšå¼è½¬æ¢ä¸ºå³å€¼ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨static_catå°†å…¶æ˜¾ç¤ºçš„è½¬æ¢ä¸ºå³å€¼â€”â€”å‰ææˆ‘ä»¬å…ˆç§»é™¤å¯¹è±¡èº«ä¸Šçš„å¼•ç”¨æ•ˆæœã€‚</p>
<p>æ¨¡æ¿å’Œé‡è½½</p>
<p>æ¨¡æ¿ä¹Ÿæ˜¯å¯ä»¥è¢«é‡è½½çš„ï¼Œåªè¦æ²¡æœ‰äºŒä¹‰æ€§ã€‚åƒåœ¨C++åº“ä¸­ï¼Œå­˜åœ¨ç€å¤§é‡çš„æ¨¡æ¿é‡è½½æŠ€æœ¯ï¼Œæˆ–è€…æ˜¯å¯å˜æ¨¡æ¿å‚æ•°ä¸­ï¼Œä¹Ÿå­˜åœ¨ç€æ¨¡æ¿çš„é‡è½½ã€‚</p>
<p>å¯¹äºå®ä¾‹åŒ–çš„é€‰æ‹©ï¼Œéµå¾ªä»¥ä¸‹çš„è§„åˆ™ã€‚</p>
<blockquote>
<p>1.å¯¹äºä¸€ä¸ªè°ƒç”¨ï¼Œå…¶å€™é€‰å‡½æ•°æ˜¯æ‰€æœ‰å¯è¡Œçš„å®ä¾‹åŒ–</p>
<p>2.å¯è¡Œå‡½æ•°æŒ‰ç±»å‹è½¬æ¢æ¥æ’åºã€‚å½“ç„¶ï¼Œå¯ç”¨äºå‡½æ•°æ¨¡æ¿è°ƒç”¨å’Œçš„ç±»å‹è½¬æ¢æ˜¯éå¸¸æœ‰é™çš„ã€‚</p>
<p>3.å’Œæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œå¦‚æœæ°åˆä¸€ä¸ªå‡½æ•°æ¯”ä»»ä½•å…¶ä»–å‡½æ•°éƒ½æ›´å¥½çš„åŒ¹é…ï¼Œåˆ™é€‰æ‹©æ­¤å‡½æ•°ã€‚</p>
<p>4.å¦‚æœå¤šä¸ªå‡½æ•°æä¾›äº†åŒæ ·å¥½çš„åŒ¹é…</p>
<p>â€‹    1ï¼‰ä¼˜å…ˆé€‰æ‹©éæ¨¡æ¿å‡½æ•°</p>
<p>â€‹    2ï¼‰æ²¡æœ‰éæ¨¡æ¿å‡½æ•°æˆ‘é€‰æ‹©æ›´åŠ ç‰¹ä¾‹åŒ–çš„æ¨¡æ¿</p>
<p>â€‹    3ï¼‰å¦åˆ™æœ‰äºŒæ„æ€§</p>
<p>æ­£ç¡®çš„å®šä¹‰ä¸€ç»„é‡è½½çš„å‡½æ•°æ¨¡æ¿éœ€è¦å¯¹ç±»å‹é”®çš„å…³ç³»ä»¥åŠæ¨¡æ¿å¹»æœ¯å…è®¸çš„ä¼˜å…ˆçš„å®å‚ç±»å‹è½¬æ¢æœ‰ç€æ·±åˆ»çš„ç†è§£ã€‚</p>
<p>æ³¨æ„ï¼šè™½ç„¶éæ¨¡æ¿å‡½æ•°çš„ä¼˜å…ˆçº§å¾ˆé«˜â€”â€”ä½†é‚£ä¹Ÿæ˜¯æ²¡æœ‰å¯¹åº”æ¨¡æ¿åŒ¹é…çš„æƒ…å†µä¸‹ï¼Œæ‰€ä»¥ï¼Œåœ¨é‡è½½æ¨¡æ¿çš„æ—¶å€™ä»”ç»†è§‚å¯Ÿå’Œæ€è€ƒã€‚</p>
</blockquote>
<p>æ‰€ä»¥æˆ‘ä»¬ä¸ºäº†é€‚é…å­—ç¬¦ä¸²çš„æ¯”è¾ƒï¼Œå¯ä»¥å†™å‡ºè¿™æ ·çš„ä»£ç </p>
<pre><code class="cpp">template&lt;size_t N, size_t M&gt;
int compare(const char str1[N], const char str2[M])
&#123;
    return strcmp(str1,str2);
&#125;
//æˆ–è€…
int compare(const char * const str1, const char * const str2)
&#123;
    return strcmp(str1,str2);
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> æ ¹æ®ä¸Šé¢çš„åŒ¹é…è§„åˆ™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€’å½’çš„è°ƒç”¨æ¨¡æ¿ç±»è‡ªå·±å®ç°æŸäº›åŠŸèƒ½</p>
<pre><code class="cpp">template&lt;typename T&gt; string debug_rep(const T &amp; t)
&#123;
    ostringstream ret;
    ret &lt;&lt; t ;
    return ret.str();
&#125;

template&lt;typename T&gt; string debug_rep(const T * p)
&#123;
    ostringstream ret;
    ret &lt;&lt; &quot;pointer :&quot; &lt;&lt; p;
    if(p != nullptr)
        ret &lt;&lt; &quot; &quot; &lt;&lt; debug_rep(*p);
    else
        ret &lt;&lt; &quot; nullptr&quot;;
    return ret.str();
&#125;

//é€‚é…Cé£æ ¼å­—ç¬¦ä¸²
string debug_reo(char * p)
&#123;
    return debug_rep(string(p));    //è¿™æ˜¯ä¸€ä¸ªå³å€¼ï¼Œä¸èƒ½è·å–å…¶åœ°å€
&#125;

string debug_rep(const char * p)
&#123;
    return debug_rep(string(p));
&#125;

int main()
&#123;
    string s(&quot;hello&quot;);
    string* ps = &amp;s;
    cout &lt;&lt; debug_rep(ps) &lt;&lt; endl &lt;&lt; debug_rep(s);
    return 0;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://img-blog.csdnimg.cn/d552c7ad9be5484282089868bd42fd4c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAX19KQU5fXw==,size_16,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p>
<h3 id="æ¨¡æ¿å‡½æ•°åŒ¹é…çš„ç‰¹æ®Šæ€§"><a href="#æ¨¡æ¿å‡½æ•°åŒ¹é…çš„ç‰¹æ®Šæ€§" class="headerlink" title="æ¨¡æ¿å‡½æ•°åŒ¹é…çš„ç‰¹æ®Šæ€§"></a>æ¨¡æ¿å‡½æ•°åŒ¹é…çš„ç‰¹æ®Šæ€§</h3><p>éš¾é“æ²¡æœ‰å‘ç°ä¸€ä¸ªå¼‚å¸¸çš„åœ°æ–¹å—ï¼Ÿå¯¹äºæŒ‡é’ˆç‰ˆæœ¬çš„è°ƒç”¨ï¼Œå¯ä»¥è¿™æ ·å®ä¾‹åŒ–ä¸¤ä¸ªå‡½æ•°</p>
<pre><code class="cpp">string debug_rep(const string* &amp; t);
string debug_rep(string * p);
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> å¯¹äºæ™®é€šå‡½æ•°ï¼Œè¿™æ˜¯æ— ç–‘çš„äºŒä¹‰æ€§ï¼Œä½†æ˜¯æ¨¡æ¿ä¼šé€‰æ‹©ç‰¹ä¾‹åŒ–é«˜çš„ï¼ŒåŸå› æ˜¯const T&amp;å¯ä»¥å®ä¾‹åŒ–ä»»ä½•ç±»å‹ï¼Œè€Œconst T * påªèƒ½å®ä¾‹åŒ–æŒ‡é’ˆç±»å‹â€”â€”ç‰¹ä¾‹åŒ–ç¨‹åº¦æ›´é«˜ã€‚æ‰€ä»¥ä¼šè°ƒç”¨åè€…ã€‚</p>
<p>è¿™å°±è¯´æ˜äº†ï¼šä¸è¦å°†æ™®é€šå‡½æ•°çš„åŒ¹é…æœºåˆ¶åº”ç”¨äºæ¨¡æ¿å‡½æ•°åŒ¹é…æœºåˆ¶â€”â€”è™½ç„¶ä¸¤è€…å¾ˆåƒï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰æŸäº›åœ°æ–¹æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<h3 id="æ³¨æ„é‡è½½æ¨¡æ¿å£°æ˜é¡ºåº"><a href="#æ³¨æ„é‡è½½æ¨¡æ¿å£°æ˜é¡ºåº" class="headerlink" title="æ³¨æ„é‡è½½æ¨¡æ¿å£°æ˜é¡ºåº"></a>æ³¨æ„é‡è½½æ¨¡æ¿å£°æ˜é¡ºåº</h3><p>ç”±äºæ¨¡æ¿çš„ç‰¹æ€§ï¼Œä½¿å¾—å…¶å¯ä»¥é€’å½’çš„è°ƒç”¨è‡ªå·±çš„ä¸åŒç‰ˆæœ¬ï¼Œä½†æ˜¯æ³¨æ„è¦è°ƒç”¨çš„ç‰ˆæœ¬ä¸€å®šè¦äº‹å…ˆå£°æ˜æˆ–è€…å®šä¹‰ï¼Œå¦åˆ™å¯èƒ½å‡ºç°å‡½æ•°ä¸åŒ¹é…çš„æƒ…å†µ</p>
<p>æˆ‘ä»¬æŠŠé€‚é…char * æ¥å£çš„å­—ç¬¦ä¸²çš„å‡½æ•°æ”¾åˆ°æœ€å‰é¢ï¼Œæˆ‘ä»¬å‘ç°ç¼–è¯‘å™¨ä¼šå³å€¼æ²³é˜³çš„é”™è¯¯ã€‚</p>
<blockquote>
<p>No matching function for call to â€˜debug_repâ€™</p>
<p>è°ƒç”¨â€œdebug_repâ€æ²¡æœ‰åŒ¹é…çš„å‡½æ•° </p>
</blockquote>
<p>æˆ–è€…æˆ‘ä»¬å°†ä¸¤ä¸ªdebug_repçš„æ¨¡æ¿ç‰ˆæœ¬è°ƒæ¢ä»¥ä¸‹é¡ºåºã€‚ </p>
<blockquote>
<p>Call to function â€˜debug_repâ€™ that is neither visible in the template definition nor found by argument-dependent lookup</p>
<p>è°ƒç”¨å‡½æ•°â€œdebug_repâ€ï¼Œè¯¥å‡½æ•°åœ¨æ¨¡æ¿å®šä¹‰ä¸­æ—¢ä¸å¯è§ï¼Œä¹Ÿä¸é€šè¿‡å‚æ•°ç›¸å…³æŸ¥æ‰¾æ‰¾åˆ°</p>
</blockquote>
<h2 id="æ¨¡æ¿ç‰¹ä¾‹åŒ–"><a href="#æ¨¡æ¿ç‰¹ä¾‹åŒ–" class="headerlink" title="æ¨¡æ¿ç‰¹ä¾‹åŒ–"></a>æ¨¡æ¿ç‰¹ä¾‹åŒ–</h2><p>æˆ‘ä»¬ç¼–å†™çš„æ¨¡æ¿ï¼Œä¸å¯èƒ½ä¿è¯å¯¹äºæ‰€æœ‰çš„ç±»å‹éƒ½èƒ½é€‚ç”¨â€”â€”compareå‡½æ•°å°±æ˜¯å¾ˆç»å…¸çš„ä¾‹å­ï¼Œå¯¹äºä¸¤ä¸ªæŒ‡é’ˆç±»å‹ï¼Œä»…ä»…æ˜¯æ¯«æ— æ„ä¹‰çš„æ¯”è¾ƒã€‚è¿™æ—¶å€™æˆ‘ä»¬ç”¨åˆ°æ¨¡æ¿ç‰¹ä¾‹åŒ–çš„æŠ€æœ¯å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</p>
<p>ç”±äºlessçš„åº•å±‚æ˜¯ä½¿ç”¨&lt;æ¥æ¯”è¾ƒçš„ï¼Œæ‰€ä»¥lesså¹¶æ²¡æœ‰é€‚é…å­—ç¬¦æŒ‡é’ˆã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™è¿™æ ·çš„æ¨¡æ¿ç‰¹ä¾‹åŒ–ã€‚</p>
<pre><code class="cpp">template &lt;&gt;        //è¡¨ç¤ºä¸€ä¸ªæ¨¡æ¿ç‰¹ä¾‹åŒ–â€”â€”è¯­æ³•è§„å®š
int compare(const char * const &amp; str1, const char * const &amp; str2) //å…·ä½“çš„ç±»å‹
&#123;
    return strcmp(str1,str2);
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ¨¡æ¿ç‰¹ä¾‹åŒ–çš„å°–æ‹¬å·ä¸­æ²¡æœ‰ä»»ä½•è¯´æ˜ï¼Œæ‰€ä»¥æ¨¡æ¿ç‰¹ä¾‹åŒ–è¦å¯¹æ‰€æœ‰æ¨¡æ¿é‚£å‚æ•°éƒ½è¿›è¡Œç‰¹ä¾‹åŒ–ã€‚ </p>
<p>æ³¨æ„ï¼Œä¸Šé¢çš„ç‰¹ä¾‹åŒ–åªèƒ½å¤„ç†å­—ç¬¦æŒ‡é’ˆï¼Œä¸èƒ½å¤„ç†æ•°ç»„æˆ–è€…å­—ç¬¦ä¸²é¢é‡â€”â€”è¿™å’Œå‡½æ•°åŒ¹é…æœºåˆ¶æœ‰å…³ã€‚è¿™ä¸ªç‰¹ä¾‹åŒ–ä»…ä»…æ¥å—char*ä»¥åŠå…¶constç‰ˆæœ¬ï¼Œè™½ç„¶å­—ç¬¦æ•°ç»„çš„åå­—å°±æ˜¯ä»–çš„åœ°å€ï¼Œä½†æ˜¯åœ¨æ¨¡æ¿ä¸­ä¼šè¢«è§£é‡Šä¸ºä¸€ä¸ªå­—ç¬¦æ•°ç»„çš„å¼•ç”¨ï¼Œæ›´åŠ çš„ç²¾å‡†åŒ¹é…ã€‚å¦‚æœæƒ³è¦æ”¯æŒå­—ç¬¦é¢é‡ï¼ˆæœ¬è´¨ä¸Šæ˜¯å­—ç¬¦æ•°ç»„ï¼‰å’Œå­—ç¬¦æ•°ç»„ï¼Œè¯·å†™ä¸€ä¸ªé‡è½½çš„æ¨¡æ¿å‡½æ•°â€”â€”è§æ¨¡æ¿é‡è½½ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è°ƒè¯•è§‚å¯Ÿæ˜¯å¦‚ä½•æ¨æ–­å®å‚ç±»å‹çš„</p>
<p><img src="https://img-blog.csdnimg.cn/cac84050194042999a46dff60b811f6e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAX19KQU5fXw==,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p>
<p>æ¨æ–­ä¸ºä¸€ä¸ªæ•°ç»„çš„å¼•ç”¨â€”â€”è¿™æ˜¾ç„¶æ¯”å°†æ•°ç»„è½¬æ¢ä¸ºæŒ‡é’ˆå†è¿›è¡ŒåŒ¹é…æ›´åŠ ç²¾ç¡®ã€‚</p>
<h3 id="ç‰¹ä¾‹åŒ–å’Œé‡è½½-çš„åŒºåˆ«"><a href="#ç‰¹ä¾‹åŒ–å’Œé‡è½½-çš„åŒºåˆ«" class="headerlink" title="ç‰¹ä¾‹åŒ–å’Œé‡è½½ çš„åŒºåˆ«"></a>ç‰¹ä¾‹åŒ–å’Œé‡è½½ çš„åŒºåˆ«</h3><p>ç‰¹ä¾‹åŒ–å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å®ä¾‹åŒ–â€”â€”æ¨¡æ¿çš„å®ä¾‹åŒ–ï¼Œæ‰€ä»¥ï¼Œç‰¹ä¾‹åŒ–ä»…ä»…æ˜¯æ¨¡æ¿çš„ä¸€ä¸ªå®ä¾‹åŒ–ï¼Œä¸ä¼šå½±å“å‡½æ•°åŒ¹é…ã€‚ </p>
<p>å¹¶ä¸”ï¼Œæ¨¡æ¿ç‰¹ä¾‹åŒ–ä¸€å®šè¦ä¿è¯æ¨¡æ¿çš„ä¹‹å‰çš„å£°æ˜æˆ–è€…å®šä¹‰ã€‚å¦‚æœä¸è¿™æ ·åšâ€”â€”ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€äº›ä»¤äººåŒªå¤·æ‰€æ€çš„åœ°æ–¹ã€‚æ¨¡æ¿ä¼šç”±ç¼–è¯‘å™¨å®ä¾‹åŒ–ï¼Œè€Œä¸æ˜¯è°ƒç”¨è‡ªå·±ç‰¹ä¾‹åŒ–ç‰ˆæœ¬â€”â€”è¿™ç§é”™è¯¯å¾€å¾€å¾ˆéš¾æŸ¥æ‰¾ã€‚æ‰€ä»¥ï¼Œè®°ä½ä¸€ä¸ªè§„åˆ™ï¼šç‰¹ä¾‹åŒ–ä¸€ä¸ªæ¨¡æ¿ï¼Œä¸€å®šè¦ä¿è¯å…¶åœ¨åŸæ¨¡æ¿çš„å®šä¹‰åŸŸä¸­ã€‚</p>
<h3 id="ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–"><a href="#ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–" class="headerlink" title="ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–"></a>ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–</h3><p> è¿™é‡Œå¼•ç”¨ã€ŠC++ Primerã€‹çš„ä¾‹å­â€”â€”å¯¹å…¶åšä¸€äº›è§£æã€‚</p>
<p>hashå®¹å™¨æ˜¯èƒ½å¤Ÿè¿›è¡Œååˆ†å¿«é€Ÿçš„æŸ¥æ‰¾å®¹å™¨ï¼Œåƒhash_map, hash_setç­‰ã€‚ä»–ä»¬çš„åº•å±‚ä½¿ç”¨ä»€ä¹ˆæ¥æ˜ å°„å“ˆå¸Œå€¼å‘¢? hashæ¨¡æ¿ç±»ã€‚<a target="_blank" rel="noopener" href="http://www.cplusplus.com/reference/functional/hash/?kw=hash">hash - C++ Reference (cplusplus.com)</a></p>
<p>é‚£ä¹ˆå¯¹äºæˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»å‹æ¥è¯´ï¼Œæ²¡æœ‰å…¶å¯¹åº”ç®—æ³•ï¼Œä¸ºäº†èƒ½å¤Ÿä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå…¶ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ã€‚</p>
<p> ä¸€ä¸ªhashçš„ç‰¹ä¾‹åŒ–å¿…é¡»åŒ…æ‹¬</p>
<blockquote>
<p>ä¸€ä¸ªé‡è½½çš„è°ƒç”¨è¿ç®—ç¬¦ï¼Œæ¥å—ä¸€ä¸ªå®¹å™¨å…³é”®å­—ç±»å‹çš„å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªsize_tâ€”â€”ç”¨äºæ˜ å°„å¯¹è±¡çš„å“ˆå¸Œå€¼ã€‚</p>
<p>ä¸¤ä¸ªç±»å‹æˆå‘˜ï¼Œresult_type, argument_typeï¼Œåˆ†åˆ«è°ƒç”¨è¿ç®—ç¬¦è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹ã€‚</p>
<p>é»˜è®¤æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€‚</p>
</blockquote>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹çš„ä»£ç ã€‚</p>
<pre><code class="cpp">class Book
&#123;
    friend class std::hash&lt;Book&gt;;    //hashä½¿ç”¨äº†ç§æœ‰æˆå‘˜ï¼Œæ‰€ä»¥å°†å…¶å£°æ˜ä¸ºå‹å…ƒ
private:
    int book_id;
    string book_name;
public:
    Book() = default;
    Book(const int a, const string &amp; _name) : book_id(a), book_name(_name) &#123; &#125;
    bool operator==(const Book &amp; b) const
    &#123;
        return book_id == b.book_id;
    &#125;
&#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªBookç±»ï¼Œç„¶åæä¾›å…¶&#x3D;&#x3D;è¿ç®—ç¬¦ç¡®ä¿hashæ¨¡æ¿èƒ½å¤Ÿè‡ªæŒæˆ‘ä»¬çš„è‡ªå®šä¹‰ç±»å‹ã€‚</p>
<p>éšåæˆ‘ä»¬åœ¨stdå‘½åç©ºé—´ä¸­ç‰¹ä¾‹åŒ–ä¸€ä¸ªå’Œhashï¼Œ</p>
<pre><code class="cpp">namespace std
&#123;
    template &lt;&gt;
    struct hash&lt;Book&gt;
    &#123;
        //å¿…é¡»æä¾›çš„æˆå‘˜
        typedef size_t result_type;
        typedef Book argument_type;
        size_t operator()(const Book &amp; b) const;
    &#125;;
    size_t
    hash&lt;Book&gt;::operator()(const Book &amp;b) const &#123;
        //è‡ªå®šä¹‰å¦‚ä½•ç»„ç»‡hash_val
        return hash&lt;string&gt;()(b.book_name) ^ hash&lt;int&gt;()(b.book_id);
    &#125;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨unordered_set&#x2F;mapï¼Œæ¥æ“çºµæˆ‘ä»¬çš„è‡ªå®šä¹‰ç±»å‹äº†ã€‚ </p>
<p>ä¸ºäº†èƒ½å¤Ÿè®©è‡ªå®šä¹‰æ•°æ®ç±»å‹çš„ç‰¹ä¾‹åŒ–èƒ½å¤Ÿè¢«æ­£å¸¸ä½¿ç”¨ï¼Œåº”è¯¥å°†å…¶æ”¾åœ¨ç±»å£°æ˜å¯¹åº”çš„å¤´æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ç”¨åˆ«çš„å¤´æ–‡ä»¶å°†å…¶åŒ…å«è¿›æ¥ã€‚</p>
<h3 id="éƒ¨åˆ†æ¨¡æ¿ç‰¹ä¾‹åŒ–"><a href="#éƒ¨åˆ†æ¨¡æ¿ç‰¹ä¾‹åŒ–" class="headerlink" title="éƒ¨åˆ†æ¨¡æ¿ç‰¹ä¾‹åŒ–"></a>éƒ¨åˆ†æ¨¡æ¿ç‰¹ä¾‹åŒ–</h3><p>æˆ‘ä»¬å¯ä»¥æŒ‡å®š<strong>ä¸€éƒ¨åˆ†è€Œéæ‰€æœ‰çš„æ¨¡æ¿å‚æ•°ï¼Œæˆ–è€…æ˜¯å‚æ•°çš„ä¸€éƒ¨åˆ†è€Œéå…¨éƒ¨ç‰¹æ€§</strong>ã€‚ä¸€ä¸ªæ¨¡æ¿çš„éƒ¨åˆ†ç‰¹ä¾‹åŒ–æœ¬èº«æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œä½¿ç”¨å®ƒæ—¶ç”¨æˆ·è¿˜å¿…é¡»ä¸ºå“ªäº›åœ¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬å‘¢ä¸­æœªæŒ‡å®šçš„æ¨¡æ¿å‚æ•°æä¾›å®å‚ã€‚</p>
<p>éƒ¨åˆ†ç‰¹ä¾‹åŒ–ä¸€éƒ¨åˆ†æ¨¡æ¿å‚æ•°ç‰¹ä¾‹åŒ–ï¼Œæ²¡æœ‰ç‰¹ä¾‹åŒ–çš„éƒ¨åˆ†é¢å¤–çš„æä¾›å®å‚ã€‚</p>
<p>æ ‡å‡†åº“çš„remove_reference å°±æ˜¯ä½¿ç”¨ä¸€ç³»åˆ—çš„ç‰¹ä¾‹åŒ–å®Œæˆå…¶åŠŸèƒ½çš„ï¼Œæˆ‘ä»¬å°†å…¶è½¬åˆ°å®šä¹‰ã€‚</p>
<p>è¿™é‡Œéƒ¨åˆ†ç‰¹ä¾‹åŒ–çš„æ—¶å‚æ•°çš„å¼•ç”¨æ€§è´¨ã€‚</p>
<pre><code class="cpp">  template&lt;typename _Tp&gt;
    struct remove_reference
    &#123; typedef _Tp   type; &#125;;

  template&lt;typename _Tp&gt;
    struct remove_reference&lt;_Tp&amp;&gt;
    &#123; typedef _Tp   type; &#125;;

  template&lt;typename _Tp&gt;
    struct remove_reference&lt;_Tp&amp;&amp;&gt;
    &#123; typedef _Tp   type; &#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> å…·ä½“çš„è¯­æ³•ï¼š</p>
<p>åœ¨æ­£å¸¸çš„æ¨¡æ¿å£°æ˜ä¹‹åï¼Œåœ¨ç±»çš„åé¢ä½¿ç”¨å°–æ‹¬å·&lt;&gt;æ”¾å…¥è¦ç‰¹ä¾‹åŒ–çš„å®å‚ï¼Œè¿™äº›å®å‚äºåŸå§‹æ¨¡æ¿ä¸­çš„å‚æ•°æŒ‰ç…§ä½ç½®å¯¹åº”ã€‚ä¹Ÿå°±æ˜¯å¯¹åº”ç€ä¸Šé¢æºç ä¸­çš„</p>
<pre><code class="cpp">struct remove_reference&lt;_Tp&amp;&amp;&gt;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<blockquote>
<p>æ³¨æ„ï¼šæ¨¡æ¿éƒ¨åˆ†ç‰¹ä¾‹åŒ–å¹¶ä¸æ˜¯å¯¹äºæŸä¸ªå•å•çš„æ¨¡æ¿å‚æ•°ç‰¹ä¾‹åŒ–ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¨¡æ¿å‚æ•°å±æ€§çš„ç‰¹ä¾‹åŒ–ï¼Œè¿™ç‚¹å¯¹äºç†è§£ç±»æ¨¡æ¿éƒ¨åˆ†ç‰¹ä¾‹åŒ–ååˆ†é‡è¦</p>
<p>æ³¨æ„ï¼šæˆ‘ä»¬åªèƒ½éƒ¨åˆ†ç‰¹ä¾‹åŒ–ç±»æ¨¡æ¿ï¼Œè€Œä¸èƒ½éƒ¨åˆ†ç‰¹ä¾‹åŒ–æ¨¡æ¿å‡½æ•°ã€‚ </p>
</blockquote>
<p>ä¾‹å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ³›ç”¨çš„æ¨¡æ¿ç±»å’Œå®ä¾‹åŒ–ä¸€ä¸ªå…¶ä¸“é—¨ç”¨æ¥å¤„ç†æŒ‡é’ˆçš„ç±»</p>
<pre><code class="cpp">template &lt;typename T&gt;
class A;

template &lt;typename T&gt;
class A&lt;T *&gt;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="ç‰¹ä¾‹åŒ–æˆå‘˜"><a href="#ç‰¹ä¾‹åŒ–æˆå‘˜" class="headerlink" title="ç‰¹ä¾‹åŒ–æˆå‘˜"></a>ç‰¹ä¾‹åŒ–æˆå‘˜</h3><p>æˆ‘ä»¬å¯ä»¥åªç‰¹ä¾‹åŒ–ç‰¹å®šçš„æˆå‘˜å‡½æ•°è€Œä¸æ˜¯ç‰¹ä¾‹åŒ–æ•´ä¸ªæ¨¡æ¿ç±»ã€‚</p>
<pre><code class="cpp">template &lt;typename T&gt;
class A
&#123;
private:
    T val;
public:
    A(const T &amp; t) : val(t) &#123; &#125;
    void func();
&#125;;

template&lt;&gt;
void A&lt;int&gt;::func()
&#123; &#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> é‚£æˆ‘ä»¬è¿™æ ·å¾—åˆ°çš„å°±æ˜¯å¯¹äºA<int>çš„å®ä¾‹åŒ–ä¸‹çš„ä¸€ä¸ªç‰¹ä¾‹åŒ–funcâ€”â€”è¿™ä¸ªfuncåªåœ¨intçš„å®ä¾‹åŒ–ç‰ˆæœ¬ç”Ÿæ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ä¾‹åŒ–intç‰ˆæœ¬çš„Aå…¶å¯¹åº”çš„funcæ˜¯æˆ‘ä»¬ç‰¹ä¾‹åŒ–çš„è¿™ä¸ªç‰ˆæœ¬ï¼Œè€Œå…¶ä»–æˆå‘˜è¿˜æ˜¯æ­£å¸¸çš„å®ä¾‹åŒ–ã€‚</p>
<h2 id="å¯å˜å‚æ•°æ¨¡æ¿"><a href="#å¯å˜å‚æ•°æ¨¡æ¿" class="headerlink" title="å¯å˜å‚æ•°æ¨¡æ¿"></a>å¯å˜å‚æ•°æ¨¡æ¿</h2><p>å£°æ˜ï¼šå…³äºæ¨¡æ¿çš„é€’å½’è°ƒç”¨ï¼Œéƒ½æœ‰ä¸€ä¸ªåŸºçº¿å‡½æ•°ï¼Œåªä¸è¿‡æ˜¯æ²¡æœ‰å†™å‡ºã€‚</p>
<p>å…³äºå¯å˜å‚æ•°æ¨¡æ¿ï¼Œä¸€éƒ¨åˆ†å¼•ç”¨æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œå†åœ¨è¿™é‡Œåšä¸€äº›è¡¥å……</p>
<blockquote>
<p><strong>å¯å˜æ¨¡æ¿å‚æ•°</strong> <em>variadic template</em></p>
<p><strong>åŒ…</strong>          <em>packet</em></p>
<p><strong>æ¨¡æ¿å‚æ•°åŒ…</strong>   <em>template parameter packet</em></p>
<p><strong>å‡½æ•°å‚æ•°åŒ…</strong>   <em>function paremeter packet</em> </p>
</blockquote>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/JAN6055/article/details/122818685?spm=1001.2014.3001.5501">C++â€”â€”C++11çš„æ ‡å‡†ï¼ˆä¸‹ï¼‰___JAN__çš„åšå®¢-CSDNåšå®¢<img src="https://csdnimg.cn/release/blog_editor_html/release2.0.8/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=M276" alt=" ">https://blog.csdn.net/JAN6055/article/details/122818685?spm=1001.2014.3001.5501</a></p>
<p>è¯¦æƒ…è§è¿™ç¯‡æ–‡ç« çš„å¯å˜æ¨¡æ¿å‚æ•°ã€‚ </p>
<p><strong>è¡¥å……ï¼š</strong></p>
<p><strong>sizeofâ€¦è¿ç®—ç¬¦</strong></p>
<p>èƒ½å¤Ÿè·å¾—åŒ…ä¸­å‚æ•°çš„ä¸ªæ•°</p>
<pre><code class="cpp">template&lt;typename T, typename... Args&gt;
void var_fun(const T &amp; t, const Args&amp;... args)
&#123;
    //cout &lt;&lt; t;
    cout &lt;&lt; &quot;element numbers of packs is &quot; &lt;&lt; sizeof...(Args);
    //var_fun(args...);
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p><strong>åŒ…æ‹“å±•</strong></p>
<blockquote>
<p><strong>æ‹“å±•</strong>    <em>packs expand</em></p>
<p>åŒ…æ‹“å±•ç®€å•çš„æ¥è¯´å°†ä»–åˆ†è§£ä¸ºå…¶æ„æˆçš„å…ƒç´ ï¼Œå¦‚æœè¯´å°†å‚æ•°å˜ä¸ºåŒ…çš„è¿‡æˆç±»æ¯”ä¸ºå‹ç¼©æœªè§ï¼Œé‚£ä¹ˆåŒ…æ‹“å±•å°±æ˜¯è§£å‹æ–‡ä»¶ï¼Œä½†åŒ…æ‹“å±•ä¸ä»…ä»…æ˜¯åŒ…å±•å¼€ã€‚</p>
</blockquote>
<p>å½“æ‹“å±•ä¸€ä¸ªåŒ…æ—¶ï¼Œæˆ‘ä»¬è¿˜è¦æä¾›ç”¨äºï¼Œæ¯ä¸ªæ‹“å±•å…ƒç´ çš„<strong>æ¨¡å¼</strong>ã€‚æ‹“å±•ä¸€ä¸ªåŒ…å°±æ˜¯å°†å®ƒè´¹è§£ä¸ºæ„æˆçš„åŸä¹¦ï¼Œå¯¹æ¯ä¸ªå…ƒç´ åº”ç”¨æ¨¡å¼ï¼Œè·å¾—æ‹“å±•åçš„åˆ—è¡¨ã€‚æˆ‘ä»¬é€šè¿‡åœ¨æ¨¡å¼å³è¾¹é˜²ä¸€ä¸ªçœç•¥å·â€¦æ¥è§¦å‘æ‹“å±•æ“ä½œ ã€‚</p>
<blockquote>
<p>ä»€ä¹ˆæ˜¯æ¨¡å¼ï¼Ÿ</p>
<p>åœ¨å®é™…ç”Ÿæ´»ä¸­ï¼Œå½“æˆ‘ä»¬è¯´ä»¥ä¸€ç§æ¨¡å¼æ‰“å¼€æŸä¸ªä¸œè¥¿ï¼Œæˆ–è€…æ˜¯ä»€ä¹ˆæ¨¡å¼æ‰“å¼€æ—¶ã€‚æŒ‡å®šçš„æ˜¯å›ºæœ‰çš„æ¨¡å¼ï¼Œæ¯”å¦‚è¯´æ€§èƒ½æ¨¡å¼ï¼Œå‡è¡¡æ¨¡å¼ç­‰ã€‚è€ŒæŠ±æ‹“å±•çš„æ¨¡å¼æ›´åƒæ˜¯å¯¹äºæ¯ä¸ªå…ƒç´ éƒ½è°ƒç”¨ä¸€æ¬¡ç›¸åº”çš„å‡½æ•°ï¼ŒåŒ…æ‹“å±•éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰æ¨¡å¼â€”â€”å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›å€¼ä¸ºåŒ…ä¸­çš„ä¸€ä¸ªå…ƒç´ åº”ç”¨æ¨¡å¼åçš„ç»“æœï¼Œæ‰€æœ‰è¿™æ ·çš„ç»“æœç»„åˆåœ¨ä¸€èµ·ï¼Œä¹Ÿå°±æ˜¯åŒ…ä»¥è¿™ä¸ªæ¨¡å¼ï¼ˆå‡½æ•°ï¼‰å±•å¼€ã€‚</p>
</blockquote>
<p>çœ‹ä¸€ä¸‹æ ‡å‡†åº“çš„é…ç½®å™¨ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨çš„å±•å¼€</p>
<pre><code class="cpp">noexcept(noexcept(::new((void *)__p)
                _Up(std::forward&lt;_Args&gt;(__args)...)))
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼‚å¸¸å£°æ˜çš„éƒ¨åˆ†ï¼Œå½“ç”¨ä¸€ä¸ªåŒ…æ„é€ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä»…å½“ï¼Œä½¿ç”¨è½¬å‘æ¨¡å¼å¯¹å‚æ•°åŒ…è¿›è¡Œå±•å¼€çš„æ—¶å€™ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<pre><code class="cpp">    var_func(args...);      //é»˜è®¤çš„åŒ…å±•å¼€
    //æ³¨é‡Šéƒ¨åˆ†çš„...ä¸ä¸ºå…³é”®å­—ï¼Œå’ŒC++è¯­æ³•æ²¡æœ‰ä»»ä½•å…³ç³»
    //ç›¸å½“äºè¿™æ ·&#123;ele1, ele2, ele3, ... ,elen&#125;
    var_fun(mul(2,args)...);    //å¸¦æœ‰æ¨¡å¼çš„åŒ…å±•å¼€
    //ç¬¬äºŒç§å±•å¼€æ¨¡å¼ç›¸å½“äºè¿™æ ·
    //&#123; mul(2,ele0),mul(2,ele1),mul(2,ele2), ... mul(2,elen) &#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å…·ä½“å®éªŒ</p>
<pre><code class="cpp">template &lt;typename T&gt;
void print(const T &amp; t)
&#123;
  cout &lt;&lt; t &lt;&lt; endl;
&#125;
template &lt;typename T, typename... Args&gt;
void print(const T &amp;t ,const Args... args)
&#123;
  cout &lt;&lt; t &lt;&lt; endl;
  print(args...);
&#125;

template &lt;typename T&gt;
int up(T &amp; t)
&#123;
  t *= 2;
  return t;
&#125;
template &lt;typename... Args&gt;
void func(Args&amp;&amp;... args)
&#123;
  print(up(args)...);
&#125;

int main()
&#123;
  func(1,2,3,4,5);
  return 0;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> è¿è¡Œç»“æœ</p>
<p><img src="https://img-blog.csdnimg.cn/07fd5425aa89414d88e86c521823742e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p>
<h3 id="å¯å˜æ¨¡æ¿å‚æ•°çš„å…·ä½“ä½œç”¨"><a href="#å¯å˜æ¨¡æ¿å‚æ•°çš„å…·ä½“ä½œç”¨" class="headerlink" title="å¯å˜æ¨¡æ¿å‚æ•°çš„å…·ä½“ä½œç”¨"></a>å¯å˜æ¨¡æ¿å‚æ•°çš„å…·ä½“ä½œç”¨</h3><p>å¯å˜æ¨¡æ¿å‚æ•°å¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ ¸å¼¹ï¼Œæ¯”å¦‚tupleå°±æ˜¯ä½¿ç”¨å…¶å®ç°çš„ï¼Œæ¨¡æ¿ç±»tupleä»¥ç§æœ‰ç»§æ‰¿çš„æ–¹å¼ç»§æ‰¿å®ƒè‡ªå·±å¹¶ç»“åˆæ¨¡æ¿éƒ¨åˆ†ç‰¹ä¾‹åŒ–ã€‚å¦‚ä¸‹</p>
<pre><code class="cpp">template&lt;typename T, typename ... Args&gt;
class tuple&lt;T,Args...&gt; : private tuple&lt;Args...&gt;
&#123;
    //something
&#125;;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> è¿˜æ˜¯å¾ˆå¥‡å¦™çš„ï¼Œå…·ä½“è¯¦æƒ…è¯·è§‚çœ‹ä¾¯æ·è€å¸ˆçš„è§†é¢‘â€”â€”bilibili ï¼š <img src="https://img-blog.csdnimg.cn/d4465dc3a3e84b0ba1857922cf22379d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAX19KQU5fXw==,size_13,color_FFFFFF,t_70,g_se,x_16" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p>
<h2 id="æ¨¡æ¿æŠ€å·§"><a href="#æ¨¡æ¿æŠ€å·§" class="headerlink" title="æ¨¡æ¿æŠ€å·§"></a>æ¨¡æ¿æŠ€å·§</h2><p>æ¨¡æ¿çš„åŠŸèƒ½è¿˜æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å­¦ä¹ ä¸€äº›æ¨¡æ¿æŠ€å·§ã€‚</p>
<h3 id="è½¬å‘"><a href="#è½¬å‘" class="headerlink" title="è½¬å‘"></a>è½¬å‘</h3><blockquote>
<p> ä»€ä¹ˆæ˜¯è½¬å‘ï¼Ÿ</p>
<p>æŸäº›å‡½æ•°éœ€è¦å°†å…¶ä¸€ä¸ªæˆ–å¤šä¸ªå®å‚è¿<strong>åŒç±»å‹ä¸å˜çš„****ä¼ é€’</strong>ç»™å…¶ä»–å‡½æ•°ã€‚è¿™ä¸ªè¿‡ç¨‹å°±å«<strong>è½¬å‘ã€‚</strong></p>
<p>å¾ˆå½¢è±¡ï¼Œä¸€ä¸ªå‡½æ•°æŠŠæ•°æ®åŸå°ä¸åŠ¨çš„ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯è½¬å‘ã€‚</p>
</blockquote>
<p>ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°è½¬å‘å‘¢ï¼Ÿæ¯”å¦‚è¯´æˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å®¹å™¨å°¾éƒ¨ç›´æ¥ä½¿ç”¨æˆ‘ä»¬ç©¿è¿›æ¥çš„å‚æ•°æ„é€ ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨è½¬å‘å°±æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚å¦‚æœæˆ‘ä»¬ä¸é€‚ç”¨è½¬å‘æŠ€æœ¯ï¼Œå¯èƒ½ä¼šé€ æˆå˜é‡çš„å¤åˆ¶ï¼Œä¹Ÿè®¸æœ‰çš„æ—¶å€™è¿™ä¸ªå‡½æ•°èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¼•ç”¨æ¥åšäº‹ï¼Œæ‰€ä»¥è¿™æ ·åšç•™ä¸‹çš„é”™è¯¯çš„éšæ‚£ã€‚ </p>
<p>å‡è®¾æœ‰func1(int &amp;ï¼Œargs) fun2 work(argsï¼Œint&amp;);</p>
<p>æˆ‘ä»¬éœ€è¦ä¼ è¿›func1ä¸€ä¸ªæ•´å½¢ï¼Œç»è¿‡func2çš„ä¸­é—´åª’ä»‹ï¼Œä¼ å…¥workï¼Œå¹¶åœ¨workä¸­æ”¹å˜é‚£ä¸ªå˜é‡ã€‚</p>
<p>è¯»è€…å¯ä»¥è¯•ä¸€ä¸‹func2ä¸­ä½¿ç”¨ä»€ä¹ˆæ ·çš„å‚æ•°ï¼Œç»è¿‡æ€æ ·çš„å˜æ¢å¯ä»¥å¯¹åŸæ¥çš„å‚æ•°çš„æ€§è´¨åŸå°ä¸åŠ¨çš„ä¼ é€’ç»™workã€‚è¿™æ˜¯æ¯”è¾ƒç®€å•çš„æƒ…å†µäº†ã€‚STLçš„éƒ¨åˆ†å‡½æ•°å®ç°ä¼šæœ‰ææ€–çš„è°ƒç”¨å±‚æ¬¡ï¼Œå¦‚æœä¸ä½¿ç”¨è½¬å‘æŠ€æœ¯åæœå¯æƒ³è€ŒçŸ¥ã€‚</p>
<h3 id="ä½¿ç”¨std-forward"><a href="#ä½¿ç”¨std-forward" class="headerlink" title="ä½¿ç”¨std::forward"></a>ä½¿ç”¨std::forward</h3><p>è¦è¯´è½¬å‘ä¸€å®šç¦»ä¸å¼€std::forward</p>
<p>forwardè¿”å›å®å‚ç±»å‹çš„å³å€¼å¼•ç”¨ã€‚å®ƒå’Œmoveå¾ˆåƒï¼Œä½†å‰è€…æ˜¯è¿”å›ç»™å®šç±»å‹çš„å³å€¼å¼•ç”¨ï¼Œå¦‚æœç»™å®šçš„ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ä¹Ÿè¿”å›å…¶å³å€¼å¼•ç”¨â€”â€”å·¦å€¼å¼•ç”¨ï¼Œå¹¶ä¸”å…¶å¿…é¡»æ˜¾å¼çš„æŒ‡å®šæ¨¡æ¿å‚æ•°ï¼›è€Œmoveæ— è®ºæ¨¡æ¿å‚æ•°ç±»å‹æ˜¯ä»€ä¹ˆéƒ½è¿”å›ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼ˆåªèƒ½æ˜¯å³å€¼å¼•ç”¨ï¼‰ï¼Œå› ä¸ºå‰é¢å·²ç»çœ‹åˆ°äº†moveçš„å®ç°æ–¹æ³•ã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸‹é¢çš„è½¬å‘å‡½æ•°    </p>
<pre><code class="cpp">template &lt;typename F, typename T1, typename T2&gt;
void fun(F f, T1 &amp;&amp; t1, T2 &amp;&amp; t2)
&#123;
    f(std::forward&lt;T2&gt;(t2), std::forward&lt;T1&gt;(t1));
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä½¿ç”¨å³å€¼å¼•ç”¨ä½œä¸ºæ¨¡æ¿å‚æ•°â€”â€”ç¡®ä¿æ¥å—ä»»æ„å¯¹è±¡ï¼Œå¹¶ä¿è¯å…¶èƒ½ä¿æŒåŸæ¥çš„æ€§è´¨ä¸å˜ï¼ˆè§å¼•ç”¨æŠ˜å ï¼‰ã€‚åœ¨å‘é€å‚æ•°çš„è¿‡ç¨‹ä¸­è·å¾—å¯¹åº”ç±»å‹çš„å³å€¼â€”â€”ç¡®ä¿å…¶ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°çš„æ€§è´¨ä¸å˜ï¼ˆè§å¼•ç”¨æŠ˜å ï¼‰ã€‚</p>
<p>æ›´ç®€å•çš„æ¥è¯´ï¼Œä¸Šè¿°çš„å†™æ³•æ˜¯å¯¹äºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ï¼Œæ— è®ºè¿›è¡Œä½•ç§å‚æ•°ä¼ é€’ï¼Œå…¶å‚æ•°çš„æ€§è´¨éƒ½ä¸ä¼šæ”¹å˜çš„é€šç”¨æƒ…å†µã€‚</p>
<h3 id="è½¬å‘å‚æ•°åŒ…"><a href="#è½¬å‘å‚æ•°åŒ…" class="headerlink" title="è½¬å‘å‚æ•°åŒ…"></a>è½¬å‘å‚æ•°åŒ…</h3><p>æ ¹æ®ä¸Šé¢è½¬å‘çš„å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåœ¨è¿›è¡Œè½¬å‘çš„æ—¶å€™åº”è¯¥ä»¥ä½•ç§æ¨¡å¼è¿›è¡ŒåŒ…å±•å¼€ã€‚</p>
<pre><code>(Args&amp;&amp; ... args) //ä»¥å³å€¼å¼•ç”¨å±•å¼€å‚æ•°åŒ…
std::forward&lt;Args&gt;(args)... //å°†åŒ…ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ åº”ç”¨äºforward
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p> æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·åš</p>
<pre><code class="cpp">template&lt;typename ... Args&gt;
void buffer_fun(Args &amp;&amp;... args)
&#123;
    work(std::forward&lt;Args&gt;(args)...);
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<h3 id="make-sharedçš„å·¥ä½œåŸç†"><a href="#make-sharedçš„å·¥ä½œåŸç†" class="headerlink" title="make_sharedçš„å·¥ä½œåŸç†"></a>make_sharedçš„å·¥ä½œåŸç†</h3><p>std::make_shredå°±æ˜¯åŸºäºè½¬å‘å‚æ•°åŒ…å®ç°çš„ã€‚</p>
<p>è®©æˆ‘ä»¬å…ˆæ¥å›å¿†make_sharedçš„å…¶ä¸­ä¸€ä¸ªä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>make_shared<T> name (args);</p>
<p>å¾ˆæ˜æ˜¾çš„å¯ä»¥æ¨æ–­å…¶åº”è¯¥ä½¿ç”¨ç”¨å¯å˜æ¨¡æ¿å‚æ•°ï¼Œæˆ‘ä»¬è½¬åˆ°å…¶å®šä¹‰</p>
<pre><code class="cpp">  template&lt;typename _Tp, typename... _Args&gt;
    inline shared_ptr&lt;_Tp&gt;
    make_shared(_Args&amp;&amp;... __args)
    &#123;
      typedef typename std::remove_cv&lt;_Tp&gt;::type _Tp_nc;
      return std::allocate_shared&lt;_Tp&gt;(std::allocator&lt;_Tp_nc&gt;(),
                       std::forward&lt;_Args&gt;(__args)...);
    &#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>å¯ä»¥çœ‹è§ï¼Œå…¶ä½¿ç”¨éƒ¨åˆ†ç‰¹ä¾‹åŒ–å’Œå¯å˜å‚æ•°æ¨¡æ¿ï¼Œå°†åŒ…è½¬å‘ç»™äº†std::allocate_sharedè¿›è¡Œç©ºé—´åˆ†é…ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥çš„è½¬åˆ°std::allocate_sharedä¸­å¯ä»¥çœ‹è§å…¶æœ‰è¿›ä¸€æ­¥çš„å°†å…¶è½¬å‘ç»™äº†å…¶ä»–çš„æ¨¡æ¿</p>
<pre><code class="cpp">  template&lt;typename _Tp, typename _Alloc, typename... _Args&gt;
    inline shared_ptr&lt;_Tp&gt;
    allocate_shared(const _Alloc&amp; __a, _Args&amp;&amp;... __args)
    &#123;
      static_assert(!is_array&lt;_Tp&gt;::value, &quot;make_shared&lt;T[]&gt; not supported&quot;);

      return shared_ptr&lt;_Tp&gt;(_Sp_alloc_shared_tag&lt;_Alloc&gt;&#123;__a&#125;,
                 std::forward&lt;_Args&gt;(__args)...);
    &#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<hr>
<p>è‡³æ­¤ï¼ŒC++çš„æ¨¡æ¿çš„åŸºç¡€çŸ¥è¯†ç‚¹å¤§æŠµåº”è¯¥æ˜¯éƒ½è®²å®Œäº†ï¼Œå¦‚æœæ—¥åæœ‰ä¸€äº›æ‚é¡¹è¡¥å……çš„è¯ä¼šæ›´åœ¨ä¸‹é¢ã€‚</p>
<blockquote>
<p>åæ¥çš„è¯: è¿™ç¯‡æ–‡ç« æœ‰ä¸€äº›åœ°æ–¹è®²çš„è¿˜æ˜¯æ¯”è¾ƒä¸æ¸…æ™°çš„ï¼Œç°åœ¨å·²ç»ä¿®æ­£äº†ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¢æ·»äº†å¯¹ä¸€éƒ¨åˆ†çŸ¥è¯†ç‚¹çš„ä»£ç ï¼Œæ—¥åä¹Ÿä¼šæ…¢æ…¢ä¿®æ”¹ã€‚å¦‚æœä½ å‘ç°æœ¬ç¯‡æ–‡ç« çš„é”™è¯¯æˆ–è€…å¯¹æœ¬ç¯‡æ–‡ç« æœ‰ä»€ä¹ˆå»ºè®®å¯ä»¥è¯„è®ºåŒºç•™è¨€æˆ–è€…ç§ä¿¡ç¬”è€…ã€‚</p>
<p>â€‹                                                            â€”â€”2022.6.1</p>
</blockquote>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/C/" style="color: #00bcd4">
                C++
            </a>
        </span>
        
    </div>
    <a href="/2022/09/17/template/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2022/09/17/const-container-s-iterator-is-const-iterator/">
        <h2 class="post-title">Const Container&#39;s Iterator Is Const_iterator</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/17
        </span>
    </div>
    <div class="excerpt">
        <div class="content" v-pre>
            
            <p>å°±æ‹¿vectorä¸¾ä¾‹å­</p>
<p>æˆ‘ä»¬è½¬åˆ°å…¶ä»£ç </p>
<pre><code class="C++">  template&lt;typename _Container&gt;
    inline _GLIBCXX17_CONSTEXPR auto
    begin(_Container&amp; __cont) -&gt; decltype(__cont.begin())
    &#123; return __cont.begin(); &#125;

  /**
   *  @brief  Return an iterator pointing to the first element of
   *          the const container.
   *  @param  __cont  Container.
   */
  template&lt;typename _Container&gt;
    inline _GLIBCXX17_CONSTEXPR auto
    begin(const _Container&amp; __cont) -&gt; decltype(__cont.begin())
    &#123; return __cont.begin(); &#125;

  /**
   *  @brief  Return an iterator pointing to one past the last element of
   *          the container.
   *  @param  __cont  Container.
   */
  template&lt;typename _Container&gt;
    inline _GLIBCXX17_CONSTEXPR auto
    end(_Container&amp; __cont) -&gt; decltype(__cont.end())
    &#123; return __cont.end(); &#125;

  /**
   *  @brief  Return an iterator pointing to one past the last element of
   *          the const container.
   *  @param  __cont  Container.
   */
  template&lt;typename _Container&gt;
    inline _GLIBCXX17_CONSTEXPR auto
    end(const _Container&amp; __cont) -&gt; decltype(__cont.end())
    &#123; return __cont.end(); &#125;

  /**
   *  @brief  Return an iterator pointing to the first element of the array.
   *  @param  __arr  Array.
   */
  template&lt;typename _Tp, size_t _Nm&gt;
    inline _GLIBCXX14_CONSTEXPR _Tp*
    begin(_Tp (&amp;__arr)[_Nm]) noexcept
    &#123; return __arr; &#125;

  /**
   *  @brief  Return an iterator pointing to one past the last element
   *          of the array.
   *  @param  __arr  Array.
   */
  template&lt;typename _Tp, size_t _Nm&gt;
    inline _GLIBCXX14_CONSTEXPR _Tp*
    end(_Tp (&amp;__arr)[_Nm]) noexcept
    &#123; return __arr + _Nm; &#125;
</code></pre>
<p>å¯ä»¥çœ‹è§å¯¹äºconstçš„é‡è½½ç‰ˆæœ¬ï¼Œè¿”å›çš„ä¸ºconst_iterator.</p>
<h1 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h1><p>åœ¨Modern Effective C++ä¸­è¯´åˆ°ï¼Œåœ¨é€šç”¨çš„ä»£ç ä¸­ï¼Œä¼˜å…ˆé€‰ç”¨éæˆå‘˜ç‰ˆçš„begin()&#x2F;end(),ä¹Ÿæ­£æ˜¯å› ä¸ºå¦‚æ­¤ã€‚</p>
<p>ä¹¦ä¸­ç»™å‡ºäº†cbegin()çš„ä¸€ç§å®ç°æ–¹å¼ã€‚</p>
<pre><code class="C++">template &lt;typename C&gt;
auto cbegin(const C &amp; c)-&gt; decltype(c.begin()) &#123;
    return c.begin();
&#125;
</code></pre>
<p>å› ä¸ºå¯¹äºå…·æœ‰constæ€§è´¨çš„å®¹å™¨ï¼ˆåœ¨æ ‡å‡†åº“ä¸­çš„æ˜¯è¿™æ ·ï¼Œå¦‚æœæ˜¯å…¶ä»–åº“æä¾›çš„å®¹å™¨ï¼Œå¯èƒ½ä¸ä¼šæä¾›è¿™æ ·çš„è¡Œä¸ºï¼‰ï¼Œè¿”å›çš„è¿­ä»£å™¨æ˜¯const_iterator,æ‰€ä»¥ï¼Œè¿™æ ·åšæ˜¯æ­£ç¡®çš„ã€‚</p>
<p>å¯¹äºæ•°ç»„æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚beginå¯¹äºæ•°ç»„æœ‰ç‰¹ä¾‹åŒ–ã€‚ ä¸Šé¢çš„ä»£ç å·²ç»çœ‹åˆ°äº†ã€‚</p>
<p>å½“æ•°ç»„å…·æœ‰constæ€§è´¨çš„æ—¶å€™ï¼Œä¾‹å¦‚const int nums[10], _Tpä¼šè¢«æ¨å¯¼ä¸ºconst int, è¿”å›ç±»å‹å°±æ˜¯const int *, å°±æ˜¯æ•°ç»„çš„const_iterator</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Modern-C/" style="color: #ff7d73">
                Modern C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C/" style="color: #03a9f4">
                C++
            </a>
        </span>
        
    </div>
    <a href="/2022/09/17/const-container-s-iterator-is-const-iterator/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2022/09/17/pass-by-value-and-use-std-move/">
        <h2 class="post-title">Pass by Value and Use Std::move</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/9/17
        </span>
    </div>
    <div class="excerpt">
        <div class="content" v-pre>
            
            <h1 id="ä¸€ä¸ªè­¦å‘Šå¼•å‘çš„æ€è€ƒ"><a href="#ä¸€ä¸ªè­¦å‘Šå¼•å‘çš„æ€è€ƒ" class="headerlink" title="ä¸€ä¸ªè­¦å‘Šå¼•å‘çš„æ€è€ƒ"></a>ä¸€ä¸ªè­¦å‘Šå¼•å‘çš„æ€è€ƒ</h1><p>åœ¨c++11ä¹‹å‰ï¼Œæ— è®ºæ˜¯effectiveç³»åˆ—è¿˜æ˜¯c++æ•™ç¨‹ï¼Œéƒ½ä¼šå‘Šè¯‰æˆ‘ä»¬åœ¨ä¸€å®šæƒ…å†µä¸‹ä½¿ç”¨const &amp;æ¥èŠ‚çœæ€§èƒ½ã€‚ä½†æ˜¯åœ¨c++11ä¹‹åï¼Œæœ‰äº†ç§»åŠ¨è¯­ä¹‰ï¼Œä½¿ä¸€äº›ä¸å¯èƒ½çš„è¡Œä¸ºå˜æˆäº†å¯èƒ½ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µç®€å•çš„ä»£ç ã€‚</p>
<pre><code class="cpp">class Person &#123;
private:
    unsigned m_age = 0;
    string m_name;
    Person(const string &amp; name) : m_name(name) &#123; &#125;
&#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>clang-tidyä¼šç»™å‡ºè¿™æ ·çš„ä¸€ä¸ªè­¦å‘Šã€‚</p>
<blockquote>
<p>Clang-Tidy: Pass by value and use std::move</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Œè¿™æ— ç–‘æ˜¯ä¸€ä¸ªæ­£ç¡®çš„æ„é€ å‡½æ•°ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿˜è¦ç»™æˆ‘ä»¬è¿™æ ·çš„è­¦å‘Šå‘¢ï¼Ÿ</p>
<h1 id="ä½¿ç”¨å€¼ä¼ é€’åŠ ç§»åŠ¨è¯­ä¹‰é¿å…ä¸å¿…è¦çš„æ¶ˆè€—"><a href="#ä½¿ç”¨å€¼ä¼ é€’åŠ ç§»åŠ¨è¯­ä¹‰é¿å…ä¸å¿…è¦çš„æ¶ˆè€—" class="headerlink" title="ä½¿ç”¨å€¼ä¼ é€’åŠ ç§»åŠ¨è¯­ä¹‰é¿å…ä¸å¿…è¦çš„æ¶ˆè€—"></a>ä½¿ç”¨å€¼ä¼ é€’åŠ ç§»åŠ¨è¯­ä¹‰é¿å…ä¸å¿…è¦çš„æ¶ˆè€—</h1><p>æˆ‘ä»¬æŒ‰ç…§è­¦å‘Šæ›´æ”¹æˆåæ˜¯è¿™æ ·</p>
<pre><code class="cpp">Person(string  name) : m_name(std::move(name)) &#123; &#125;
</code></pre>
<p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p>
<p>ä½ å¯èƒ½ä¼šæ„Ÿåˆ°ç–‘æƒ‘ï¼Ÿä¸ºä»€ä¹ˆä½¿ç”¨äº†å€¼ä¼ é€’è¿˜ä¼šæœ‰æ›´é«˜çš„æ€§èƒ½å‘¢ï¼Ÿè¿™ä¼¼ä¹å’Œç›´è§‰ä¸ç¬¦ã€‚</p>
<p>æ…¢æ…¢æ¥ï¼Œæˆ‘ä»¬ä¸€ç‚¹ç‚¹åˆ†æã€‚</p>
<p>ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªç±»Fooï¼Œå’Œä¸€ä¸ªä»£ç†çš„æµ‹è¯•ç±»Testã€‚</p>
<pre><code class="C++">#include &lt;iostream&gt;
using namespace std;
struct Foo &#123;
    Foo() &#123;
//        cout &lt;&lt; &quot;default&quot; &lt;&lt; endl;
    &#125;
    Foo(Foo &amp;&amp;)  noexcept &#123;
        cout &lt;&lt; &quot;&amp;&amp;&quot; &lt;&lt; endl;
    &#125;
    Foo(const Foo &amp; ) &#123;
        cout &lt;&lt; &quot;&amp;&quot; &lt;&lt; endl;
    &#125;
    Foo &amp; operator=(const Foo &amp;) &#123;
        cout &lt;&lt; &quot;operator=(&amp;)&quot;  &lt;&lt; endl;
        return *this;
    &#125;
    Foo &amp; operator=(Foo &amp;&amp; ) noexcept &#123;
        cout &lt;&lt; &quot;operator=(&amp;&amp;)&quot;  &lt;&lt; endl;
        return *this;
    &#125;
    Foo operator+(const Foo &amp;) &#123;
//        cout &lt;&lt; &quot;operator+(&amp;)&quot; &lt;&lt; endl;
        return *this;
    &#125;
&#125;;

struct Test1 &#123;
    Foo m_foo;
    void setFoo(Foo foo) &#123;
        m_foo = std::move(foo);
    &#125;
&#125;;

struct Test2 &#123;
    Foo m_foo;
    void setFoo(const Foo &amp; foo) &#123;
        m_foo = foo;
    &#125;
&#125;;
int main()
&#123;
    Test1 test1;
    Foo foo;
    Foo foo1;
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    test1.setFoo(foo);
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    test1.setFoo(foo + foo1);
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    test1.setFoo(Foo&#123;&#125;);
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    test1.setFoo(std::move(foo));
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    test1.setFoo(std::move(Foo&#123;&#125;));
    cout &lt;&lt; &quot;-----\n&quot; &lt;&lt; endl;

    Test2 test2;
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;

    test2.setFoo(foo);
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    test2.setFoo(foo + foo1);
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    test2.setFoo(Foo&#123;&#125;);
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    test2.setFoo(std::move(foo));
    cout &lt;&lt; &quot;-----&quot; &lt;&lt; endl;
    return 0;
&#125;
</code></pre>
<p>å¯¹äºä¸åŒçš„æƒ…å†µï¼Œæˆ–ç”±ä¸åŒçš„ç»“æœï¼ŒC++çš„ç‰¹æ€§å’Œå¤æ‚æ€§åœ¨è¿™é‡Œä½“ç°çš„æ·‹æ¼“å°½è‡´ã€‚</p>
<blockquote>
<p>é¦–å…ˆæˆ‘ä»¬åº”å½“çŸ¥é“ç°ä»£C++è§„å®šäº†ç¼–è¯‘å™¨åº”å½“å¯¹äºè¿”å›å€¼è¿›è¡Œä¼˜åŒ–ã€‚å¯¹äºè¿™æ ·çš„ä¸€ä¸ªå‡½æ•°</p>
<p>X foo() { X x; return x; }</p>
<p>ç°åœ¨çš„ç¼–è¯‘å™¨åœ¨è°ƒç”¨xçš„æ—¶å€™ï¼Œå°±åƒç›´æ¥è°ƒç”¨æ„é€ X::X()ä¸€æ ·ï¼Œä¸å¿…ç»è¿‡é¢å¤–çš„æ‹·è´ã€‚å¯¹äºè¿”å›å€¼ä¼˜åŒ–é—®é¢˜ï¼Œè¿˜æœ‰ä¸€äº›è§„åˆ™ï¼Œæˆ‘æ‰“ç®—æ”¾åœ¨å¦ä¸€ç¯‡åšå®¢é‡Œé¢è¯´ã€‚</p>
<p>è¯¦æƒ…è¯·è§C++æ ‡å‡†åº“(ä¸­æ–‡ç¬¬äºŒç‰ˆ)P19,P20,P21</p>
</blockquote>
<p>æ‰€ä»¥ï¼Œç”šè‡³å¯¹äºè¿”å›å€¼ä¼˜åŒ–çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿåº”å½“è€ƒè™‘è¿›å»ã€‚æ¯”å¦‚è¯´å¯¹äº</p>
<p><code>setFoo(Foo&#123;&#125;)å’ŒsetFoo(std::move(foo))</code>å¯èƒ½ä¼šæœ‰å’Œæˆ‘ä»¬é¢„æœŸä¸ç¬¦åˆçš„ç»“æœã€‚</p>
<p>è¿è¡Œç»“æœ</p>
<pre><code>-----
&amp;			 //copy ctor
operator=(&amp;&amp;) //move
-----
&amp;			 //è¿™é‡Œçš„copyï¼Œæ˜¯+è¿ç®—ç¬¦è¿”å›çš„æ—¶å€™äº§ç”Ÿçš„
operator=(&amp;&amp;) //move
-----
operator=(&amp;&amp;) //è¿™é‡Œåªæœ‰ä¸€ä¸ªmoveè€ŒFoo&#123;&#125;æ²¡æœ‰copyåˆ°å½¢å‚ï¼Œæ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–åçš„ç»“æ„
-----
&amp;&amp;		     //ä½¿ç”¨std::moveæ‰€ä»¥ç§»åŠ¨æ„é€ 
operator=(&amp;&amp;) //move
-----
&amp;&amp;            //ä½¿ç”¨std::moveç¼–è¯‘å™¨ä¸å†ä¼˜åŒ–Foo&#123;&#125;ï¼Œè½¬è€Œå’Œä¸Šç§æƒ…å†µä¸€æ ·
operator=(&amp;&amp;) //move
-----

-----
operator=(&amp;)  //æŒ‰å¼•ç”¨ä¼ å‚ï¼Œctor
-----
&amp;			 //è¿™é‡Œçš„copyï¼Œæ˜¯+è¿ç®—ç¬¦è¿”å›çš„æ—¶å€™äº§ç”Ÿçš„
operator=(&amp;)  //ctor
-----
operator=(&amp;)  //ç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œåªæœ‰ä¸€ä¸ªctor
-----
operator=(&amp;)  //Clang-Tidyï¼šå°† std::move() çš„ç»“æœä½œä¸º const å¼•ç”¨å‚æ•°ä¼ é€’ï¼› å®é™…ä¸Šä¸ä¼šå‘ç”Ÿä»»ä½•åŠ¨ä½œ,æ‰€ä»¥åŒä¸Š
-----
operator=(&amp;)  //Clang-Tidyï¼šå°† std::move() çš„ç»“æœä½œä¸º const å¼•ç”¨å‚æ•°ä¼ é€’ï¼› å®é™…ä¸Šä¸ä¼šå‘ç”Ÿä»»ä½•åŠ¨ä½œã€‚åŒä¸Š
-----
</code></pre>
<blockquote>
<p>å…³äºè¿™ä¸ªé—®é¢˜ï¼ŒModern Effective C++ä¹Ÿæœ‰æ¢è®¨ã€‚è§æ¡æ¬¾41ã€‚</p>
</blockquote>
<p>è¿™å¤Ÿä»¤äººå¤´å¤§äº†ï¼Œå®é™…æƒ…å†µå¯èƒ½æ¯”æˆ‘ä»¬æƒ³è±¡çš„è¿˜è¦å¤æ‚ã€‚</p>
<p>ä½†æ˜¯ç»¼ä¸Šæ¥çœ‹ï¼Œæˆ‘ä»¬ä¸éš¾å¾—å‡ºä¸€ä¸ªç»“è®ºã€‚å¦‚æœç±»å‹çš„ç§»åŠ¨è¯­ä¹‰å…·æœ‰è¾ƒä½çš„æˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨pass by value and use std moveçš„è¿™ç§æ–¹å¼æ¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœç±»å‹çš„ç§»åŠ¨è¯­ä¹‰å…·æœ‰ä¸€å®šçš„æ¶ˆè€—ï¼Œä¸æ¨èè¿™æ ·åšã€‚å°±åƒå¦‚æœæˆ‘ä»¬å¤„ç†çš„æ˜¯ä¸€äº›çŸ­å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¼•ç”¨æ–¹å¼çš„ä¼ é€’è‚¯å®šæ¯”å€¼ä¼ é€’+ç§»åŠ¨è¿™ç§æ–¹å¼è¦é«˜æ•ˆã€‚å¦‚æœæ˜¯è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨å€¼ä¼ é€’+å¼•ç”¨çš„æ–¹å¼æ¯”è¾ƒé«˜æ•ˆã€‚</p>
<p>å¹¶ä¸”ï¼Œå¦‚æœå¯¹è±¡æ”¯æŒç§»åŠ¨æ“ä½œï¼Œé‚£ä¹ˆä»–å°±ä¼šç§»åŠ¨ï¼Œå¦‚æœå¯¹è±¡ä¸æ”¯æŒç§»åŠ¨æ“ä½œï¼Œé‚£ä¹ˆå€¼ä¼ é€’+å¼•ç”¨çš„æ–¹å¼ä¼šcopyä¸¤æ¬¡ï¼Œè¿™æ˜¯éœ€è¦æ³¨æ„çš„ã€‚</p>
<p>è¿™äº›å¤æ‚çš„è¯·å†µéƒ½è¦â€å½’åŠŸâ€œç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œå¦‚æœå®åœ¨æä¸æ˜ç™½ï¼Œé‚£å°±ä»»ä»–å»å§ï¼è¯´å®è¯ï¼Œä½œè€…åœ¨è¿™é‡Œå¯¹äºæ‰€æœ‰çš„ç»†èŠ‚ä¹Ÿä¸æ˜¯å…¨éƒ¨æ¸…æ™°ã€‚é‚£å°±è®°ä½æˆ‘ä»¬ä¸Šé¢å¾—å‡ºçš„çš„ç»“è®ºå³å¯ã€‚æˆ‘ä»¬ä¸æ˜¯ç¼–è¯‘å™¨çš„å®ç°è€…ï¼Œè¿™äº›é—®é¢˜æ— å…³å¤§é›…ã€‚</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
        </span>
        
        
        <span class="tag">
            
            <a href="/tags/Modern-C/" style="color: #ffa2c4">
                Modern C++
            </a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/C/" style="color: #ffa2c4">
                C++
            </a>
        </span>
        
    </div>
    <a href="/2022/09/17/pass-by-value-and-use-std-move/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

             
<div class="page-current">
    <div class="prev">
        
    </div>
    <div class="page-index">
        
        <span class="current">
            1
        </span>
        
    </div>
    <div class="next">
        
    </div>
</div>
        </div>
    </div>
    
    <div id="home-card">
        <div id="card-div">
    <div class="card-style" style="width: 300px">
        <div class="avatar">
            <img src="https://avatars.githubusercontent.com/u/94843786?s=400&u=3e0bac8cdc09c80d159d076c0503db566f8f0579&v=4 " alt="avatar">
        </div>
        <div class="name">
            Jan6055
        </div>
        <div class="descriptions">
            
            <div class="description">
                å…´è¶£ï¼š
            </div>
            
            <div class="description">
                C++
            </div>
            
            <div class="description">
                Rust
            </div>
            
            <div class="description">
                Haskell
            </div>
            
            <div class="description">
                è¿™æ˜¯æˆ‘çš„ä¸ªäººåšå®¢ï¼Œç”¨äºè®°å½•å­¦ä¹ åˆ°çš„æŠ€èƒ½
            </div>
            
            <div class="description">
                æˆ‘å¸Œæœ›æˆ‘çš„åšå®¢ä¼šå¸®åˆ°ä½ 
            </div>
            
            <div class="description">
                å¦‚æœä½ å¯¹åšå®¢ä¸­çš„å†…å®¹æœ‰ç–‘é—®ï¼Œè¯·è”ç³»
            </div>
            
            <div class="description">
                QQ: 1796728809
            </div>
            
            <div class="description">
                email: 1796728809@qq.com
            </div>
            
            <div class="description">
                wangq6055@outlook.com
            </div>
            
            <div class="description">
                ç›®å‰:
            </div>
            
            <div class="description">
                åœ¨æ ¡å¤§äºŒå­¦ç”Ÿ
            </div>
            
            <div class="description">
                åœ¨å­¦ä¹ Modern C++ &amp;&amp; å„ç§è®¡ç®—æœºåŸºç¡€
            </div>
            
            <div class="description">
                æ—¶ä¸æ—¶æ‘†çƒ‚ï¼Œå¾ˆçˆ½
            </div>
            
            <div class="description">
                But I love coding!
            </div>
            
        </div>
        <div class="icon-links">
            
            <span class="icon-link">
                <a target="_blank" rel="noopener" href="https://github.com/jan6055">
                    <i class="fa-brands fa-github fa-fw"></i>
                </a>
            </span>
            
        </div>
        <div class="friend-links">
            
        </div>
    </div>
</div>
    </div>
    
</div>
                         
<footer id="footer">
    <div class="footer-wrap">
        <div>
            Â© 20xx - 2022 Hello @you
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @Jan6055
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        

    </body>
</html>